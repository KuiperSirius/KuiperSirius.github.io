<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>暮城雨烟</title>
  
  <subtitle>The Sound of Silence</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://blog.kixcs.com/"/>
  <updated>2021-02-08T12:38:51.342Z</updated>
  <id>https://blog.kixcs.com/</id>
  
  <author>
    <name>夜阑听烟雨</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>软件定义无线电的应用：搭建树莓派SDR服务器</title>
    <link href="https://blog.kixcs.com/archives/a0b3/"/>
    <id>https://blog.kixcs.com/archives/a0b3/</id>
    <published>2021-02-08T10:34:12.000Z</published>
    <updated>2021-02-08T12:38:51.342Z</updated>
    
    <content type="html"><![CDATA[<p class="description"></p>SDR即软件定义无线电，在无线电爱好者HAM圈子中属于一种廉价的，宽适应频率的一种收听玩法。众所周知，任何无线电接收装置都会有一定的频率适用范围，如对讲机，对讲机按频率适用范围可分为U段（400MHz）、V段（140MHz）、短波（30MHz以下），其中短波还分CW、SSTV、AM、AMS、LSB、USB、DSB、ISB、FM等模式；收音机，一般有FM、AM、短波、中波，某些高端的型号还可能会兼容V段频率。倘若你有远程接收无线电的需求，构建spyserver这种方式不失为一种妥当的选择。<a id="more"></a><h3 id="RTL-SDR-TCP"><a href="#RTL-SDR-TCP" class="headerlink" title="RTL-SDR/TCP"></a>RTL-SDR/TCP</h3><p>准备好树莓派、Rtl-2832U，连接好硬件，首先SSH登录树莓派，直接lsusb查看USB设备列表，倘若一切正常应该可以正常显示如下字样：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi:~# lsusb</span><br><span class="line">Bus 001 Device 004: ID 10c4:ea70 Cygnal Integrated Products, Inc. CP210x UART Bridge</span><br><span class="line">Bus 001 Device 005: ID 0bda:2832 Realtek Semiconductor Corp. RTL2832U DVB-T</span><br><span class="line">Bus 001 Device 006: ID 0424:7800 Standard Microsystems Corp.</span><br><span class="line">Bus 001 Device 003: ID 0424:2514 Standard Microsystems Corp. USB 2.0 Hub</span><br><span class="line">Bus 001 Device 002: ID 0424:2514 Standard Microsystems Corp. USB 2.0 Hub</span><br><span class="line">Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br></pre></td></tr></table></figure><p>接下来稍微更新一下软件源：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get updade </span><br></pre></td></tr></table></figure><p>然后就开始安装了，首先安装需要的库和编译程序，全部确认yes即可：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libusb-1.0-0-dev cmake</span><br></pre></td></tr></table></figure><p>然后下载SDR：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo git clone git://git.osmocom.org/rtl-sdr.git</span><br></pre></td></tr></table></figure><p>下载完成，进入目录：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd rtl-sdr/</span><br></pre></td></tr></table></figure><p>编译、安装 ：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo cmake -DINSTALL_UDEV_RULES=ON -DDETACH_KERNEL_DRIVER=1</span><br><span class="line"><span class="meta">#</span><span class="bash">重启后进行</span></span><br><span class="line">sudo make </span><br><span class="line"><span class="meta">#</span><span class="bash">重启后进行</span></span><br><span class="line">sudo make install </span><br><span class="line">sudo ldconfig</span><br></pre></td></tr></table></figure><p>完成后分配IP地址:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo rtl_tcp -a 000.000.000.000</span><br><span class="line"><span class="meta">#</span><span class="bash">000的地方填写你的树莓派IP</span></span><br></pre></td></tr></table></figure><p>然后访问<span class="exturl" data-url="aHR0cDovL3NkcnNoYXJwLmNvbS8=" title="http://sdrsharp.com/">SDRSharp官网<i class="fa fa-external-link"></i></span>下载PC端的SDR软件（Windows），下载完解压运行install，install完成后会生成一个sdrsharp文件夹，进去该文件夹，运行sdrsharp。</p><p>在左边菜单里面找到 源【Source】选择RTL-SDR/TCP，然后点击“齿轮”状按钮。</p><p>主机填写树莓派所属IP，就是刚才终端里面设置的信息，端口默认1234，采样率 0.900001MSPS。</p><p>设置完成，点击齿轮旁边三角形按钮启动。</p><p>下面给出screen窗口环境下快捷运行指令的脚本代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">/home/Remote_SDR/rtl-sdr/src/rtl_tcp -a 192.168.10.20 -p 1234 -s 2048000</span><br></pre></td></tr></table></figure><p>其中关于rtl_tcp指令详细使用方法如下代码所示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rtl_tcp --help</span><br></pre></td></tr></table></figure><h3 id="SpyServer"><a href="#SpyServer" class="headerlink" title="SpyServer"></a>SpyServer</h3><p>想远程收听某地的广播，可以在树莓派上安装 SpyServer 。</p><p>首先，打开终端，安装需要的驱动及库。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install rtl-sdr librtlsdr-dev</span><br></pre></td></tr></table></figure><p>建立程序目录：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir spyserver </span><br><span class="line">cd spyserver</span><br></pre></td></tr></table></figure><p>下载最新的版本的SpyServer二进制文件。注意，如果不是在arm平台上安装，需要替换为合适的<span class="exturl" data-url="aHR0cDovL3d3dy5odHRwLy9haXJzcHkuY29tL2Rvd25sb2Fk" title="http://www.http//airspy.com/download">下载链接<i class="fa fa-external-link"></i></span></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget -O spyserver.tgz http://airspy.com/?ddownload=4247 </span><br><span class="line">tar xvzf spyserver.tgz</span><br></pre></td></tr></table></figure><p>其中，查看树莓派操作系统位数的指令为：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getconf LONG_BIT</span><br></pre></td></tr></table></figure><p>编辑配置文件 spyserver.config ， 将 device_type 项修改为:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">device_type = RTL-SDR</span><br></pre></td></tr></table></figure><p>你还可以修改监听端口，采样信息等配置。执行 ./spyserver 运行 spyserver（建议另起一个screen窗口启动该进程）。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi:/home# cd spyserver/</span><br><span class="line">root@raspberrypi:/home/spyserver# ls</span><br><span class="line">spyserver  spyserver.config  spyserver_ping  spyserver.tgz</span><br><span class="line">root@raspberrypi:/home/spyserver# ./spyserver</span><br><span class="line">SPY Server v2.0.1700</span><br><span class="line">Copyright (C) 2016-2018 Youssef Touil - https://airspy.com</span><br><span class="line">Reading the configuration file: spyserver.config</span><br><span class="line">Listening for connections on 0.0.0.0:5555</span><br><span class="line">Found Rafael Micro R820T tuner</span><br><span class="line">[R82XX] PLL not locked!</span><br></pre></td></tr></table></figure><p>将spyserver设置为服务（未测试）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建系统服务</span></span><br><span class="line">nano  /etc/systemd/system/spyserver.service </span><br></pre></td></tr></table></figure><p>spyserver.service内容为：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line"></span><br><span class="line">Description=spyserver</span><br><span class="line"></span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line"></span><br><span class="line">User=pi ##按实际情况设置</span><br><span class="line"></span><br><span class="line">Type=forking</span><br><span class="line"></span><br><span class="line">RemainAfterExit=yes</span><br><span class="line"></span><br><span class="line">ExecStart=/home/pi/spyserver/spyserver</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line"></span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>之后开启服务并且设置开机自启</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">启动 spyserver并创建服务配置</span></span><br><span class="line">systemctl start spyserver  </span><br><span class="line"><span class="meta">#</span><span class="bash">设置开机自动启动 spyserver</span></span><br><span class="line">systemctl enable spyserver </span><br></pre></td></tr></table></figure><p>打开 SDR#将Source修改为 Spy Server Network，输入服务器地址，如sdr://10.0.0.10:5555 ，点击C，调整相关参数即可。</p><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.rtl-sdr.com/rtl-sdr-tutorial-setting-up-and-using-the-spyserver-remote-streaming-server-with-an-rtl-sdr/</span><br></pre></td></tr></table></figure><h3 id="相关软件"><a href="#相关软件" class="headerlink" title="相关软件"></a>相关软件</h3><p>直接给出Android端RTL-SDR驱动程序，SDR Touch和SDR Touch key的.apk安装包，详情见<span class="exturl" data-url="aHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL2RyaXZlL2ZvbGRlcnMvMXI3cklZZnd0eDZhaFZKNGowMkloZkNCRldjckd3UW1TP3VzcD1zaGFyaW5n" title="https://drive.google.com/drive/folders/1r7rIYfwtx6ahVJ4j02IhfCBFWcrGwQmS?usp=sharing">Google Drive<i class="fa fa-external-link"></i></span>。</p>]]></content>
    
    <summary type="html">
    
      &lt;p class=&quot;description&quot;&gt;&lt;/p&gt;
SDR即软件定义无线电，在无线电爱好者HAM圈子中属于一种廉价的，宽适应频率的一种收听玩法。众所周知，任何无线电接收装置都会有一定的频率适用范围，如对讲机，对讲机按频率适用范围可分为U段（400MHz）、V段（140MHz）、短波（30MHz以下），其中短波还分CW、SSTV、AM、AMS、LSB、USB、DSB、ISB、FM等模式；收音机，一般有FM、AM、短波、中波，某些高端的型号还可能会兼容V段频率。倘若你有远程接收无线电的需求，构建spyserver这种方式不失为一种妥当的选择。
    
    </summary>
    
    
      <category term="技术" scheme="https://blog.kixcs.com/categories/technique/"/>
    
    
      <category term="rtl_tcp" scheme="https://blog.kixcs.com/tags/rtl-tcp/"/>
    
      <category term="spyserver" scheme="https://blog.kixcs.com/tags/spyserver/"/>
    
  </entry>
  
  <entry>
    <title>搭建推送机器人Telegram bot实现消息推送</title>
    <link href="https://blog.kixcs.com/archives/8f4c/"/>
    <id>https://blog.kixcs.com/archives/8f4c/</id>
    <published>2021-02-05T12:06:41.000Z</published>
    <updated>2021-02-05T13:29:20.330Z</updated>
    
    <content type="html"><![CDATA[<p class="description"></p>原先一直在软路由上用server酱配合微信实现消息推送，但是最近微信相关政策开始收紧，1月27号微信发布了一条关于下线服务号模板消息功能的通知，即后期有无法使用的可能。于是在找替代品，常见的便是自建服务器实现消息的Push，比如iOS的bark，安卓上的gotify，更小众的有小米用自带的mipush等。但是用起来都需要自建服务，或者面临复杂的编写环境。一个合适的替代品是Telegram bot，支持多种语言，既操作简便又功能众多，倘若只想达到类似server酱的功能，直接导入token并post即可。<a id="more"></a><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>先前微信端使用的是<span class="exturl" data-url="aHR0cDovL3NjLmZ0cXEuY29tLzMudmVyc2lvbg==" title="http://sc.ftqq.com/3.version">方糖<i class="fa fa-external-link"></i></span>消息推送，但是由于2021年1月27号的一篇关于“<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLndlaXhpbi5xcS5jb20vY29tbXVuaXR5L2RldmVsb3AvZG9jLzAwMGE0ZTFkZjgwMGQ4MmFjYjliN2ZiNWU1YjAwMQ==" title="https://developers.weixin.qq.com/community/develop/doc/000a4e1df800d82acb9b7fb5e5b001">服务号订阅通知灰度测试<i class="fa fa-external-link"></i></span>”的文章中指明灰度测试期至2021年4月30日24:00结束，未来该功能将会何去何从尚未可知。本着未雨绸缪的思想和精神，此时此刻需要物色另一种消息推送的渠道和方式以满足相关的业务需求。</p><p>经过一番了解和考量，我选择使用<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0t1aXBlclNpcml1cy90Z19wdXNoX2JvdA==" title="https://github.com/KuiperSirius/tg_push_bot">tg_push_bot<i class="fa fa-external-link"></i></span>程序来构建我的Telegram消息推送机器人。</p><h3 id="创建机器人"><a href="#创建机器人" class="headerlink" title="创建机器人"></a>创建机器人</h3><p>申请telegram bot，打开<span class="exturl" data-url="aHR0cHM6Ly90Lm1lL2JvdGZhdGhlcg==" title="https://t.me/botfather">@BotFather<i class="fa fa-external-link"></i></span>，点击 /newbot生成新一个的bot，系统会让你给它取一个昵称，方便记忆即可，而后系统会再次让你取一个名字并输入，现在的名字必须以bot结尾，且不可以和其他任何bot重名。一旦你输入的bot名字可用，系统会生成一个token给你，形如123456789:ABcd6asdacssfdvBgHjKoLkkjLu8，请务必保存好此token并且不泄露，这是唯一的用户凭证。</p><p>此时，你已经拥有了一个bot，但是还无法使用，打开 <span class="exturl" data-url="aHR0cHM6Ly90Lm1lL3lvdXJCb3ROYW1l" title="https://t.me/yourBotName">https://t.me/yourBotName<i class="fa fa-external-link"></i></span> 这个链接，注意这里的yourBotName为你刚才新建的bot的名字，点击/start进入对话框，发送@userinfobot后并点击它。在userinfobot的对话中，点击或者输入/start，你将获取一个Id/chat_id，具体表现为一串数字，比如387980691。至此，电报的机器人已经申请完成，你获得了机器人的bot名字，一个token，还有一个chat_id。</p><h3 id="构建程序"><a href="#构建程序" class="headerlink" title="构建程序"></a>构建程序</h3><p>获取源码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/DkWyatt/tg_push_bot.git</span><br><span class="line">cd tg_push_bot</span><br></pre></td></tr></table></figure><p>创建Sqlite3数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt install sqlite3 -y</span><br><span class="line">sqlite3 bot.db</span><br><span class="line"><span class="meta">sqlite&gt;</span><span class="bash"> CREATE TABLE users (chatId int unique, chatToken text unique);</span></span><br><span class="line"><span class="meta">sqlite&gt;</span><span class="bash"> .quit</span></span><br></pre></td></tr></table></figure><p>创建配置文件 config.js，位于tg_push_bot文件夹下。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">https = &#123;&#125;</span><br><span class="line">bot = &#123;&#125;</span><br><span class="line">ui = &#123;&#125;</span><br><span class="line"></span><br><span class="line">https.domain = '0.0.0.0' // 域名</span><br><span class="line">https.privateKey = 'xxx.key' // Key文件</span><br><span class="line">https.certificate = 'xxx.crt' // CSR文件</span><br><span class="line"></span><br><span class="line">bot.token = 'https://api.telegram.org/bot&#123;token&#125;/' // BotFather返回的Token，以/结尾，&#123;&#125;去掉。</span><br><span class="line"></span><br><span class="line">ui.startHint = '您的推送链接: \r\nhttps://tgbot.szc.me/sendMessage/%s' // 用户发送/start时返回的内容，%s表示用户唯一URL</span><br><span class="line">ui.stopHint = "用户记录已经删除，旧链接已经失效\r\n如需继续发送消息，请输入/start重新获取"</span><br><span class="line">ui.userNotExistHint = 'no user' // 用户不存在时的返回内容</span><br><span class="line">ui.httpsTestHint = 'hello from nodejs with https'</span><br><span class="line">ui.errorHint = 'error' // 错误提示</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    https: https,</span><br><span class="line">    bot: bot,</span><br><span class="line">    ui: ui</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面给出一份已经处于生产环境中的config.js</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">https = &#123;&#125;</span><br><span class="line">bot = &#123;&#125;</span><br><span class="line">ui = &#123;&#125;</span><br><span class="line"></span><br><span class="line">https.domain = '0.0.0.0' // 域名。原作者备注这里是填写域名的，我试过填写域名，会导致502 Bad Request。我用的也是这个0.0.0.0。</span><br><span class="line">https.privateKey = '/usr/local/nginx/conf/ssl/kixcs.com/kixcs.com.key' // Key文件</span><br><span class="line">https.certificate = '/usr/local/nginx/conf/ssl/kixcs.com/fullchain.cer' // CSR文件，就是我们把两个文件合并成一个的ssl.crt文件。</span><br><span class="line"></span><br><span class="line">bot.token = 'https://api.telegram.org/bot16676666666:AAaaBBBBBBBBBBaaAAAAA/' // BotFather返回的Token，以/结尾</span><br><span class="line"></span><br><span class="line">ui.startHint = 'Your Info push links address is: \r\nhttps://tgbot.kixcs.com/sendMessage/%s' // 用户发送/start时返回的内容，%s表示用户唯一URL</span><br><span class="line">ui.stopHint = "The user record has been deleted and the old link has expired.\r\n如需继续发送消息，请输入/start重新获取"  //用户记录已经删除，旧链接已经失效</span><br><span class="line">ui.userNotExistHint = 'no user' // 用户不存在时的返回内容</span><br><span class="line">ui.httpsTestHint = 'Hello from nodejs with https(TG_info_push_bot), this program was deployed by https://github.com/Fndroid/tg_push_bot.'</span><br><span class="line">ui.errorHint = 'Something went error:(' // 错误提示</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    https: https,</span><br><span class="line">    bot: bot,</span><br><span class="line">    ui: ui</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改程序运行端口，将server.js 197行443端口修改为8443，本人的配置文件为212行，处于文件末尾。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">httpsServer.listen(8443, config.https.domain, () =&gt; &#123;</span><br><span class="line">    console.log('listening on port 433')</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="配置服务环境"><a href="#配置服务环境" class="headerlink" title="配置服务环境"></a>配置服务环境</h3><p>安装Node.js</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl -sL https://deb.nodesource.com/setup_8.x | sudo -E bash -</span><br><span class="line">sudo apt-get install -y nodejs</span><br><span class="line">npm install #安装依赖（安装完后可能会出现几个warn警告，无伤大雅）</span><br><span class="line">npm install -g pm2 #安装pm2模块</span><br><span class="line">pm2 start server.js #运行服务</span><br><span class="line">pm2 startup #设置开机启动</span><br><span class="line"><span class="meta">#</span><span class="bash">可选   </span></span><br><span class="line"><span class="meta">#</span><span class="bash">保存当前 pm2 运行的各个应用保存到 /root/.pm2/dump.pm2 下，</span></span><br><span class="line"><span class="meta">#</span><span class="bash">开机重启时读取该文件中的内容启动相关</span></span><br><span class="line"><span class="meta">#</span><span class="bash">pm2 save                     </span></span><br></pre></td></tr></table></figure><p>*可选 不同Linux系统发行版本关于Node.js安装的命令行操作或许稍有不同</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">Ubuntu 版本号数字可酌情更改</span></span><br><span class="line">curl -sL https://deb.nodesource.com/setup_9.x | sudo -E bash -</span><br><span class="line">apt-get install -y nodejs</span><br><span class="line"><span class="meta">#</span><span class="bash">Debian</span></span><br><span class="line">curl -sL https://deb.nodesource.com/setup_9.x | bash -</span><br><span class="line">apt-get install -y nodejs</span><br><span class="line"><span class="meta">#</span><span class="bash">CentOS</span></span><br><span class="line">curl -sL https://rpm.nodesource.com/setup_9.x | bash -</span><br><span class="line">yum install nodejs -y</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">查看输出结果判断是否安装成功</span></span><br><span class="line">node -v</span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure><p>*可选 可能会用到的PM2命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pm2 list                      #列表 PM2 启动的所有的应用程序</span><br><span class="line">pm2 restart all               #重启所有程序</span><br><span class="line">pm2 kill                      #终止PM2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">卸载pm2</span></span><br><span class="line">pm2 kill</span><br><span class="line">npm remove pm2 -g</span><br></pre></td></tr></table></figure><p>*可选 卸载npm</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall npm -g</span><br></pre></td></tr></table></figure><h3 id="配置Nginx反向代理"><a href="#配置Nginx反向代理" class="headerlink" title="配置Nginx反向代理"></a>配置Nginx反向代理</h3><p>vhost目录下新建一个配置文件，相关数据替换成自己的网站。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 443 ssl http2;</span><br><span class="line">  ssl_certificate /usr/local/nginx/conf/ssl/ssl.cer;</span><br><span class="line">  ssl_certificate_key /usr/local/nginx/conf/ssl/ssl.key;</span><br><span class="line">  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">  ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;</span><br><span class="line">  ssl_prefer_server_ciphers on;</span><br><span class="line">  ssl_session_timeout 10m;</span><br><span class="line">  ssl_session_cache builtin:1000 shared:SSL:10m;</span><br><span class="line">  ssl_buffer_size 1400;</span><br><span class="line">  add_header Strict-Transport-Security max-age=15768000;</span><br><span class="line">  ssl_stapling on;</span><br><span class="line">  ssl_stapling_verify on;</span><br><span class="line">  server_name your.domain;</span><br><span class="line"><span class="meta">  #</span><span class="bash">access_log /data/wwwlogs/your.domain_nginx.log combined;</span></span><br><span class="line">  </span><br><span class="line">  proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">  proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">  proxy_set_header Host $http_host;</span><br><span class="line">  proxy_set_header X-NginX-Proxy true;</span><br><span class="line"></span><br><span class="line">  proxy_redirect off;</span><br><span class="line"><span class="meta">  #</span><span class="bash"> Socket.IO Support</span></span><br><span class="line">  proxy_http_version 1.1;</span><br><span class="line">  proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">  proxy_set_header Connection "upgrade";</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_pass https://127.0.0.1:8443;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后重启nginx</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service nginx restart</span><br></pre></td></tr></table></figure><p>给出一份部署于生产环境的Nginx vhost文件配置示例</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">server</span><br><span class="line">    &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        #listen [::]:80;</span><br><span class="line">        server_name tgbot.kixcs.com ;     </span><br><span class="line">        #index index.html index.htm index.php default.html default.htm default.php;</span><br><span class="line">        #root  /home/tgbot.kixcs.com;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if ($scheme = http ) &#123;</span><br><span class="line">return 301 https://$host$request_uri;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">        include rewrite/none.conf;</span><br><span class="line">        #error_page   404   /404.html;</span><br><span class="line">        # Deny access to PHP files in specific directory</span><br><span class="line">        #location ~ /(wp-content|uploads|wp-includes|images)/.*\.php$ &#123; deny all; &#125;</span><br><span class="line"></span><br><span class="line">       access_log  /home/wwwlogs/tgbot.kixcs.com.log;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">server</span><br><span class="line">    &#123;</span><br><span class="line">        listen 443 ssl http2;</span><br><span class="line">        #listen [::]:443 ssl http2;</span><br><span class="line">        server_name tgbot.kixcs.com ;</span><br><span class="line">        </span><br><span class="line">        #index index.html index.htm index.php default.html default.htm default.php;</span><br><span class="line">        #root  /home/tgbot.kixcs.com;</span><br><span class="line"></span><br><span class="line">        ssl_certificate /usr/local/nginx/conf/ssl/kixcs.com/fullchain.cer;</span><br><span class="line">        ssl_certificate_key /usr/local/nginx/conf/ssl/kixcs.com/kixcs.com.key;</span><br><span class="line">        ssl_session_timeout 5m;</span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line">        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";</span><br><span class="line">        ssl_session_cache builtin:1000 shared:SSL:10m;</span><br><span class="line">        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048</span><br><span class="line">        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;</span><br><span class="line"></span><br><span class="line">               ssl_stapling on;</span><br><span class="line">             ssl_stapling_verify on;</span><br><span class="line">               ssl_trusted_certificate /usr/local/nginx/conf/ssl/kixcs.com/fullchain.cer;</span><br><span class="line"></span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">  proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">  proxy_set_header Host $http_host;</span><br><span class="line">  proxy_set_header X-NginX-Proxy true;</span><br><span class="line"></span><br><span class="line">  proxy_redirect off;</span><br><span class="line"><span class="meta">  #</span><span class="bash"> Socket.IO Support</span></span><br><span class="line">  proxy_http_version 1.1;</span><br><span class="line">  proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">  proxy_set_header Connection "upgrade";</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_pass https://127.0.0.1:8443;</span><br><span class="line">  &#125;</span><br><span class="line">       access_log  /home/wwwlogs/tgbot.kixcs.com.log;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="设置Bot-webhook地址"><a href="#设置Bot-webhook地址" class="headerlink" title="设置Bot webhook地址"></a>设置Bot webhook地址</h3><p>浏览器访问下面地址，将token和域名替换成自己的地址，记得花括号{}要删去哦。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.telegram.org/bot&#123;token&#125;/setWebhook?url=https://&#123;domain&#125;/inlineQuery</span><br></pre></td></tr></table></figure><p>再通过下面链接检查webhook是否正常</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.telegram.org/bot&#123;token&#125;/getWebhookInfo</span><br></pre></td></tr></table></figure><h3 id="获取推送链接"><a href="#获取推送链接" class="headerlink" title="获取推送链接"></a>获取推送链接</h3><p>添加自己的机器人，输入/start就能获取自己的推送链接了，形如下列代码。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Your Info push links address is: </span><br><span class="line">https://tgbot.kixcs.com/sendMessage/2p32vaaaaaaaa</span><br><span class="line"><span class="meta">#</span><span class="bash">填入推送链接，如https://tgbot.lbyczf.com/sendMessage/:Token</span></span><br><span class="line"><span class="meta">#</span><span class="bash">即为所需链接</span></span><br></pre></td></tr></table></figure><p>推荐使用json格式发送数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H "Content-Type: application/json" -d '&#123;"text":"HelloWorld","disable_notification": true &#125;' -X POST https://tgbot.szc.me/sendMessage/:Token</span><br></pre></td></tr></table></figure><p>可以使用如下链接给我的bot发送消息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H "Content-Type: application/json" -d '&#123;"text":"HelloWorld","disable_notification": true &#125;' -X POST https://tgbot.kixcs.com/sendMessage/2p32va2d4kks5lfrd</span><br></pre></td></tr></table></figure><h3 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h3><p><span class="exturl" data-url="aHR0cHM6Ly9jaHJvbWUuZ29vZ2xlLmNvbS93ZWJzdG9yZS9kZXRhaWwvdGclRTYlOUMlQkElRTUlOTklQTglRTQlQkElQkElRTYlOEUlQTglRTklODAlODEvYWlhZXBsZmJrZm5qb2lpbmVwbWhqZWZwY2JwbWNpZ2Y=" title="https://chrome.google.com/webstore/detail/tg%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A8%E9%80%81/aiaeplfbkfnjoiinepmhjefpcbpmcigf">Chrome应用插件<i class="fa fa-external-link"></i></span>有可能会出现服务器限制跨域，即在插件上输入了推送链接，但是没有反应。</p><p>这时候需要到服务器里面找到server.js，在第20行添加一下内容。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">app.use(function (req, res, next) &#123;</span><br><span class="line">  // Website you wish to allow to connect</span><br><span class="line">  res.setHeader('Access-Control-Allow-Origin', '*');</span><br><span class="line"> </span><br><span class="line">  // Request methods you wish to allow</span><br><span class="line">  res.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS, PUT, PATCH, DELETE');</span><br><span class="line"> </span><br><span class="line">  // Request headers you wish to allow</span><br><span class="line">  res.setHeader('Access-Control-Allow-Headers', 'X-Requested-With,content-type');</span><br><span class="line"> </span><br><span class="line">  // Set to true if you need the website to include cookies in the requests sent</span><br><span class="line">  // to the API (e.g. in case you use sessions)</span><br><span class="line">  res.setHeader('Access-Control-Allow-Credentials', true);</span><br><span class="line"> </span><br><span class="line">  // Pass to next layer of middleware</span><br><span class="line">  next();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>然后cd /文件所在位置，例如cd /home/tg_push_bot ，重启pm2 pm2 restart all 即可。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /home/tg_push_bot</span><br><span class="line">pm2 restart all</span><br></pre></td></tr></table></figure><p>最后附上我的消息推送机器人bot：<span class="exturl" data-url="aHR0cHM6Ly90Lm1lL1JvdXRlcl9zdW1tZXJfYm90" title="https://t.me/Router_summer_bot">Router_bot<i class="fa fa-external-link"></i></span></p><p>鸣谢：<span class="exturl" data-url="aHR0cHM6Ly9zemMubWUvcG9zdC8yLmh0bWw=" title="https://szc.me/post/2.html">Telegram推送机器人<i class="fa fa-external-link"></i></span> <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZuZHJvaWQvdGdfcHVzaF9ib3Q=" title="https://github.com/Fndroid/tg_push_bot">在VPS/ECS上搭建Bot Server<i class="fa fa-external-link"></i></span>  <span class="exturl" data-url="aHR0cHM6Ly9iYW5hbmEtem9uZS50ay9sbm1wLw==" title="https://banana-zone.tk/lnmp/">Chrome插件消息推送跨域问题<i class="fa fa-external-link"></i></span></p>]]></content>
    
    <summary type="html">
    
      &lt;p class=&quot;description&quot;&gt;&lt;/p&gt;
原先一直在软路由上用server酱配合微信实现消息推送，但是最近微信相关政策开始收紧，1月27号微信发布了一条关于下线服务号模板消息功能的通知，即后期有无法使用的可能。于是在找替代品，常见的便是自建服务器实现消息的Push，比如iOS的bark，安卓上的gotify，更小众的有小米用自带的mipush等。但是用起来都需要自建服务，或者面临复杂的编写环境。一个合适的替代品是Telegram bot，支持多种语言，既操作简便又功能众多，倘若只想达到类似server酱的功能，直接导入token并post即可。
    
    </summary>
    
    
      <category term="技术" scheme="https://blog.kixcs.com/categories/technique/"/>
    
    
      <category term="Telegram" scheme="https://blog.kixcs.com/tags/Telegram/"/>
    
  </entry>
  
  <entry>
    <title>OpenWebRX：配合RTL-SDR设备可视化SDRSharp</title>
    <link href="https://blog.kixcs.com/archives/9f33/"/>
    <id>https://blog.kixcs.com/archives/9f33/</id>
    <published>2021-01-28T14:39:19.000Z</published>
    <updated>2021-02-07T13:37:48.592Z</updated>
    
    <content type="html"><![CDATA[<p class="description"></p>RTL-SDR是一个具有DVB-T USB接口的接收器，该设备广泛应用于软件定义无线电领域，DVB-T接收器基于Realtek的RTL2832U芯片外加一个诸如Elonics E4000一类的高频头而构成。RTL2832U芯片有一些没有用到的命令/寄存器，基于此便可将其配置使得可以将没有处理的原始的基带采样信号（可高达 2.8 MS/s 8-bit I+Q)通过高速USB传递到PC，最后到达GNURadio。而OpenWebRX是具有Web界面的多用户SDR接收器软件，较为遗憾的是该程序的作者已经宣布自2019年12月29日起不再维护该仓库。<a id="more"></a><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hhN2lsbS9vcGVud2Vicng=" title="https://github.com/ha7ilm/openwebrx">OpenWebRX<i class="fa fa-external-link"></i></span>可以支持基于csdr的解调器（AM/FM/SSB/CW/BPSK31），可以通过GUI设置滤波器通带，瀑布流显示并且可以向后移动，当前支持RTL-SDR，HackRF，SDRplay，AirSpy和许多其他设备，该Web界面运行于8073端口。</p><p>唯一美中不足的是，该程序不支持广播电台的WFM，仅支持NFM方式。</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>下面开始介绍手动安装OpenWebRX的过程，本人是基于Raspberry Pi 3的开发板，安装树莓派官方Pi Buster系统构建而来，具体关于frp的部分可以参考本人博客的另一篇文章：<a href="https://blog.kixcs.com/archives/adb7/">树莓派配合frp内网穿透及ADS-B信号捕获的应用</a>。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">安装编译时必要的包</span></span><br><span class="line">root@pi:/home# curl https://raw.githubusercontent.com/bclswl0827/openwebrx-installer/master/rtl-sdr_installer.sh | bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">拉取 RTL-SDR 之驱动源码并编译</span></span><br><span class="line">root@pi:/home# git clone https://github.com/keenerd/rtl-sdr.git</span><br><span class="line">root@pi:/home# cd rtl-sdr</span><br><span class="line">root@pi:/home/rtl-sdr# mkdir build</span><br><span class="line">root@pi:/home/rtl-sdr# cd build</span><br><span class="line">root@pi:/home/rtl-sdr/build# cmake ../ -DDETACH_KERNEL_DRIVER=ON -DINSTALL_UDEV_RULES=ON</span><br><span class="line">root@pi:/home/rtl-sdr/build# make</span><br><span class="line">root@pi:/home/rtl-sdr/build# make install</span><br><span class="line">root@pi:/home/rtl-sdr/build# ldconfig</span><br><span class="line">root@pi:/home/rtl-sdr/build# cd /home</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">然后拉取OpenWebRX及其依赖项csdr的源码，并编译 csdr。</span></span><br><span class="line">root@pi:/home# git clone https://github.com/simonyiszk/openwebrx.git</span><br><span class="line">root@pi:/home# git clone https://github.com/jketterl/csdr</span><br><span class="line">root@pi:/home# cd csdr</span><br><span class="line">root@pi:/home/csdr# git checkout 32958ce37eb765f7f5511fe5f7c2c244c13f264b</span><br><span class="line">root@pi:/home/csdr# make</span><br><span class="line">root@pi:/home/csdr# make install</span><br><span class="line">root@pi:/home/csdr# cd /home</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">某些内核模块会锁定 USB 设备，需要在使用 SDR 设备之前将其禁用。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">如果内核模块未正确列入黑名单，则可能会出现 Device not found 的错误。</span></span><br><span class="line">root@pi:/home# bash -c 'echo -e "\n# for RTL-SDR:\nblacklist dvb_usb_rtl28xxu\n" &gt;&gt; /etc/modprobe.d/blacklist.conf'</span><br><span class="line">root@pi:/home# update-initramfs -u</span><br><span class="line">root@pi:/home# rmmod dvb_usb_rtl28xxu</span><br><span class="line"><span class="meta">#</span><span class="bash">倘若执行第三条命令出现错误，属于正常现象，等待程序安装完成即可。</span></span><br></pre></td></tr></table></figure><p>之后需要进行的就是测试该设备是否正常工作，插入 RTL-SDR，然后重启系统。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@pi:~# lsusb</span><br><span class="line">Bus 004 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub</span><br><span class="line">Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br><span class="line">Bus 003 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub</span><br><span class="line">Bus 001 Device 002: ID 0bda:2838 Realtek Semiconductor Corp. RTL2838 DVB-T</span><br><span class="line">Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br></pre></td></tr></table></figure><p>列出 USB 设备，RTL-SDR 位列其中。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@pi:~# cd /home/openwebrx</span><br><span class="line"><span class="meta">#</span><span class="bash">运行命令，可使用screen -S [screen_name]后台运行，screen -r [screen_name]恢复</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Ctrl+a+d最小化 当然也可以写成service作为系统服务开机自动运行</span></span><br><span class="line">root@pi:/home/openwebrx# ./openwebrx.py</span><br></pre></td></tr></table></figure><h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>运行OpenWebRX以测试，倘若一切正常，命令行显示字样如下所示，即安装成功。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">OpenWebRX - Open Source SDR Web App for Everyone!  | for license see LICENSE file in the package</span><br><span class="line">_________________________________________________________________________________________________</span><br><span class="line"></span><br><span class="line">Author contact info:    Andras Retzler, HA7ILM &lt;randras@sdr.hu&gt;</span><br><span class="line"></span><br><span class="line">[openwebrx-main] Configuration script not specified. I will use: "config_webrx.py"</span><br><span class="line">[openwebrx-main] nmux_bufsize = 253952, nmux_bufcnt = 505</span><br><span class="line">[openwebrx-main] Started rtl_thread: rtl_sdr -D2 -s 2048000 -f 9500000 -p 0 -g 90 -| nmux --bufsize 253952 --bufcnt 505 --port 4951 --address 127.0.0.1</span><br><span class="line">[openwebrx-main] Waiting for I/Q server to start...</span><br><span class="line">nmux: listening on 127.0.0.1:4951</span><br><span class="line">Found 1 device(s):</span><br><span class="line">  0:  Realtek, RTL2838UHIDIR, SN: 00000001</span><br><span class="line"></span><br><span class="line">Using device 0: Generic RTL2832U OEM</span><br><span class="line">[openwebrx-main] I/Q server started.</span><br><span class="line">[openwebrx-main] Starting watchdog threads.</span><br><span class="line">nmux: pthread_create() done, clients now: 1</span><br><span class="line">client 0x231a0f8: started!</span><br><span class="line">[openwebrx-main] Starting spectrum thread.</span><br><span class="line">[openwebrx-spectrum] Spectrum thread initialized successfully.</span><br><span class="line">[openwebrx-dsp-plugin:csdr] Command = nc -v 127.0.0.1 4951 | csdr convert_u8_f | csdr fft_cc 2048 204 | csdr logaveragepower_cf -70 2048 1628 | csdr fft_exchange_sides_ff 2048 | csdr compress_fft_adpcm_f_u8 2048</span><br><span class="line">[openwebrx-main] Starting HTTP server.</span><br><span class="line">[openwebrx-spectrum] Spectrum thread started.</span><br><span class="line">nmux: pthread_create() done, clients now: 2</span><br><span class="line">client 0x231a1e0: started!</span><br><span class="line">Connection to 127.0.0.1 4951 port [tcp/*] succeeded!</span><br><span class="line">Found Rafael Micro R820T tuner</span><br><span class="line">Enabled direct sampling mode, input 2</span><br><span class="line">Enabled direct sampling mode, input 2/Q.</span><br><span class="line">Exact sample rate is: 20480000.026491 Hz</span><br><span class="line">Sampling at 20480000 S/s.</span><br><span class="line">Tuned to 9500000 Hz.</span><br><span class="line">Tuner gain set to 49.60 dB.</span><br><span class="line">Reading samples in async mode...</span><br><span class="line">Allocating 15 zero-copy buffers</span><br><span class="line">client 0x231a0f8: CS_THREAD_FINISHED, client_goto_source = 2, errno = 32</span><br></pre></td></tr></table></figure><h3 id="自定义配置"><a href="#自定义配置" class="headerlink" title="自定义配置"></a>自定义配置</h3><p>修改配置文件config_webrx.py，该文件路径为：/home/openwebrx/config_webrx.py 。代码如下所示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">"""</span><br><span class="line">config_webrx: configuration options for OpenWebRX</span><br><span class="line"></span><br><span class="line">    This file is part of OpenWebRX,</span><br><span class="line">    an open-source SDR receiver software with a web UI.</span><br><span class="line">    Copyright (c) 2013-2015 by Andras Retzler &lt;randras@sdr.hu&gt;</span><br><span class="line"></span><br><span class="line">    This program is free software: you can redistribute it and/or modify</span><br><span class="line">    it under the terms of the GNU Affero General Public License as</span><br><span class="line">    published by the Free Software Foundation, either version 3 of the</span><br><span class="line">    License, or (at your option) any later version.</span><br><span class="line"></span><br><span class="line">    This program is distributed in the hope that it will be useful,</span><br><span class="line">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span><br><span class="line">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><br><span class="line">    GNU Affero General Public License for more details.</span><br><span class="line"></span><br><span class="line">    You should have received a copy of the GNU Affero General Public License</span><br><span class="line">    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span><br><span class="line"></span><br><span class="line">    ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line"></span><br><span class="line">    In addition, as a special exception, the copyright holders</span><br><span class="line">    state that config_rtl.py and config_webrx.py are not part of the</span><br><span class="line">    Corresponding Source defined in GNU AGPL version 3 section 1.</span><br><span class="line"></span><br><span class="line">    (It means that you do not have to redistribute config_rtl.py and</span><br><span class="line">    config_webrx.py if you make any changes to these two configuration files,</span><br><span class="line">    and use them for running your web service with OpenWebRX.)</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> NOTE: you can find additional information about configuring OpenWebRX <span class="keyword">in</span> the Wiki:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       https://github.com/simonyiszk/openwebrx/wiki</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ==== Server settings ====</span></span><br><span class="line">web_port=8073</span><br><span class="line">server_hostname="sdr.kixcs.com" # If this contains an incorrect value, the web UI may freeze on load (it can't open websocket)</span><br><span class="line">max_clients=20</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ==== Web GUI configuration ====</span></span><br><span class="line">receiver_name="RTL-SDR Radio"</span><br><span class="line">receiver_location="Zhengzhou , Henan, China"</span><br><span class="line">receiver_qra="OM64tr"</span><br><span class="line">receiver_asl=200</span><br><span class="line">receiver_ant="Longwire"</span><br><span class="line">receiver_device="RTL-SDR"</span><br><span class="line">receiver_admin="gyh1298058589@gmail.com"</span><br><span class="line">receiver_gps=(34.000, 114.000)</span><br><span class="line">photo_height=350</span><br><span class="line">photo_title="Panorama of Budapest from Sch枚nherz Zolt谩n Dormitory"</span><br><span class="line">photo_desc="""</span><br><span class="line">You can add your own background photo and receiver information.&lt;br /&gt;</span><br><span class="line">Receiver is operated by: &lt;a href="mailto:%[RX_ADMIN]"&gt;%[RX_ADMIN]&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">Device: %[RX_DEVICE]&lt;br /&gt;</span><br><span class="line">Antenna: %[RX_ANT]&lt;br /&gt;</span><br><span class="line">Welcome to visit my Website: &lt;a href="https://kixcs.com" target="_blank"&gt;https://kixcs.com&lt;/a&gt;</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ==== sdr.hu listing ====</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you want your ham receiver to be listed publicly on sdr.hu, <span class="keyword">then</span> take the following steps:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1. Register at: http://sdr.hu/register</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. You will get an unique key by email. Copy it and paste here:</span></span><br><span class="line">sdrhu_key = ""</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. Set this setting to True to <span class="built_in">enable</span> listing:</span></span><br><span class="line">sdrhu_public_listing = False</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ==== DSP/RX settings ====</span></span><br><span class="line">fft_fps=9</span><br><span class="line">fft_size=4096 #Should be power of 2</span><br><span class="line">fft_voverlap_factor=0.3 #If fft_voverlap_factor is above 0, multiple FFTs will be used for creating a line on the diagram.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> samp_rate = 250000</span></span><br><span class="line">samp_rate = 2048000</span><br><span class="line">center_freq = 93900000</span><br><span class="line">rf_gain = 0 #in dB. For an RTL-SDR, rf_gain=0 will set the tuner to auto gain mode, else it will be in manual gain mode.</span><br><span class="line">ppm = 0</span><br><span class="line"></span><br><span class="line">audio_compression="adpcm" #valid values: "adpcm", "none"</span><br><span class="line">fft_compression="adpcm" #valid values: "adpcm", "none"</span><br><span class="line"></span><br><span class="line">digimodes_enable=True #Decoding digimodes come with higher CPU usage. </span><br><span class="line">digimodes_fft_size=2048</span><br><span class="line"></span><br><span class="line">start_rtl_thread=True</span><br><span class="line"></span><br><span class="line">"""</span><br><span class="line">Note: if you experience audio underruns while CPU usage is 100%, you can: </span><br><span class="line">- decrease `samp_rate`,</span><br><span class="line">- set `fft_voverlap_factor` to 0,</span><br><span class="line">- decrease `fft_fps` and `fft_size`,</span><br><span class="line">- limit the number of users by decreasing `max_clients`.</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ==== I/Q sources ====</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (Uncomment the appropriate by removing <span class="comment"># characters at the beginning of the corresponding lines.)</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Is my SDR hardware supported?                                                                 <span class="comment">#</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check here: https://github.com/simonyiszk/openwebrx/wiki<span class="comment">#guides-for-receiver-hardware-support #</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################################################################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> You can use other SDR hardware as well, by giving your own <span class="built_in">command</span> that outputs the I/Q samples... Some examples of configuration are available here (default is RTL-SDR):</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> &gt;&gt; RTL-SDR via rtl_sdr</span></span><br><span class="line"></span><br><span class="line">start_rtl_command="rtl_sdr -s &#123;samp_rate&#125; -f &#123;center_freq&#125; -p &#123;ppm&#125; -g &#123;rf_gain&#125; -".format(rf_gain=rf_gain, center_freq=center_freq, samp_rate=samp_rate, ppm=ppm)</span><br><span class="line"><span class="meta">#</span><span class="bash">start_rtl_command=<span class="string">"rtl_sdr -D2 -s &#123;samp_rate&#125; -f &#123;center_freq&#125; -p &#123;ppm&#125; -g &#123;rf_gain&#125; -"</span>.format(rf_gain=rf_gain, center_freq=center_freq, samp_rate=samp_rate, ppm=ppm) </span></span><br><span class="line">format_conversion="csdr convert_u8_f"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">lna_gain=8</span></span><br><span class="line"><span class="meta">#</span><span class="bash">rf_amp=1</span></span><br><span class="line"><span class="meta">#</span><span class="bash">start_rtl_command=<span class="string">"hackrf_transfer -s &#123;samp_rate&#125; -f &#123;center_freq&#125; -g &#123;rf_gain&#125; -l&#123;lna_gain&#125; -a&#123;rf_amp&#125; -r-"</span>.format(rf_gain=rf_gain, center_freq=center_freq, samp_rate=samp_rate, ppm=ppm, rf_amp=rf_amp, lna_gain=lna_gain)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">format_conversion=<span class="string">"csdr convert_s8_f"</span></span></span><br><span class="line">"""</span><br><span class="line">To use a HackRF, compile the HackRF host tools from its "stdout" branch:</span><br><span class="line"> git clone https://github.com/mossmann/hackrf/</span><br><span class="line"> cd hackrf</span><br><span class="line"> git fetch</span><br><span class="line"> git checkout origin/stdout</span><br><span class="line"> cd host</span><br><span class="line"> mkdir build</span><br><span class="line"> cd build</span><br><span class="line"> cmake .. -DINSTALL_UDEV_RULES=ON</span><br><span class="line"> make</span><br><span class="line"> sudo make install</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> &gt;&gt; Sound card SDR (needs ALSA)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> I did not have the chance to properly <span class="built_in">test</span> it.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">samp_rate = 96000</span></span><br><span class="line"><span class="meta">#</span><span class="bash">start_rtl_command=<span class="string">"arecord -f S16_LE -r &#123;samp_rate&#125; -c2 -"</span>.format(samp_rate=samp_rate)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">format_conversion=<span class="string">"csdr convert_s16_f | csdr gain_ff 30"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> &gt;&gt; /dev/urandom <span class="built_in">test</span> signal <span class="built_in">source</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> samp_rate = 2400000</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> start_rtl_command=<span class="string">"cat /dev/urandom | (pv -qL `python -c 'print int(&#123;samp_rate&#125; * 2.2)'` 2&gt;&amp;1)"</span>.format(rf_gain=rf_gain, center_freq=center_freq, samp_rate=samp_rate)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> format_conversion=<span class="string">"csdr convert_u8_f"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> &gt;&gt; Pre-recorded raw I/Q file as signal <span class="built_in">source</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> You will have to correctly specify: samp_rate, center_freq, format_conversion <span class="keyword">in</span> order to correctly play an I/Q file.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">start_rtl_command=<span class="string">"(while true; do cat my_iq_file.raw; done) | csdr flowcontrol &#123;sr&#125; 20 "</span>.format(sr=samp_rate*2*1.05)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">format_conversion=<span class="string">"csdr convert_u8_f"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt; The rx_sdr <span class="built_in">command</span> works with a variety of SDR harware: RTL-SDR, HackRF, SDRplay, UHD, Airspy, Red Pitaya, audio devices, etc. </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> It will auto-detect your SDR hardware <span class="keyword">if</span> the following tools are installed:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> * the vendor provided driver and library, </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> * the vendor-specific SoapySDR wrapper library, </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> * and SoapySDR itself.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check out this article on the OpenWebRX Wiki: https://github.com/simonyiszk/openwebrx/wiki/Using-rx_tools-with-OpenWebRX/</span></span><br><span class="line"><span class="meta">#</span><span class="bash">start_rtl_command=<span class="string">"rx_sdr -F CF32 -s &#123;samp_rate&#125; -f &#123;center_freq&#125; -p &#123;ppm&#125; -g &#123;rf_gain&#125; -"</span>.format(rf_gain=rf_gain, center_freq=center_freq, samp_rate=samp_rate, ppm=ppm)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">format_conversion=<span class="string">""</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> &gt;&gt; gr-osmosdr signal <span class="built_in">source</span> using GNU Radio (follow this guide: https://github.com/simonyiszk/openwebrx/wiki/Using-GrOsmoSDR-as-signal-source)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">start_rtl_command=<span class="string">"cat /tmp/osmocom_fifo"</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">format_conversion=<span class="string">""</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ==== Misc settings ====</span></span><br><span class="line"></span><br><span class="line">shown_center_freq = center_freq #you can change this if you use an upconverter</span><br><span class="line"></span><br><span class="line">client_audio_buffer_size = 5</span><br><span class="line"><span class="meta">#</span><span class="bash">increasing client_audio_buffer_size will:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> - also increase the latency</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> - decrease the chance of audio underruns</span></span><br><span class="line"></span><br><span class="line">start_freq = 93900000</span><br><span class="line">start_mod = "nfm" #nfm, am, lsb, usb, cw</span><br><span class="line"></span><br><span class="line">iq_server_port = 4951 #TCP port for ncat to listen on. It will send I/Q data over its connections, for internal use in OpenWebRX. It is only accessible from the localhost by default.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">access_log = <span class="string">"~/openwebrx_access.log"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ==== Color themes ====</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">A guide is available to <span class="built_in">help</span> you <span class="built_in">set</span> these values: https://github.com/simonyiszk/openwebrx/wiki/Calibrating-waterfall-display-levels</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## default theme by teejez:</span></span></span><br><span class="line">waterfall_colors = "[0x000000ff,0x0000ffff,0x00ffffff,0x00ff00ff,0xffff00ff,0xff0000ff,0xff00ffff,0xffffffff]"</span><br><span class="line">waterfall_min_level = -89 #in dB</span><br><span class="line">waterfall_max_level = -18</span><br><span class="line">waterfall_auto_level_margin = (5, 40)</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## old theme by HA7ILM:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">waterfall_colors = <span class="string">"[0x000000ff,0x2e6893ff, 0x69a5d0ff, 0x214b69ff, 0x9dc4e0ff,  0xfff775ff, 0xff8a8aff, 0xb20000ff]"</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">waterfall_min_level = -115 <span class="comment">#in dB</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">waterfall_max_level = 0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">waterfall_auto_level_margin = (20, 30)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#For the old colors, you might also want to set [fft_voverlap_factor] to 0.</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">Note: When the auto waterfall level button is clicked, the following happens:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   [waterfall_min_level] = [current_min_power_level] - [waterfall_auto_level_margin[0]]</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   [waterfall_max_level] = [current_max_power_level] + [waterfall_auto_level_margin[1]]</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   ___|____________________________________|____________________________________|____________________________________|___&gt; signal power</span></span><br><span class="line"><span class="meta">#</span><span class="bash">        \_waterfall_auto_level_margin[0]_/ |__ current_min_power_level          | \_waterfall_auto_level_margin[1]_/</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                                                      current_max_power_level __|</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3D view settings</span></span><br><span class="line">mathbox_waterfall_frequency_resolution = 128 #bins</span><br><span class="line">mathbox_waterfall_history_length = 10 #seconds</span><br><span class="line">mathbox_waterfall_colors = "[0x000000ff,0x2e6893ff, 0x69a5d0ff, 0x214b69ff, 0x9dc4e0ff,  0xfff775ff, 0xff8a8aff, 0xb20000ff]"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> === Experimental settings ===</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Warning! The settings below are very experimental.</span></span><br><span class="line">csdr_dynamic_bufsize = False # This allows you to change the buffering mode of csdr.</span><br><span class="line">csdr_print_bufsizes = False  # This prints the buffer sizes used for csdr processes.</span><br><span class="line">csdr_through = False # Setting this True will print out how much data is going into the DSP chains.</span><br><span class="line"></span><br><span class="line">nmux_memory = 50 #in megabytes. This sets the approximate size of the circular buffer used by nmux.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">Look up external IP address automatically from icanhazip.com, and use it as [server_hostname]</span></span><br><span class="line">"""</span><br><span class="line">print "[openwebrx-config] Detecting external IP address..."</span><br><span class="line">import urllib2</span><br><span class="line">server_hostname=urllib2.urlopen("http://icanhazip.com").read()[:-1]</span><br><span class="line">print "[openwebrx-config] External IP address detected:", server_hostname</span><br><span class="line">"""</span><br></pre></td></tr></table></figure><h3 id="frp映射至公网"><a href="#frp映射至公网" class="headerlink" title="frp映射至公网"></a>frp映射至公网</h3><p>不用多说，这里介绍一种本人正在使用的通解通法，frp配置Nginx反向代理至frps端口来使用，下面给出Nginx虚拟主机配置文件。</p><p>注:这里7080端口为frps服务端http代理端口，映射流程大抵为域名的https 443端口反向代理至frps http的7080端口，再在frpc（旁路由或者连接至互联网的本地设备的frp客户端）中设置自定义域名，设置http协议类型，远程端口7080，并且本地端口为该程序OpenWebRX的8073端口，即可完成映射。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">server</span><br><span class="line">    &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name ***;</span><br><span class="line">        </span><br><span class="line">        if ($scheme = http ) &#123;</span><br><span class="line">        return 301 https://$host$request_uri;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line"> location /&#123;</span><br><span class="line">            proxy_pass http://127.0.0.1:7080/;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_hide_header X-Powered-By;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">       access_log  /home/wwwlogs/***;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">server</span><br><span class="line">    &#123;</span><br><span class="line">        listen 443 ssl http2;</span><br><span class="line">        server_name ***;</span><br><span class="line">        </span><br><span class="line">        ssl_certificate /usr/local/nginx/conf/ssl/kixcs.com/kixcs.com.cer;</span><br><span class="line">        ssl_certificate_key /usr/local/nginx/conf/ssl/kixcs.com/kixcs.com.key;</span><br><span class="line">        ssl_session_timeout 5m;</span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line">        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";</span><br><span class="line">        ssl_session_cache builtin:1000 shared:SSL:10m;</span><br><span class="line">        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048</span><br><span class="line">        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;</span><br><span class="line"></span><br><span class="line">           location / &#123;</span><br><span class="line">              #关于frp与Nginx配合使用的问题：https://blog.csdn.net/rfrftt/article/details/89317529</span><br><span class="line">              #https://www.v2ex.com/t/378393</span><br><span class="line">              proxy_pass http://127.0.0.1:7080/;</span><br><span class="line">              proxy_ssl_server_name on;</span><br><span class="line">              proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">              proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">              proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">              proxy_set_header Host $host;</span><br><span class="line">              add_header Content-Security-Policy upgrade-insecure-requests;</span><br><span class="line">                        </span><br><span class="line">        &#125;</span><br><span class="line">             </span><br><span class="line">         location /ws/&#123;</span><br><span class="line">            proxy_pass http://127.0.0.1:7080/ws/;</span><br><span class="line">            proxy_redirect off;</span><br><span class="line">            proxy_http_version 1.1;</span><br><span class="line">            proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">            proxy_set_header Connection "upgrade";</span><br><span class="line">            proxy_set_header Host $http_host;                       </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        access_log  /home/wwwlogs/***.log;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="配置WebSockets（可选）"><a href="#配置WebSockets（可选）" class="headerlink" title="配置WebSockets（可选）"></a>配置WebSockets（可选）</h3><p>关于这部分内容，详细步骤可以移步开发者<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hhN2lsbS9vcGVud2Vicngvd2lraS9TcGVlZC11cC0mLVNlY3VyZS13aXRoLUNsb3VkRmxhcmU=" title="https://github.com/ha7ilm/openwebrx/wiki/Speed-up-&-Secure-with-CloudFlare">ha7ilm<i class="fa fa-external-link"></i></span>的Github仓库，在此感谢<span class="exturl" data-url="aHR0cHM6Ly9pYmNsLnVzL1JUTFNEUi1Nb2RpZnlpbmdfMjAxOTAzMjMv" title="https://ibcl.us/RTLSDR-Modifying_20190323/">ibcl.us<i class="fa fa-external-link"></i></span>做出的汉化工作。</p><p>关于WebSockets，能赘述的内容实在有限，在不开启CDN的情况下无需去考虑这个问题，倘若你希望你所有的二级域名都配置CDN，那么你需要考虑你的站点所选择的CDN是否支持WebSockets这种用于服务端主动推送协议（比方说弹幕，消息推送等待），Cloudflare CDN/阿里云的全站加速DCDN，抑或是腾讯云CDN应该都可以较为完善的支持该协议。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">纵然 CloudFlare 已经要求用户与服务器通信实现底层安全协议传输，但是OpenWebRX仍然会让用户与后端建立未加密的WebSocket连接，即ws://，而不是wss://。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">所以接下来修改openwebrx.js这个文件（位于OpenWebRX目录的htdocs文件夹）第1698行，将 ws_url=<span class="string">"ws://"</span>+(window.location.origin.split(<span class="string">"://"</span>)[1])+<span class="string">"/ws/"</span>;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">修改为 ws_url=<span class="string">"wss://***/ws/"</span>;，这里的***填写你的域名。然后修改OpenWebRX的核心文件（位于OpenWebRX根目录）openwebrx.py，第673行，</span></span><br><span class="line"><span class="meta">#</span><span class="bash">将ws_url=<span class="string">"ws://"</span>+(window.location.origin.split(<span class="string">"://"</span>)[1])+<span class="string">"/ws/"</span>; 修改为 ws_url=<span class="string">"wss://***/ws/"</span>; 。最后重启OpenWebRX即可。</span></span><br></pre></td></tr></table></figure><h3 id="终章"><a href="#终章" class="headerlink" title="终章"></a>终章</h3><p>感谢<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hhN2lsbS9vcGVud2Vicng=" title="https://github.com/ha7ilm/openwebrx">OpenWebRX官方Github仓库<i class="fa fa-external-link"></i></span>，<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLnNkci5odS8=" title="https://blog.sdr.hu/">OpenWebRX开发者<i class="fa fa-external-link"></i></span>，尤其感谢<span class="exturl" data-url="aHR0cHM6Ly9pYmNsLnVzL1JUTFNEUi1Nb2RpZnlpbmdfMjAxOTAzMjMv" title="https://ibcl.us/RTLSDR-Modifying_20190323/">一位优秀的高中生小伙伴<i class="fa fa-external-link"></i></span>一直以来给我的热心帮助和耐心解答，同时也祝你学业有成，天天开心 :)</p>]]></content>
    
    <summary type="html">
    
      &lt;p class=&quot;description&quot;&gt;&lt;/p&gt;
RTL-SDR是一个具有DVB-T USB接口的接收器，该设备广泛应用于软件定义无线电领域，DVB-T接收器基于Realtek的RTL2832U芯片外加一个诸如Elonics E4000一类的高频头而构成。RTL2832U芯片有一些没有用到的命令/寄存器，基于此便可将其配置使得可以将没有处理的原始的基带采样信号（可高达 2.8 MS/s 8-bit I+Q)通过高速USB传递到PC，最后到达GNURadio。而OpenWebRX是具有Web界面的多用户SDR接收器软件，较为遗憾的是该程序的作者已经宣布自2019年12月29日起不再维护该仓库。
    
    </summary>
    
    
      <category term="技术" scheme="https://blog.kixcs.com/categories/technique/"/>
    
    
      <category term="OpenWebRX" scheme="https://blog.kixcs.com/tags/OpenWebRX/"/>
    
      <category term="RTL-SDR" scheme="https://blog.kixcs.com/tags/RTL-SDR/"/>
    
      <category term="SDRSharp" scheme="https://blog.kixcs.com/tags/SDRSharp/"/>
    
  </entry>
  
  <entry>
    <title>树莓派配合frp内网穿透及ADS-B信号捕获的应用</title>
    <link href="https://blog.kixcs.com/archives/adb7/"/>
    <id>https://blog.kixcs.com/archives/adb7/</id>
    <published>2021-01-10T14:04:18.000Z</published>
    <updated>2021-01-31T14:57:45.837Z</updated>
    
    <content type="html"><![CDATA[<p class="description"></p>通常情况下对于公网环境下访问局域网设备的需求而言，其解决方案有使用动态域名解析DDNS以及各种内网穿透工具(如Frp，Ngrok等等)。对于DDNS方式和Frp而言，两种方式各有千秋。首先对于动态域名解析，其基本要求是本地网关设备能够获取到运营商提供的公网IPv4地址，这对大多数中国移动宽带和部分地区中国电信宽带用户而言或许会有一些困扰；对于Frp内网穿透方式则无需苛刻的条件，只需要一台具有公网IPv4地址的服务器即可，进而间接的通过该服务器建立公网到局域网的逻辑链路访问。<a id="more"></a><h3 id="frp相关配置"><a href="#frp相关配置" class="headerlink" title="frp相关配置"></a>frp相关配置</h3><p>首先先给出<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZhdGVkaWVyL2ZycC9ibG9iL21hc3Rlci9SRUFETUVfemgubWQ=" title="https://github.com/fatedier/frp/blob/master/README_zh.md">frp中文文档<i class="fa fa-external-link"></i></span>的Github地址，简而言之，frp是一个可用于内网穿透的高性能的反向代理应用，支持tcp,udp协议，并且为http和https应用协议提供了额外的能力，其中对于http协议的内网穿透还支持配置用户名和密码以保证安全。<br>服务器端安装<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZhdGVkaWVyL2ZycC9yZWxlYXNlcw==" title="https://github.com/fatedier/frp/releases">frp<i class="fa fa-external-link"></i></span>，服务器端为x86 64位主机，需要选择例如“frp_0.34.3_linux_amd64.tar.gz”字样的安装包，复制链接地址，wget直接下载到当前目录，并使用tar -zxvf frp_0.34.3_linux_amd64.tar.gz解压该软件包即可。倘若此时就希望运行frp测试是否可以启动成功，可以运行./frps -c frps.ini以测试。<br>其次对于服务器上运行的frp，通常情况下是需要后台持续运行该进程的，可以用screen窗口来维持frp后台，这里我更推荐将frp写入系统的service服务中去，既可以后台运行，又可以开机自启，感谢这位Youtuber<span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1LZWVjVWhoZklFOA==" title="https://www.youtube.com/watch?v=KeecUhhfIE8">司波图<i class="fa fa-external-link"></i></span>给予的灵感。</p><p>下面给出frp.service的配置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">服务器运行服务创建</span></span><br><span class="line">vi /lib/systemd/system/frps.service</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">Frps服务命令</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=fraps service</span><br><span class="line">After=network.target syslog.target</span><br><span class="line">Wants=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/root/frp/frps -c /root/frp/frps.ini  </span><br><span class="line"><span class="meta">#</span><span class="bash">此处安实际情况修改，该路径为frp安装目录。</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>之后需要注册服务以及配置开机自启，命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">frp注册服务</span></span><br><span class="line">systemctl start frps</span><br><span class="line">systemctl enable frps</span><br><span class="line"><span class="meta">#</span><span class="bash">倘若有需要查看该frp服务状态</span></span><br><span class="line">service frps status</span><br><span class="line"><span class="meta">#</span><span class="bash">查看后台正在运行的进程</span></span><br><span class="line">ps -auxw</span><br></pre></td></tr></table></figure><p>下面给出frps服务端配置文件frps.ini中的内容以供参考：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">bind_port = 7000</span><br><span class="line">token = ***</span><br><span class="line">vhost_http_port = 7080</span><br><span class="line">vhost_https_port = 7443</span><br><span class="line">dashboard_port = 7001</span><br><span class="line">dashboard_user = root</span><br><span class="line">dashboard_pwd = ***</span><br><span class="line">tcp_mux = true</span><br><span class="line">max_pool_count = 10</span><br></pre></td></tr></table></figure><p>配置完成服务器端的frps后，便是配置客户端中的详细参数了。由于本人的frp客户端是OpenWRT软路由GUI图形界面，参考意义不大，重要的是设置好需要映射的本地端口和密码即可，故配置略。</p><h3 id="树莓派相关配置"><a href="#树莓派相关配置" class="headerlink" title="树莓派相关配置"></a>树莓派相关配置</h3><p>树莓派家族的硬件设备有官方提供的镜像，也可以刷入Debian/Ubuntu系列的第三方镜像，其实官方提供的树莓派Raspberry Pi Buster系统号称可以兼容所有树莓派板子型号，其系统也是基于Debian开发而来。<br>首先下载<span class="exturl" data-url="aHR0cHM6Ly9kb3dubG9hZHMucmFzcGJlcnJ5cGkub3JnL3Jhc3Bpb3NfZnVsbF9hcm1oZi9pbWFnZXMvcmFzcGlvc19mdWxsX2FybWhmLTIwMjAtMTItMDQvMjAyMC0xMi0wMi1yYXNwaW9zLWJ1c3Rlci1hcm1oZi1mdWxsLnppcA==" title="https://downloads.raspberrypi.org/raspios_full_armhf/images/raspios_full_armhf-2020-12-04/2020-12-02-raspios-buster-armhf-full.zip">Raspberry Pi Buster<i class="fa fa-external-link"></i></span>，之后将此.img文件/镜像刷入SD卡中，我使用的刷入软件名为：balenaEtcher，看官们也可以选择你所熟悉和顺手的软件。<br>之后在boot分区下新建一个空文件，名为ssh，就可以开启SSH命令行登录，再在boot分区下新建wpa_supplicant.conf文件，并写入无线的相关配置。为了不泄漏信息，下面只是示例，可以同时配置多个无线网络。当然，我们也可以直接使用RJ-45网线接入路由器，进入路由器后台查看该树莓派设备的IP地址，进行IP地址和MAC地址的绑定。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">country=CN</span><br><span class="line">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev</span><br><span class="line">update_config=1</span><br><span class="line"> </span><br><span class="line">network=&#123;</span><br><span class="line">    ssid="wifi名"</span><br><span class="line">    psk="wifi密码"</span><br><span class="line">    key_mgmt=WPA-PSK #加密方式</span><br><span class="line">    priority=1 #优先级</span><br><span class="line">&#125;</span><br><span class="line">network=&#123;</span><br><span class="line">    ssid="another wi-fi name here"</span><br><span class="line">    psk="another wi-fi password here"</span><br><span class="line">    key_mgmt=WPA-PSK</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>倘若你有LCD 3.5英寸的显示屏（40个针脚，该LCD需要占用26个针脚）的话，可以使用以下命令安装LCD驱动并开启显示屏（树莓派默认是由HDMI输出视频信号），倘若出现屏幕图像反转等问题，可以查看<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8xNTczNDAyMDU=" title="https://zhuanlan.zhihu.com/p/157340205">详细配置<i class="fa fa-external-link"></i></span>。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">在线安装方式</span></span><br><span class="line">git clone https://github.com/waveshare/LCD-show.git</span><br><span class="line">cd LCD–show/</span><br><span class="line">sudo ./LCD35–show</span><br><span class="line"><span class="meta">#</span><span class="bash">离线安装方式</span></span><br><span class="line">wget http://www.lcdwiki.com/res/RaspDriver/LCD-show.tar.gz</span><br><span class="line"><span class="meta">#</span><span class="bash">将文件拷贝到boot目录下，进行解压缩</span></span><br><span class="line">cd /boot </span><br><span class="line">sudo tar zxvf LCD-show.tar.gz </span><br><span class="line">cd LCD-show/ </span><br></pre></td></tr></table></figure><h3 id="ADS-B相关配置"><a href="#ADS-B相关配置" class="headerlink" title="ADS-B相关配置"></a>ADS-B相关配置</h3><p>本次配置需要用到的软件为Mode-S Beast开源驱动，要从源码编译打包的软件有beast-splitter和dump1090-fa，此外还需要编译安装作为dump1090依赖项而存在的bladeRF。<br>首先准备编译的环境：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">默认使用pi用户登录，而非root用户</span></span><br><span class="line">pi@raspberrypi:~$ sudo apt update &amp;&amp; apt-get upgrade</span><br><span class="line">pi@raspberrypi:~$ sudo apt install -y git cmake build-essential debhelper librtlsdr-dev pkg-config dh-systemd libncurses5-dev libboost-system-dev libboost-program-options-dev libboost-regex-dev libusb-1.0-0-dev doxygen libtecla-dev libtecla1 help2man pandoc</span><br></pre></td></tr></table></figure><p>而后将所需的源码拉取到本地，考虑到Github在国内的访问体验，故本次操作所需的代码拉取是导入Gitee后再进行的拉取操作。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:~$ git clone https://gitee.com/turbulance/bladeRF ~/src/bladeRF</span><br><span class="line">pi@raspberrypi:~$ git clone https://gitee.com/turbulance/beast-splitter ~/src/beast-splitter</span><br><span class="line">pi@raspberrypi:~$ git clone https://gitee.com/turbulance/dump1090 ~/src/dump1090</span><br></pre></td></tr></table></figure><p>进入 beast-splitter 的源码目录，然后通过 dpkg 生成 deb 包。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:~$ cd ~/src/beast-splitter</span><br><span class="line">pi@raspberrypi:~/src/beast-splitter$ dpkg-buildpackage -b --no-sign</span><br></pre></td></tr></table></figure><p>生成的 deb 位于上级目录，安装 beast-splitter_3.8.0_armhf.deb 即可。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:~/src/beast-splitter$ sudo dpkg --install ../beast-splitter_3.8.0_armhf.deb</span><br></pre></td></tr></table></figure><p>而后将Mode-S Beast与天线和树莓派连接，启动 beast-spliter。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:~/src/beast-splitter$ sudo systemctl start beast-splitter</span><br></pre></td></tr></table></figure><p>倘若一切情况正常，应该可以看到绿色指示灯不断闪烁，可以看到/dev目录多出了一个名为beast的设备。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:~/src/beast-splitter$ ls /dev</span><br><span class="line">autofs           input               null    serial  tty23  tty44  tty8       vcsa3</span><br><span class="line">beast            kmsg                ppp     shm     tty24  tty45  tty9       vcsa4</span><br><span class="line">block            log                 ptmx    snd     tty25  tty46  ttyAMA0    vcsa5</span><br><span class="line">btrfs-control    loop0               pts     stderr  tty26  tty47  ttyprintk  vcsa6</span><br><span class="line">bus              loop1               ram0    stdin   tty27  tty48  ttyUSB0    vcsm</span><br><span class="line">cachefiles       loop2               ram1    stdout  tty28  tty49  ttyUSB1    vcsm-cma</span><br><span class="line">char             loop3               ram10   tty     tty29  tty5   uhid       vcsu</span><br><span class="line">console          loop4               ram11   tty0    tty3   tty50  uinput     vcsu1</span><br><span class="line">cpu_dma_latency  loop5               ram12   tty1    tty30  tty51  urandom    vcsu2</span><br><span class="line">cuse             loop6               ram13   tty10   tty31  tty52  v4l        vcsu3</span><br><span class="line">disk             loop7               ram14   tty11   tty32  tty53  vchiq      vcsu4</span><br><span class="line">fb0              loop-control        ram15   tty12   tty33  tty54  vcio       vcsu5</span><br><span class="line">fd               mapper              ram2    tty13   tty34  tty55  vc-mem     vcsu6</span><br><span class="line">full             media0              ram3    tty14   tty35  tty56  vcs        vhci</span><br><span class="line">fuse             mem                 ram4    tty15   tty36  tty57  vcs1       video10</span><br><span class="line">gpiochip0        memory_bandwidth    ram5    tty16   tty37  tty58  vcs2       video11</span><br><span class="line">gpiochip1        mmcblk0             ram6    tty17   tty38  tty59  vcs3       video12</span><br><span class="line">gpiochip2        mmcblk0p1           ram7    tty18   tty39  tty6   vcs4       watchdog</span><br><span class="line">gpiochip3        mmcblk0p2           ram8    tty19   tty4   tty60  vcs5       watchdog0</span><br><span class="line">gpiochip4        mqueue              ram9    tty2    tty40  tty61  vcs6       zero</span><br><span class="line">gpiomem          net                 random  tty20   tty41  tty62  vcsa</span><br><span class="line">hwrng            network_latency     raw     tty21   tty42  tty63  vcsa1</span><br><span class="line">initctl          network_throughput  rfkill  tty22   tty43  tty7   vcsa2</span><br></pre></td></tr></table></figure><p>安装好了Beast的驱动，已经成功了一半，接下来是编译打包bladeRF和dump1090-fa。前面已经提到，dump1090-fa依赖于bladeRF，所以先要安装bladeRF才能编译dump1090-fa。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:~/src/beast-splitter$ cd ~/src/bladeRF</span><br><span class="line">pi@raspberrypi:~/src/beast-splitter$ git checkout 2017.12-rc1</span><br><span class="line">pi@raspberrypi:~/src/bladeRF$ dpkg-buildpackage -b --no-sign</span><br><span class="line">pi@raspberrypi:~/src/bladeRF$ sudo dpkg --install ../libbladerf1_2017.07_armhf.deb</span><br><span class="line">pi@raspberrypi:~/src/bladeRF$ sudo dpkg --install ../libbladerf-dev_2017.07_armhf.deb</span><br><span class="line">pi@raspberrypi:~/src/bladeRF$ sudo dpkg --install ../libbladerf-udev_2017.07_armhf.deb</span><br></pre></td></tr></table></figure><p>在安装好bladeRF过后，就可以编译dump1090-fa了。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:~/src/bladeRF$ cd ~/src/dump1090</span><br><span class="line">pi@raspberrypi:~/src/dump1090$ dpkg-buildpackage -b --no-sign</span><br></pre></td></tr></table></figure><p>由于dump1090-fa 依赖于lighttpd 工作，所以安装打包好的dump1090-fa之前还要先安装lighttpd，否则会报错。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:~/src/dump1090$ sudo apt install -y lighttpd</span><br></pre></td></tr></table></figure><p>接下来才是安装 dump1090-fa。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:~/src/dump1090$ sudo dpkg --install ~/src/dump1090-fa_3.8.0_armhf.deb</span><br></pre></td></tr></table></figure><p>最后重启设备即可。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:~/src/dump1090$ sudo reboot</span><br></pre></td></tr></table></figure><p>待到机器重启完毕后，打开http://[树莓派 IP]:80/dump1090-fa/或者IP:8080即可看到实时的 ADS-B 资讯。<br>假如你有修改GPS坐标的需求，则需要修改 /etc/default/dump1090-fa，该文件是dump1090的配置文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@pi:/home# vi /etc/default/dump1090-fa</span><br></pre></td></tr></table></figure><p>首先配置dump1090开机启动，直接将配置文件中ENABLED字段赋值为yes即可。<br>考虑到经纬度设置及隐私问题安全，可以填一个大致的位置，所以在 DECODER_OPTIONS 字段加入 –lat 41.00 –lon 112.00这样一句话。<br>综合上述要求，这里给出一个配置文件示范，详细可参考<span class="exturl" data-url="aHR0cHM6Ly9pYmNsLnVzL0FEU0JfRGVjb2RlXzIwMjAwMTE4Lw==" title="https://ibcl.us/ADSB_Decode_20200118/">RTL-SDR<i class="fa fa-external-link"></i></span>的配置。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> dump1090-fa configuration</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is sourced by /usr/share/dump1090-fa/start-dump1090-fa as a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> shellscript fragment.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you are using a PiAware sdcard image, this config file is regenerated</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> on boot based on the contents of piaware-config.txt; any changes made to this</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> file will be lost.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> dump1090-fa won<span class="string">'t automatically start unless ENABLED=yes</span></span></span><br><span class="line">ENABLED=yes</span><br><span class="line"></span><br><span class="line">RECEIVER_OPTIONS="--device-index 1 --gain 50 --ppm 0"</span><br><span class="line">DECODER_OPTIONS="--lat 33.000 --lon 118.000 --max-range 360 --fix"</span><br><span class="line">NET_OPTIONS="--net --net-heartbeat 60 --net-ro-size 1300 --net-ro-interval 0.2 --net-ri-port 0 --net-ro-port 30002 --net-sbs-port 30003 --net-bi-port 30004,30104 --net-bo-port 30005"</span><br><span class="line">JSON_OPTIONS="--json-location-accuracy 1"</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"><span class="meta">#</span><span class="bash"> dump1090-fa configuration</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is sourced by /usr/share/dump1090-fa/start-dump1090-fa as a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> shellscript fragment.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you are using a PiAware sdcard image, this config file is regenerated</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> on boot based on the contents of piaware-config.txt; any changes made to this</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> file will be lost.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> dump1090-fa won<span class="string">'t automatically start unless ENABLED=yes</span></span></span><br><span class="line">ENABLED=yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">DECODER_OPTIONS=<span class="string">"--lat &lt;env1&gt; --lon &lt;env2&gt; --max-range 360"</span></span></span><br><span class="line">DECODER_OPTIONS="--lat 35.8 --lon 125.3 --max-range 360"</span><br><span class="line">NET_OPTIONS="--net --net-heartbeat 60 --net-ro-size 1000 --net-ro-interval 1 --net-http-port 0 --net-ri-port 0 --net-ro-port 30002 --net-sbs-port 30003 --net-bi-port 30004,30104"</span><br><span class="line">JSON_OPTIONS="--json-location-accuracy 2"</span><br><span class="line">RECEIVER_OPTIONS="--net-only --net-bo-port 0 --fix"</span><br></pre></td></tr></table></figure><h3 id="Nginx反向代理相关配置"><a href="#Nginx反向代理相关配置" class="headerlink" title="Nginx反向代理相关配置"></a>Nginx反向代理相关配置</h3><p>每一次进行frp内网穿透时，总是需要进行输入IP地址和高位端口，甚是麻烦和不方便记忆，所以我能想到的一种方法便是利用Nginx的proxy_pass参数进行反向代理本地端口进行内网穿透，并且在frp使用http的用户名和密码验证的情况下，使用https配合CDN以达到更高效更便捷的访问。<br>下面直接给出Nginx vhost配置文件示例：（该文件中所以相关设置已经经过本人实际检验）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">server</span><br><span class="line">    &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name ***;</span><br><span class="line"><span class="meta">#</span><span class="bash">http重定向到https</span></span><br><span class="line">         if ($scheme = http ) &#123;</span><br><span class="line">             return 301 https://$host$request_uri;</span><br><span class="line">         &#125;       </span><br><span class="line">         location /&#123;</span><br><span class="line">            proxy_pass http://127.0.0.1:7080/;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_hide_header X-Powered-By;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        access_log  /home/wwwlogs/***.log;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">server</span><br><span class="line">    &#123;</span><br><span class="line">        listen 443 ssl http2;</span><br><span class="line">        server_name ***;</span><br><span class="line">       </span><br><span class="line">        ssl_certificate /usr/local/nginx/conf/ssl/**.com/***.cer;</span><br><span class="line">        ssl_certificate_key /usr/local/nginx/conf/ssl/**.com/***.key;</span><br><span class="line">        ssl_session_timeout 5m;</span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line">        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";</span><br><span class="line">        ssl_session_cache builtin:1000 shared:SSL:10m;</span><br><span class="line">        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048</span><br><span class="line">        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">        location / &#123;</span><br><span class="line">                      #关于frp与Nginx配合使用的问题：https://blog.csdn.net/rfrftt/article/details/89317529</span><br><span class="line">                      #https://www.v2ex.com/t/378393</span><br><span class="line">                         proxy_pass http://127.0.0.1:7080/;</span><br><span class="line">                         proxy_ssl_server_name on;</span><br><span class="line">                         proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">                         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">                         proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">                         proxy_set_header Host $host;</span><br><span class="line">#防止出现https页面中包含http不安全链接问题</span><br><span class="line">                         add_header Content-Security-Policy upgrade-insecure-requests;                       </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        access_log  /home/wwwlogs/***.log;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p class=&quot;description&quot;&gt;&lt;/p&gt;
通常情况下对于公网环境下访问局域网设备的需求而言，其解决方案有使用动态域名解析DDNS以及各种内网穿透工具(如Frp，Ngrok等等)。对于DDNS方式和Frp而言，两种方式各有千秋。首先对于动态域名解析，其基本要求是本地网关设备能够获取到运营商提供的公网IPv4地址，这对大多数中国移动宽带和部分地区中国电信宽带用户而言或许会有一些困扰；对于Frp内网穿透方式则无需苛刻的条件，只需要一台具有公网IPv4地址的服务器即可，进而间接的通过该服务器建立公网到局域网的逻辑链路访问。
    
    </summary>
    
    
      <category term="技术" scheme="https://blog.kixcs.com/categories/technique/"/>
    
    
      <category term="Raspberry Pi" scheme="https://blog.kixcs.com/tags/Raspberry-Pi/"/>
    
      <category term="Frp" scheme="https://blog.kixcs.com/tags/Frp/"/>
    
      <category term="ADS-B" scheme="https://blog.kixcs.com/tags/ADS-B/"/>
    
  </entry>
  
  <entry>
    <title>旁路由网关设置及联通光猫的若干注意事项</title>
    <link href="https://blog.kixcs.com/archives/a971/"/>
    <id>https://blog.kixcs.com/archives/a971/</id>
    <published>2021-01-05T15:50:46.000Z</published>
    <updated>2021-01-31T17:05:43.057Z</updated>
    
    <content type="html"><![CDATA[<p class="description"></p>本篇文章记录树莓派3（Paspberry Pi 3）刷写Lean OpenWrt固件，并且用作软路由后所遇到的一些障碍和解决方法，比方说旁路由防火墙自定义规则的设置，局域网接口桥接的设置，旁路由于主路由网关互指的配置，主路由关于DHCP/DNS默认网关的配置，ADGuard用作DNS服务器拦截广告及自定义DNS服务器地址及端口的设置，光猫超级管理员密码的获取等等。本文上述内容的关键步骤进行记录，同时贴出所需的相关软件资源备份，以备日后不时之需，方便查阅。<a id="more"></a><h3 id="旁路由固件"><a href="#旁路由固件" class="headerlink" title="旁路由固件"></a>旁路由固件</h3><p>首选给出适配树莓派3的（CPU芯片为博通2710）的OpenWrt<span class="exturl" data-url="aHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL2ZpbGUvZC8xYjA5QXVoV2hId1g5Tm9xWG9GdElBNnBtZVp4NHZNWkEvdmlldz91c3A9c2hhcmluZw==" title="https://drive.google.com/file/d/1b09AuhWhHwX9NoqXoFtIA6pmeZx4vMZA/view?usp=sharing">安装包<i class="fa fa-external-link"></i></span>，编译者为<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1N1TGluZ0dHL09wZW5XcnQtUnBp" title="https://github.com/SuLingGG/OpenWrt-Rpi">SuLingGG<i class="fa fa-external-link"></i></span>，刷入固件后进入名为：OpenWrt的开放wifi，初始管理地址为：192.168.1.1，账户名：root，密码：password。</p><p>重新设置管理后台IP：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uci set network.lan.ipaddr=192.168.123.100</span><br><span class="line">uci commit network</span><br><span class="line">/etc/init.d/network restart</span><br></pre></td></tr></table></figure><p>设置完成后，LAN接口选择静态地址，IPv4地址即为刚刚设置的管理后台地址，IPv4网关为主路由IP，广播为该网段255广播地址，自定义DNS服务器也为主路由IP。</p><h3 id="防火墙规则"><a href="#防火墙规则" class="headerlink" title="防火墙规则"></a>防火墙规则</h3><p>设置完成后，倘若出现出现无法上网、访问国内网站缓慢等症状，可在完成上文全部步骤的基础上，在“网络 - 防火墙 - 自定义规则”中新增一行 iptables 规则并重启防火墙再试：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -I POSTROUTING -j MASQUERADE</span><br><span class="line"><span class="meta">#</span><span class="bash">若仍未解决，可以尝试删除原有两条规则并重启防火墙再试：</span></span><br><span class="line">iptables -t nat -A PREROUTING -p udp --dport 53 -j REDIRECT --to-ports 53</span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 53 -j REDIRECT --to-ports 53</span><br></pre></td></tr></table></figure><p>下面给出本人正在使用的自定义防火墙iptables规则（注5300端口为ADGuard监听端口）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> This file is interpreted as shell script.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Put your custom iptables rules here, they will</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> be executed with each firewall (re-)start.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Internal uci firewall chains are flushed and recreated on reload, so</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> put custom rules into the root chains e.g. INPUT or FORWARD or into the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> special user chains, e.g. input_wan_rule or postrouting_lan_rule.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">iptables -t nat -A PREROUTING -p udp --dport 53 -j REDIRECT --to-ports 53</span></span><br><span class="line"><span class="meta">#</span><span class="bash">iptables -t nat -A PREROUTING -p tcp --dport 53 -j REDIRECT --to-ports 53</span></span><br><span class="line"></span><br><span class="line">iptables -t nat -A PREROUTING -p udp --dport 53 -j REDIRECT --to-ports 5300</span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 53 -j REDIRECT --to-ports 5300</span><br><span class="line"></span><br><span class="line">iptables -t nat -I POSTROUTING -j MASQUERADE</span><br></pre></td></tr></table></figure><h3 id="取消桥接"><a href="#取消桥接" class="headerlink" title="取消桥接"></a>取消桥接</h3><p>如果以上两个方法未能解决，请尝试在 Lan 口的“物理设置”中取消“桥接接口”的打勾，并在下方的“接口”中选择“eth0”，保存并应用再试。但请注意，此时树莓派的板载无线网卡将无法使用 (有信号但无法上网)。</p><p>详细步骤：网络-接口-LAN（br-lan）-修改-物理设置-取消勾选✔桥接接口-接口仅选择以太网适配器 eth0(lan)这一项 不勾选起初✔打勾的无线网络:Master OpenWrt 初始状态可能是 br-lan（lan）,设置完成后才会变成eth0。并且在该接口设置 忽略此接口/不在此接口提供DHCP服务。</p><p>本篇文章所述设置方法可能对某些型号的华为路由器无效，建议更换其他路由器再试。</p><h3 id="AdGuardHome"><a href="#AdGuardHome" class="headerlink" title="AdGuardHome"></a>AdGuardHome</h3><p>AdGuardHome面板设置端口为：3000，监听端口为：5300。（可根据实际修改）</p><p>修改防火墙，53 端口重定向到 AdGuardHome 监听端口5300（与前面配置一致）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A PREROUTING -p udp --dport 53 -j REDIRECT --to-ports 5300</span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 53 -j REDIRECT --to-ports 5300</span><br></pre></td></tr></table></figure><p>在AdGuardHome设置中设置5300重定向至 作为dnsmasq的上游服务器。关闭Turbo ACC中的DNS加速，DNS解析全部经过AdGuardHome。修改 网络 - DHCP/DNS 转发到 AdGuardHome，注意此处端口5300需与前面 AdGuardHome 配置监听端口一致，DNS转发：127.0.0.1#5300。科学的插件中也需要设置“访问国外域名DNS服务器：127.0.0.1:5300”。</p><p>下面给出一些AdGuardHome的一些拦截规则：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">自带规则：AdGuard DNS filter - https://adguardteam.github.io/AdGuardSDNSFilter/Filters/filter.txt</span></span><br><span class="line"><span class="meta">#</span><span class="bash">自带规则：MalwareDomainList.com Hosts List - https://www.malwaredomainlist.com/hostslist/hosts.txt</span></span><br><span class="line"><span class="meta">#</span><span class="bash">自带规则：AdAway - https://adaway.org/hosts.txt</span></span><br><span class="line"><span class="meta">#</span><span class="bash">anti-AD - https://anti-ad.net/easylist.txt 官宣：anti-AD 是目前中文区命中率最高广告过滤列表，实现了精确广告屏蔽和隐私保护。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">neoHosts Full 127.0.0.1 - https://hosts.nfz.moe/127.0.0.1/full/hosts 官宣：neoHosts 自由、负责、克制 的去广告 Hosts</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Easylist 官方规则 - https://easylist.to/easylist/easylist.txt</span></span><br><span class="line"><span class="meta">#</span><span class="bash">EasylistChina+EasylistLite+CJX’sAnnoyance - https://raw.githubusercontent.com/o0HalfLife0o/list/master/ad.txt 简介：由 halflife 维护，合并了 EasylistChina、EasylistLite、CJX’sAnnoyance，以及一些补充规则，每日更新。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">EasyPrivacy 隐私保护 - https://easylist-downloads.adblockplus.org/easyprivacy.txt</span></span><br><span class="line"><span class="meta">#</span><span class="bash">CJX<span class="string">'s Annoyance List - https://raw.githubusercontent.com/cjx82630/cjxlist/master/cjx-annoyance.txt</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">EasyList China 中文补充规则 - https://easylist-downloads.adblockplus.org/easylistchina.txt</span></span><br><span class="line"><span class="meta">#</span><span class="bash">EasyList Lite 中文精简规则 - https://raw.githubusercontent.com/cjx82630/cjxlist/master/cjxlist.txt</span></span><br></pre></td></tr></table></figure><h3 id="SD卡扩展分区"><a href="#SD卡扩展分区" class="headerlink" title="SD卡扩展分区"></a>SD卡扩展分区</h3><p>本项目OpenWrt固件刷入SD卡后SD卡内boot分区所占空间为64M，root分区所占空间为960M，所以:SD卡总容量 - (64+960)M ≈ 空闲分区容量。</p><p>ext4 固件由于未知原因，ext4 固件暂时无法在 Windows 下使用 Diskgenius、PartitionGuru 等磁盘管理工具扩容，所以我们需要在 Linux 环境下对 SD 卡进行扩容操作。<br>①如果你有现成的 Linux 环境，则可以将 SD 卡插入电脑，使用 GParted 工具对 SD 卡的 Root 分区进行扩容；<br>②如果你有空闲的 U 盘，则可以将 Linux 发行版的 Live CD 写入 U 盘，重启至 U 盘中的 Live 环境使用 GParted 工具对 SD 卡进行扩容；<br>③如果以上条件都不满足，则可使用虚拟机软件虚拟 Gparted 的 Live CD，在虚拟机中完成 SD 卡的扩容。</p><p>下面介绍第三种方法，需要用到<span class="exturl" data-url="aHR0cHM6Ly93d3cudmlydHVhbGJveC5vcmcvd2lraS9Eb3dubG9hZHM=" title="https://www.virtualbox.org/wiki/Downloads">VirtualBox<i class="fa fa-external-link"></i></span>，下载VirtualBox-6.1.18-142142-Win.exe和Oracle_VM_VirtualBox_Extension_Pack-6.1.18.vbox-extpack，所有需要的软件资源均可从<span class="exturl" data-url="aHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL2ZpbGUvZC8xYjA5QXVoV2hId1g5Tm9xWG9GdElBNnBtZVp4NHZNWkEvdmlldz91c3A9c2hhcmluZw==" title="https://drive.google.com/file/d/1b09AuhWhHwX9NoqXoFtIA6pmeZx4vMZA/view?usp=sharing">Google Drive<i class="fa fa-external-link"></i></span>中自取，操作过程在此不再赘述，具体可参考<span class="exturl" data-url="aHR0cHM6Ly9tbGFwcC5jbi8xMDExLmh0bWw=" title="https://mlapp.cn/1011.html">SuLingGG<i class="fa fa-external-link"></i></span>。</p><h3 id="DHCP默认网关"><a href="#DHCP默认网关" class="headerlink" title="DHCP默认网关"></a>DHCP默认网关</h3><p>在主路由上选择“网络”-“接口”-“LAN”-“修改”-“DHCP服务器”-“高级设置”- [可选/勾选“强制”] -“DHCP选项”中填写如下信息即可。（当然倘若选择了勾选✔忽略此接口提供DHCP，自然看不到DHCP的“高级设置”选项卡）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3,192.168.10.15</span><br><span class="line">6,192.168.10.15</span><br><span class="line"><span class="meta">#</span><span class="bash">注意为英文逗号, ，其中3,192.168.2.4表示DHCP网关指向N1，其中6,192.168.2.4表示DNS指向OP。</span></span><br></pre></td></tr></table></figure><p>其中该选项下方有提示：设置 DHCP 的附加选项，例如设定 “6,192.168.2.1,192.168.2.2” 表示通告不同的 DNS 服务器给客户端。</p><h3 id="联通光猫设置"><a href="#联通光猫设置" class="headerlink" title="联通光猫设置"></a>联通光猫设置</h3><p>型号为HG261G的联通烽火光猫开启IPv6以及获取超级管理员密码的设置如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">登录 http://192.168.1.1/logoffaccount.html，将隐藏用户选项改为启用，该选项改过后过一段时间会自动变回禁用；</span></span><br><span class="line"><span class="meta">#</span><span class="bash">登录 http://192.168.1.1/ 用户名：fiberhomehg2x0 密码：hg2x0，进入服务设置-&gt;应用服务，勾选 启用telnet 服务,telnet默认的用户名密码均为 admin，</span></span><br><span class="line"><span class="meta">#</span><span class="bash">可使用Putty进行 telnet 连接 192.168.1.1，命令为：telnet 192.168.1.1</span></span><br><span class="line"><span class="meta">#</span><span class="bash">依次输入该用户名和密码，然后依次输入get telname和get telpwd 来获得特权用户的用户名和密码；</span></span><br><span class="line"><span class="meta">#</span><span class="bash">登录 http://192.168.1.1/cu.html，输入刚才获得的特权用户名和密码，点击管理-&gt;网络，Internet 连接，将协议模式由 IPv4 更换为 IPv4&amp;IPv6，然后保存/应用，此时光猫的 IPv6 模式已经开启，只需在下级拨号路由器或其他设备中中设置 IPv6 相关功能即可。</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p class=&quot;description&quot;&gt;&lt;/p&gt;
本篇文章记录树莓派3（Paspberry Pi 3）刷写Lean OpenWrt固件，并且用作软路由后所遇到的一些障碍和解决方法，比方说旁路由防火墙自定义规则的设置，局域网接口桥接的设置，旁路由于主路由网关互指的配置，主路由关于DHCP/DNS默认网关的配置，ADGuard用作DNS服务器拦截广告及自定义DNS服务器地址及端口的设置，光猫超级管理员密码的获取等等。本文上述内容的关键步骤进行记录，同时贴出所需的相关软件资源备份，以备日后不时之需，方便查阅。
    
    </summary>
    
    
      <category term="网络" scheme="https://blog.kixcs.com/categories/network/"/>
    
    
      <category term="China Union" scheme="https://blog.kixcs.com/tags/China-Union/"/>
    
  </entry>
  
  <entry>
    <title>php目录列表程序：files.photo.gallery</title>
    <link href="https://blog.kixcs.com/archives/3b4e/"/>
    <id>https://blog.kixcs.com/archives/3b4e/</id>
    <published>2020-10-28T10:40:05.000Z</published>
    <updated>2021-01-19T16:37:08.829Z</updated>
    
    <content type="html"><![CDATA[<p class="description"></p>这是一款较为简洁和绚丽的php目录程序，支持图片EXIF信息的显示，例如照片拍摄设备类型，光圈值，GPS坐标，海拔高度等等，并且支持在线播放视频，音乐和内置显示某些程序设计语言文件代码。该程序更多适用于图片展示的个人使用，显示文件目录索引的功能该程序自然也能轻松胜任。该目录程序源码是开源的，全部功能完全免费使用不受限制，唯一需要注意的就是，使用者需要花费39USD用于去除弹出的授权窗口。除此之外PHP需要安装GD、mbstring、fileinfo和exif扩展。<a id="more"></a><h3 id="下载及安装"><a href="#下载及安装" class="headerlink" title="下载及安装"></a>下载及安装</h3><p>该程序<span class="exturl" data-url="aHR0cHM6Ly9maWxlcy5waG90by5nYWxsZXJ5Lw==" title="https://files.photo.gallery/">files.photo.gallery<i class="fa fa-external-link"></i></span>的安装文件仅仅只有一个<span class="exturl" data-url="aHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9maWxlcy5waG90by5nYWxsZXJ5L2luZGV4LnBocA==" title="https://cdn.jsdelivr.net/npm/files.photo.gallery/index.php">index.php<i class="fa fa-external-link"></i></span>，下载index.php放到你需要的目录即可，可以把这个php文件进行重命名，如file.php。需要额外注意的是，PHP需要安装GD、mbstring、fileinfo和exif扩展，才能使该程序运行完整功能，通常情况下，php进行插件的扩展需要结合安装目录重新编译，各位读者可自行结合服务器运行环境自行搜索相关资料并解决，倘若日后有机会，我会补上相关代码及设置说明。</p><h3 id="破解授权"><a href="#破解授权" class="headerlink" title="破解授权"></a>破解授权</h3><p>屏蔽付费弹窗.js文件及修改版index.php下载地址详见<span class="exturl" data-url="aHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL2RyaXZlL2ZvbGRlcnMvMWJQbWx2eE5hTHNkQWdBN1JmR1RnWTZsVXQ3QXljaUJIP3VzcD1zaGFyaW5n" title="https://drive.google.com/drive/folders/1bPmlvxNaLsdAgA7RfGTgY6lUt7AyciBH?usp=sharing">Google Drive<i class="fa fa-external-link"></i></span>。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.破解方法：打开index.php，在最后面找到：&lt;script src="&lt;?php echo config::$assets ?&gt;js/files.js"&gt;&lt;/script&gt;</span><br><span class="line">2.把它改成本地化：&lt;script src="js/files.js"&gt;&lt;/script&gt; 在线加载也可以：&lt;script src="http://d.nat.ee/js/files.js"&gt;&lt;/script&gt;</span><br><span class="line">3.然后在index.php目录创建js目录，然后下载files.js文件到js目录里面。</span><br><span class="line">4.files.js下载：https://cf.cdn.xiazai.de/meinv/js/files.js</span><br><span class="line"><span class="meta">  #</span><span class="bash">https://cdn.jsdelivr.net/gh/yyingc/js@v2.0/files.js</span></span><br><span class="line"><span class="meta">  #</span><span class="bash">https://cdn.jsdelivr.net/gh/KuiperSirius/files.photo.gallery@0.2.2/js/files.js</span></span><br></pre></td></tr></table></figure><h3 id="相关配置"><a href="#相关配置" class="headerlink" title="相关配置"></a>相关配置</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//文件名：config.php</span></span><br><span class="line"><span class="comment">//详细设置说明可参考 https://tvv.tw/blog/archives/130.html 一文关于config.php的说明</span></span><br><span class="line"><span class="comment">// CONFIG / https://forum.photo.gallery/viewtopic.php?f=66&amp;t=9964</span></span><br><span class="line"><span class="comment">// Uncomment the parameters you want to edit.</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">array</span> (</span><br><span class="line">  <span class="string">'root'</span> =&gt; <span class="string">'content'</span>,  <span class="comment">// root path relative to script.</span></span><br><span class="line">  <span class="string">'start_path'</span> =&gt; <span class="string">'content/Photo'</span>,  <span class="comment">// start path relative to script. If empty, root is start path</span></span><br><span class="line">  <span class="comment">//'username' =&gt; '',</span></span><br><span class="line">  <span class="comment">//'password' =&gt; '',</span></span><br><span class="line">  <span class="comment">// Add password directly or use https://tinyfilemanager.github.io/docs/pwd.html to encrypt the password (encrypted password is more secure, as it prevents your password from being exposed directly in a file).</span></span><br><span class="line">  <span class="comment">//如果密码不用明文，要对密码进行加密，可使用PHP密码Hash哈希生成器：https://tinyfilemanager.github.io/docs/pwd.html</span></span><br><span class="line">  <span class="string">'load_images'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">  <span class="string">'load_files_proxy_php'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">  <span class="string">'load_images_max_filesize'</span> =&gt; <span class="number">100000000</span>,</span><br><span class="line">  <span class="string">'load_svg_max_filesize'</span> =&gt; <span class="number">10000000</span>,</span><br><span class="line">  <span class="string">'image_resize_enabled'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">  <span class="string">'image_resize_cache'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">  <span class="string">'image_resize_dimensions'</span> =&gt; <span class="number">320</span>,</span><br><span class="line">  <span class="string">'image_resize_dimensions_retina'</span> =&gt; <span class="number">480</span>,</span><br><span class="line">  <span class="string">'image_resize_quality'</span> =&gt; <span class="number">85</span>,</span><br><span class="line">  <span class="string">'image_resize_function'</span> =&gt; <span class="string">'imagecopyresampled'</span>,</span><br><span class="line">  <span class="string">'image_resize_sharpen'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">  <span class="string">'image_resize_memory_limit'</span> =&gt; <span class="number">128</span>,</span><br><span class="line">  <span class="comment">//'image_resize_max_pixels' =&gt; 30000000,</span></span><br><span class="line">  <span class="comment">//'image_resize_min_ratio' =&gt; 1.5,</span></span><br><span class="line">  <span class="comment">//'image_resize_cache_direct' =&gt; false,</span></span><br><span class="line">  <span class="string">'menu_enabled'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">  <span class="string">'menu_show'</span> =&gt; <span class="keyword">false</span>,</span><br><span class="line">  <span class="string">'menu_max_depth'</span> =&gt; <span class="number">5</span>,</span><br><span class="line">  <span class="string">'menu_sort'</span> =&gt; <span class="string">'name_asc'</span>,</span><br><span class="line">  <span class="string">'menu_cache_validate'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">  <span class="string">'menu_load_all'</span> =&gt; <span class="keyword">false</span>,</span><br><span class="line">  <span class="comment">//'menu_recursive_symlinks' =&gt; true,</span></span><br><span class="line">  <span class="string">'layout'</span> =&gt; <span class="string">'rows'</span>,</span><br><span class="line">  <span class="string">'image_cover'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">  <span class="string">'sort'</span> =&gt; <span class="string">'name_asc'</span>,</span><br><span class="line">  <span class="string">'sort_dirs_first'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">  <span class="comment">//'cache' =&gt; true,</span></span><br><span class="line">  <span class="comment">//'cache_key' =&gt; 0,</span></span><br><span class="line">  <span class="comment">//'storage_path' =&gt; '_files',</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 排除文件或者目录</span></span><br><span class="line">  <span class="comment">//'files_exclude' =&gt; '',   // '/.(pdf|jpe?g)$/i',</span></span><br><span class="line">  <span class="comment">//'dirs_exclude' =&gt; '',  //'//Convert|/football|/node_modules(/|$)/i',</span></span><br><span class="line">  <span class="comment">//'allow_symlinks' =&gt; true,  // allow symlinks</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//'history' =&gt; true,</span></span><br><span class="line">  <span class="string">'breadcrumbs'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">  <span class="comment">//'transitions' =&gt; true,</span></span><br><span class="line">  <span class="comment">//'click' =&gt; 'popup',</span></span><br><span class="line">  <span class="comment">//'code_max_load' =&gt; 100000,</span></span><br><span class="line">  <span class="comment">//'code_allow_edit' =&gt; false,</span></span><br><span class="line">  <span class="comment">//'popup_interval' =&gt; 5000,</span></span><br><span class="line">  <span class="comment">//'topbar_sticky' =&gt; 'scroll',</span></span><br><span class="line">  <span class="comment">//'check_updates' =&gt; true,</span></span><br><span class="line">  <span class="comment">//'allow_tasks' =&gt; true,</span></span><br><span class="line">  <span class="comment">//'get_mime_type' =&gt; false,</span></span><br><span class="line">  <span class="comment">//'context_menu' =&gt; true,</span></span><br><span class="line">  <span class="comment">//'prevent_right_click' =&gt; false,</span></span><br><span class="line">  <span class="comment">//'license_key' =&gt; '',</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p class=&quot;description&quot;&gt;&lt;/p&gt;
这是一款较为简洁和绚丽的php目录程序，支持图片EXIF信息的显示，例如照片拍摄设备类型，光圈值，GPS坐标，海拔高度等等，并且支持在线播放视频，音乐和内置显示某些程序设计语言文件代码。该程序更多适用于图片展示的个人使用，显示文件目录索引的功能该程序自然也能轻松胜任。该目录程序源码是开源的，全部功能完全免费使用不受限制，唯一需要注意的就是，使用者需要花费39USD用于去除弹出的授权窗口。除此之外PHP需要安装GD、mbstring、fileinfo和exif扩展。
    
    </summary>
    
    
      <category term="技术" scheme="https://blog.kixcs.com/categories/technique/"/>
    
    
      <category term="php" scheme="https://blog.kixcs.com/tags/php/"/>
    
  </entry>
  
  <entry>
    <title>搭建一个基于PHP和MySQL的一言Hitokoto接口</title>
    <link href="https://blog.kixcs.com/archives/746d/"/>
    <id>https://blog.kixcs.com/archives/746d/</id>
    <published>2020-07-13T08:58:12.000Z</published>
    <updated>2020-07-13T09:19:57.791Z</updated>
    
    <content type="html"><![CDATA[<p class="description">为了方便提高Hitokoto一言API接口的高并发业务场景，可以把它的文本内容集成到数据库中，并将其部署到你的VPS抑或是阿里云RDS上。倘若该一言API服务部署在服务器上，开放服务器防火墙3306端口和授予MySQL外部连接权限即可。Win10本地环境中，本次利用到Navicat Premium 15（可同时连接MySQL、MariaDB、MongoDB、SQL Server、Oracle、PostgreSQL和SQLite数据库），链接到远端数据库并验证连通性，首先建立一个名为hitokoto的数据库，数据表名同上。</p><a id="more"></a><h3 id="简言"><a href="#简言" class="headerlink" title="简言"></a>简言</h3><p>数据库名称和数据表的名字都叫hitokoto。表中有三个字段，分别为id（int类型，长度11，非空/NULL，主键）, is_display（int类型，长度11）, hitokoto（varchar类型，长度255），其中id为自增主键，is_display默认值为0。<br>创建接口，需要实现以下逻辑：随机返回一句话，并且返回的这句话与上次请求的结果不相同。设置一个is_display字段，用来保存调用状态，如果其value=1，说明上次刚刚被调用，反之亦然。在这一次调用时，随机返回除了上一次调用过的结果之外的句子，然后将上一次调用结果中的is_display的值改为0，将这次请求结果的is_display的值改为1。后端代码应用到前端，使用Ajax来发送与处理请求。</p><h3 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h3><p>hitokoto.php代码如下所示：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$sql_server = <span class="string">"MySQL服务器域名或者IPv4地址"</span>;</span><br><span class="line">$sql_user = <span class="string">"root"</span>;</span><br><span class="line">$sql_pass = <span class="string">"**"</span>;</span><br><span class="line">$sql_dbname = <span class="string">"hitokoto"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dataBase</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">connectSql</span><span class="params">($sql_server,$sql_user,$sql_pass,$sql_dbname)</span> </span>&#123;</span><br><span class="line">        $conn = <span class="keyword">new</span> mysqli(<span class="string">"$sql_server"</span>,<span class="string">"$sql_user"</span>,<span class="string">"$sql_pass"</span>,<span class="string">"$sql_dbname"</span>);</span><br><span class="line">        mysqli_set_charset($conn,<span class="string">"utf8"</span>);</span><br><span class="line">        date_default_timezone_set(<span class="string">"PRC"</span>);</span><br><span class="line">        <span class="keyword">return</span> $conn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sqlQuery</span><span class="params">($sql,$conn)</span> </span>&#123;</span><br><span class="line">        $sql_query = $conn-&gt;query($sql);</span><br><span class="line">        <span class="keyword">return</span> $sql_query;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getHitokotos</span><span class="params">($sql,$conn)</span> </span>&#123;</span><br><span class="line">        $data = $conn-&gt;query($sql);</span><br><span class="line">        $data_arrays = [];</span><br><span class="line">        <span class="keyword">while</span> ( $data_array = $data-&gt;fetch_array( MYSQLI_ASSOC ) ) &#123;</span><br><span class="line">            $data_arrays[] = $data_array;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $data_arrays;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getTotal</span><span class="params">($sql,$conn)</span> </span>&#123;</span><br><span class="line">        $data1 = $conn-&gt;query($sql);</span><br><span class="line">        $total = $data1-&gt;fetch_array();</span><br><span class="line">        $totals = $total[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">return</span> $totals;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$dataBase = <span class="keyword">new</span> dataBase();</span><br><span class="line">$conn = $dataBase-&gt;connectSql($sql_server,$sql_user,$sql_pass,$sql_dbname);</span><br><span class="line"></span><br><span class="line">$sql_hitokoto = <span class="string">"SELECT * FROM hitokoto WHERE is_display != 1"</span>;</span><br><span class="line">$sql_total  = <span class="string">"SELECT COUNT(*) FROM hitokoto WHERE is_display != 1"</span>;</span><br><span class="line"></span><br><span class="line">$hitokotos = $dataBase-&gt;getHitokotos($sql_hitokoto,$conn);</span><br><span class="line">$total = $dataBase-&gt;getTotal($sql_total,$conn);</span><br><span class="line"></span><br><span class="line">$rand = rand(<span class="number">0</span>,$total<span class="number">-1</span>);</span><br><span class="line">$id = $hitokotos[$rand][<span class="string">'id'</span>];</span><br><span class="line"></span><br><span class="line">$sql_dislpay1 = <span class="string">"UPDATE hitokoto SET is_display = 0 WHERE is_display = 1"</span>;</span><br><span class="line">$sql_dislpay2 = <span class="string">"UPDATE hitokoto SET is_display = 1 WHERE id = '$id'"</span>;</span><br><span class="line"></span><br><span class="line">$display_query1 = $dataBase-&gt;sqlQuery($sql_dislpay1,$conn);</span><br><span class="line">$display_query2 = $dataBase-&gt;sqlQuery($sql_dislpay2,$conn);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span>($hitokotos[$rand][<span class="string">'hitokoto'</span>]);</span><br><span class="line">mysqli_close($conn);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><p>首先要在合适的位置添加div标签<code>&lt;div id="hitokoto"></code>，或者直接在某需要输出的HTML标签内部(如<code>&lt;p></code>等等)id=”hitokoto”也可以。<br>JavaScript代码如下所示，用来发起Ajax请求：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">showHitokoto</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> xmlhttp;</span><br><span class="line">      xmlhttp = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">      xmlhttp.open(<span class="string">"GET"</span>, <span class="string">"https://kixcs.com/hitokoto.php"</span>, <span class="literal">true</span>);</span><br><span class="line">      xmlhttp.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">         <span class="keyword">if</span> (xmlhttp.readyState == <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="built_in">document</span>.getElementById(<span class="string">'hitokoto'</span>).innerHTML = xmlhttp.responseText;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      xmlhttp.send();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="built_in">window</span>.onload = showHitokoto()<span class="comment">//加载时自动执行</span></span><br></pre></td></tr></table></figure><p>倘若博客主题使用了Pjax无刷新，例如Hexo框架的静态博客中可以全局的指定Pjax属性，还需要指定Pjax重载函数，有很多跟上面的相同。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">   <span class="keyword">var</span> xmlhttp;</span><br><span class="line">   xmlhttp = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">   xmlhttp.open(<span class="string">"GET"</span>, <span class="string">"./hitokoto.php"</span>, <span class="literal">true</span>);</span><br><span class="line">   xmlhttp.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (xmlhttp.readyState == <span class="number">4</span>) &#123;</span><br><span class="line">         <span class="built_in">document</span>.getElementById(<span class="string">'hitokoto'</span>).innerHTML = xmlhttp.responseText;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   xmlhttp.send();</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p class=&quot;description&quot;&gt;
为了方便提高Hitokoto一言API接口的高并发业务场景，可以把它的文本内容集成到数据库中，并将其部署到你的VPS抑或是阿里云RDS上。倘若该一言API服务部署在服务器上，开放服务器防火墙3306端口和授予MySQL外部连接权限即可。Win10本地环境中，本次利用到Navicat Premium 15（可同时连接MySQL、MariaDB、MongoDB、SQL Server、Oracle、PostgreSQL和SQLite数据库），链接到远端数据库并验证连通性，首先建立一个名为hitokoto的数据库，数据表名同上。
&lt;/p&gt;
    
    </summary>
    
    
      <category term="设计" scheme="https://blog.kixcs.com/categories/design/"/>
    
    
      <category term="Hitokoto" scheme="https://blog.kixcs.com/tags/Hitokoto/"/>
    
  </entry>
  
  <entry>
    <title>Raspberry Pi独立配置ADS-B dump1090模块</title>
    <link href="https://blog.kixcs.com/archives/dd76/"/>
    <id>https://blog.kixcs.com/archives/dd76/</id>
    <published>2020-05-05T13:00:28.000Z</published>
    <updated>2021-02-07T15:57:57.428Z</updated>
    
    <content type="html"><![CDATA[<p class="description"></p>先来看一段相关Github仓库README.md文档给出的简介：Dump 1090 is a Mode S decoder specifically designed for RTLSDR devices. The main features are: Robust decoding of weak messages, with mode1090 many users observed improved range compared to other popular decoders. Network support: TCP30003 stream (MSG5...), Raw packets, HTTP. Embedded HTTP server that displays the currently detected aircrafts on Google Map...<a id="more"></a><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>使用Raspberry Pi接收ADS-B信号离不开<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FudGlyZXovZHVtcDEwOTA=" title="https://github.com/antirez/dump1090">dump1090<i class="fa fa-external-link"></i></span>模块，执行以下<span class="exturl" data-url="aHR0cDovL3d3dy5zYXRzaWduYWwuZXUvcmFzcGJlcnJ5LXBpL2J1aWxkLTEwOTAuc2g=" title="http://www.satsignal.eu/raspberry-pi/build-1090.sh">脚本<i class="fa fa-external-link"></i></span>即可，当然也可自己输入指令分步执行。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://www.satsignal.eu/raspberry-pi/build-1090.sh</span><br><span class="line">chmod +x build-1090.sh</span><br><span class="line">./build-1090.sh </span><br></pre></td></tr></table></figure><h3 id="搭建步骤"><a href="#搭建步骤" class="headerlink" title="搭建步骤"></a>搭建步骤</h3><p>build-1090.sh内容如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get upgrade</span><br><span class="line">sudo printf 'blacklist dvb_usb_rtl28xxu\nblacklist rtl2832\nblacklist rtl2830' &gt; /etc/modprobe.d/nortl.conf</span><br><span class="line">sudo apt-get install git-core</span><br><span class="line">sudo apt-get install git</span><br><span class="line">sudo apt-get install cmake</span><br><span class="line">sudo apt-get install libusb-1.0-0-dev  </span><br><span class="line">sudo apt-get install build-essential </span><br><span class="line">git clone git://git.osmocom.org/rtl-sdr.git</span><br><span class="line">cd rtl-sdr</span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake ../ -DINSTALL_UDEV_RULES=ON</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line">sudo ldconfig</span><br><span class="line">cd ~</span><br><span class="line">sudo cp ./rtl-sdr/rtl-sdr.rules /etc/udev/rules.d/</span><br><span class="line">git clone git://github.com/MalcolmRobb/dump1090.git</span><br><span class="line">cd dump1090</span><br><span class="line">make</span><br><span class="line">sudo reboot</span><br></pre></td></tr></table></figure><p>执行完后重启RPi，之后ssh登录，先用lsusb看看能不能发现rtl-sdr，然后执行如下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rtl_test -t</span><br></pre></td></tr></table></figure><p>如果出现下述错误：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Found 1 device(s):</span><br><span class="line">0: Generic RTL2832U</span><br><span class="line">Using device 0: Generic RTL2832U</span><br><span class="line">Kernel driver is active, or device is claimed by second instance of librtlsdr.</span><br><span class="line">In the first case, please either detach or blacklist the kernel module</span><br><span class="line">(dvb_usb_rtl28xxu), or enable automatic detaching at compile time.</span><br><span class="line">usb_claim_interface error -6</span><br><span class="line">Failed to open rtlsdr device #0.</span><br></pre></td></tr></table></figure><p>是由于新版Raspbian内核已经集成了rtl-sdr的驱动，但是这个驱动不是我们需要的，所以要把这个驱动放入黑名单，重新安装osmocom的rtl-sdr驱动。</p><p>在/etc/modprobe.d目录建立nortl.conf文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano nortl.conf</span><br></pre></td></tr></table></figure><p>粘贴以下内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">blacklist dvb_usb_rtl28xxu</span><br><span class="line">blacklist rtl2832</span><br><span class="line">blacklist rtl2830</span><br></pre></td></tr></table></figure><p>reboot之后生效。</p><p>执行指令下面的命令，可以在终端看dump1090的输出。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./dump1090 --interactive</span><br></pre></td></tr></table></figure><p>执行如下指令，能在本地的IP 8080端口看到dump1090的输出了（会调用Google Map API）。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./dump1090 --interactive --net</span><br></pre></td></tr></table></figure><h3 id="开机自启"><a href="#开机自启" class="headerlink" title="开机自启"></a>开机自启</h3><p>开机自动启动：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/init.d/dump1090.sh</span><br></pre></td></tr></table></figure><p>粘贴以下内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## BEGIN INIT INFO</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Provides:dump1090</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Required-Start:<span class="variable">$remote_fs</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Required-Stop:<span class="variable">$remote_fs</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Default-Start:2 3 4 5</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Default-Stop:0 1 6</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Short-Description:dump1090 initscript</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## END INIT INFO</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Fill in name of program here.</span></span></span><br><span class="line">PROG="dump1090"</span><br><span class="line">PROG_PATH="/home/pi/dump1090"</span><br><span class="line">PROG_ARGS="--interactive --net --no-fix --net-ro-size 500  --net-ro-rate 5"</span><br><span class="line">PIDFILE="/var/run/dump1090.pid"</span><br><span class="line">  </span><br><span class="line">start() &#123;</span><br><span class="line">      if [ -e $PIDFILE ]; then</span><br><span class="line">          ## Program is running, exit with error.</span><br><span class="line">          echo "Error! $PROG is currently running!" 1&gt;&amp;2</span><br><span class="line">          exit 1</span><br><span class="line">      else</span><br><span class="line">          ## Change from /dev/null to something like /var/log/$PROG if you want to save output.</span><br><span class="line">          cd $PROG_PATH</span><br><span class="line">          ./$PROG $PROG_ARGS 2&gt;&amp;1 &gt;/dev/null &amp;</span><br><span class="line">          echo "$PROG started"</span><br><span class="line">          touch $PIDFILE</span><br><span class="line">      fi</span><br><span class="line">&#125;</span><br><span class="line">       </span><br><span class="line">stop() &#123;</span><br><span class="line">      if [ -e $PIDFILE ]; then</span><br><span class="line">          ## Program is running, so stop it</span><br><span class="line">         echo "$PROG is running"</span><br><span class="line">         killall $PROG</span><br><span class="line">         rm -f $PIDFILE</span><br><span class="line">         echo "$PROG stopped"</span><br><span class="line">      else</span><br><span class="line">          ## Program is not running, exit with error.</span><br><span class="line">          echo "Error! $PROG not started!" 1&gt;&amp;2</span><br><span class="line">          exit 1</span><br><span class="line">      fi</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Check to see if we are running as root first.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Found at http://www.cyberciti.biz/tips/shell-root-user-check-script.html</span></span></span><br><span class="line">if [ "$(id -u)" != "0" ]; then</span><br><span class="line">      echo "This script must be run as root" 1&gt;&amp;2</span><br><span class="line">      exit 1</span><br><span class="line">fi</span><br><span class="line"> </span><br><span class="line">case "$1" in</span><br><span class="line">      start)</span><br><span class="line">          start</span><br><span class="line">          exit 0</span><br><span class="line">          ;;</span><br><span class="line">          stop)</span><br><span class="line">          stop</span><br><span class="line">          exit 0</span><br><span class="line">      ;;</span><br><span class="line">      reload|restart|force-reload)</span><br><span class="line">          stop</span><br><span class="line">          start</span><br><span class="line">          exit 0</span><br><span class="line">      ;;</span><br><span class="line">      **)</span><br><span class="line">          echo "Usage: $0 &#123;start|stop|reload&#125;" 1&gt;&amp;2</span><br><span class="line">          exit 1</span><br><span class="line">      ;;</span><br><span class="line">esac</span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure><p>然后执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x /etc/init.d/dump1090.sh</span><br><span class="line">sudo update-rc.d dump1090.sh defaults</span><br></pre></td></tr></table></figure><p>reboot之后生效。</p><p>如果想停止服务，执行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/dump1090.sh stop</span><br></pre></td></tr></table></figure><p>删除开机启动服务：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-rc.d -f dump1090.sh remove</span><br></pre></td></tr></table></figure><p>鸣谢：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01hbGNvbG1Sb2JiL2R1bXAxMDkw" title="https://github.com/MalcolmRobb/dump1090">@MalcolmRobb<i class="fa fa-external-link"></i></span> <span class="exturl" data-url="aHR0cHM6Ly9iaDNudm4uZ2l0aHViLmlvLzIwMTUvMDgvZHVtcF8xMDkwX3JwaS8=" title="https://bh3nvn.github.io/2015/08/dump_1090_rpi/">@bh3nvn<i class="fa fa-external-link"></i></span></p>]]></content>
    
    <summary type="html">
    
      &lt;p class=&quot;description&quot;&gt;&lt;/p&gt;
先来看一段相关Github仓库README.md文档给出的简介：Dump 1090 is a Mode S decoder specifically designed for RTLSDR devices. The main features are: Robust decoding of weak messages, with mode1090 many users observed improved range compared to other popular decoders. Network support: TCP30003 stream (MSG5...), Raw packets, HTTP. Embedded HTTP server that displays the currently detected aircrafts on Google Map...
    
    </summary>
    
    
      <category term="技术" scheme="https://blog.kixcs.com/categories/technique/"/>
    
    
      <category term="Raspberry Pi" scheme="https://blog.kixcs.com/tags/Raspberry-Pi/"/>
    
  </entry>
  
  <entry>
    <title>浅析常用的视频封装格式与媒体编码格式</title>
    <link href="https://blog.kixcs.com/archives/2cf7/"/>
    <id>https://blog.kixcs.com/archives/2cf7/</id>
    <published>2020-04-30T10:42:29.000Z</published>
    <updated>2020-04-30T13:16:45.277Z</updated>
    
    <content type="html"><![CDATA[<p>MPEG-4是一套用于音频，视频信息的压缩编码标准，由国际标准化组织和国际电工委员会下属的动态影像专家组(Moving Picture Experts Group，即MPEG)制定，第一版在1998年10月通过，第二版在1999年12月通过。MPEG-4格式的主要用途在于网络上流、光盘、语音发送(视频电话)，以及电视广播。MPEG-4包含了MPEG-1及MPEG-2的绝大部分功能及其他格式的长处，并加入及扩展对虚拟现实模型语言的支持，面向对象的合成文件，以及数字版权管理(DRM)及其他交互功能。</p><p class="description"></p><a id="more"></a><h4 id="视频封装格式"><a href="#视频封装格式" class="headerlink" title="视频封装格式"></a>视频封装格式</h4><p>通俗的来讲，视频封装格式可以理解为是一个包裹，包裹就意味着这个后缀不能保证里面的具体内容的形式，也不能保证具体的相关细节。包裹里面的每一件物品，称之为轨道(track)。</p><ul><li><input checked="" disabled="" type="checkbox"> 视频(video): 相关动画文件。</li><li><input checked="" disabled="" type="checkbox"> 音频(audio): 相关声音文件。</li><li><input checked="" disabled="" type="checkbox"> 章节(chapter): 蓝光原盘中自带的分段信息。</li><li><input checked="" disabled="" type="checkbox"> 字幕(subtitles)：例如.srt字幕文件。</li></ul><p>关于视频格式，常见的有H.264(能够细分为8bit/10bit)，H.265(也有8bit/10bit之分)，RealVideo(常见于早期rm/rmvb)，VC-1(微软主导的标准，常见于wmv)。基本上，H.264=AVC=AVC1, H.265=HEVC。音频的格式，常见的有 FLAC/ALAC/TrueHD/DTS-HD MA这四种无损格式，和AAC/MP3/AC3/DTS(Core)这四种有损格式。</p><p>关于MKV和MP4的主要区别在于:</p><ul><li><input checked="" disabled="" type="checkbox"> MKV支持封装无损的FLAC做为音频，MP4则不支持。MP4也能够封装无损音轨(比如ALAC，虽然广泛认为ALAC的效率不如FLAC优秀)。</li><li><input checked="" disabled="" type="checkbox"> MKV支持封装ASS/SSA格式的字幕，MP4则不支持。通常字幕组制做的字幕是ASS格式，因此内封字幕多见于MKV格式。</li><li><input checked="" disabled="" type="checkbox"> MP4作为工业标准，在视频编辑软件和播放设备上的兼容性通常好于MKV。这也是vcb-s那些为移动设备优化的视频基本上选择MP4封装的缘由。</li></ul><p>除此以外，这两个格式(MP4/MKV)很大程度上能够互相代替。例如，它们都支持封装AVC和HEVC，包括8bit/10bit的精度。理论上讲两者都能封装同样的视频，所以不存在画质孰优孰劣之说。MKV是民间研发，为了代替古老的AVI，从而更好地支持H.264，它开发和修改的灵活度使得它能够兼容FLAC/ASS这类非工业标准的格式；而MP4则是出生于豪门，做为工业标准，替代更古老的MPG，做为新一代视频/音频封装服务的。</p><p>说到编码格式，H.264被MPEG组织称作AVC(Advanced Video Codec/先进视频编码)，是MPEG4标准的第10部分，用来取代之前MPEG4第2部分(简称MPEG4P2)所制定的视频编码，因为AVC有着比MPEG4P2强很多的压缩效率。最常见的MPEG4P2编码器有divx和xvid(开源)，最常见的AVC编码器是x264(开源)；而H.265则是次世代的视频编码技术，被MPEG组织称为HEVC（High Efficiency Video Coding），是次世代标准MPEG-H的第2部分，不属于MPEG-4标准，有着比H.264更强的压缩效率。</p><h5 id="AVI格式"><a href="#AVI格式" class="headerlink" title="AVI格式"></a>AVI格式</h5><p>AVI格式(后缀为.AVI)，它的英文全称为Audio Video Interleaved，即音频视频交错格式。它于1992年被Microsoft公司推出。这种视频格式的优点是图像质量好。由于无损AV可以保存alpha通道，经常被我们使用。缺点太多，体积过于庞大，且更加糟糕的是压缩标准不统一，最普遍的现象就是高版本Windows媒体播放器播放不了采用早期编码编辑的AVI格式视频，而低版本Windows媒体播放器又播放不了采用最新编码编辑的AVI格式视频，所以我们在进行些AVI格式的视频播放时常会出现由于视频编码问题而造成的视频不能播放或即使能够播放，但存在不能调节播放进度和播放时只有声音没有图像等一些莫名其妙的问题。</p><h5 id="DV-AVI格式"><a href="#DV-AVI格式" class="headerlink" title="DV-AVI格式"></a>DV-AVI格式</h5><p>DV-AVI格式(后缀为.AVI)，DV的英文全称是Digital Video Format，由索尼松下、JVC等多家厂商联合提出的一种家用数字视频格式。数字摄像机就是使用这种格式记录视频数据的。它可以通过电脑的IEEE 1394端口传输视频数据到电脑，也可以将电脑中编辑好的的视频数据回录到数码摄像机中。这种视频格式的文件扩展名也是avi。电视台采用录像带记录模拟信号，通过EDIUS由IEEE 1394端口采集卡从录像带中采集出来的视频就是这种格式。</p><h5 id="MOV格式"><a href="#MOV格式" class="headerlink" title="MOV格式"></a>MOV格式</h5><p>QuickTime File Format格式(后缀为.MOV)，美国Apple公司开发的一种视频格式，默认的播放器是苹果的QuickTime。该格式具有较高的压缩比率和较完美的视频清晰度等特点，可以保存alpha通道。每次安装EDIUS,我们都要安装苹果公司推出的QuickTime。安装其目的就是为了支持JPG格式图像和MOV视频格式导入。</p><h5 id="MPEG格式"><a href="#MPEG格式" class="headerlink" title="MPEG格式"></a>MPEG格式</h5><p>MPEG格式(文件后缀可以是.MPG .MPEG .MPE .DAT .VOB .ASF .3GP .MP4等) :它的英文全称为Moving Picture Experts Group,即运动图像专家组格式，该专家组建于1988年,专门负责为CD建立视频和音频标准，而成员都是为视频、音频及系统领域的技术专家。MPEG文件格式是运动图像压缩算法的国际标准。MPEG格式目前有三个压缩标准，分别是MPEG-1、MPEG-2、和MPEG-4。MPEG-1、MPEG-2目前已经使用较少，这里着重介绍MPEG-4。MPEG-4其制定于1998年，MPEG-4是为了播放流式媒体的高质量视频而专门设计的,以求使用最少的数据获得最佳的图像质量。目前MPEG-4最有吸弓力的地方在于它能够保存接近于DVD画质的小体积视频文件。</p><h4 id="视频编码格式"><a href="#视频编码格式" class="headerlink" title="视频编码格式"></a>视频编码格式</h4><p>所谓视频编码方式就是指能够对数字视频进行压缩或者解压缩(视频解码)的程序或者设备。通常这种压缩属于有损数据压缩。也可以指通过过特定的压缩技术,将某个视频格式转换成另-种视频格式。常见的编码方式有:</p><p>H.26X系列(由ITU[国际电传视讯联盟]主导) 包括H.261、H.262、 H.263、 H.264、 H.265。</p><ul><li><input checked="" disabled="" type="checkbox"> H.261:主要在老的视频会议和视频电话产品中使用。</li><li><input checked="" disabled="" type="checkbox"> H.263:主要用在视频会议、视频电话和网络视频上。</li><li><input checked="" disabled="" type="checkbox"> H.264: H.264/MPEG- 4第十部分，或称AVC (Advanced Video Coding,高级视频编码) ，是一种视频压缩标准，一种被广泛使用的高精度视频的录制、压缩和发布格式。</li><li><input checked="" disabled="" type="checkbox"> H.265:敲率视频编码(High Efficiency Video Coding,简称HEVC)是一种视频压缩标准，H.264/MPEG-4 AVC的继任者。HEVC被认为不仅提升图像质量，同时也能达到H.264/MPEG-4 AVC两倍之压缩率(等同于同样画面质量下比特率减少了50%)， 可支持4K分辨率甚至到超高画质电视，最高分辨率可达到8192x4320(8K分辨率)，这是目前发展的趋势。</li></ul><p>MPEG系列(由ISO[国际标准组织机构]下属的MPEG[运动图象专家组]开发)视频编码方面主要有:</p><ul><li><input checked="" disabled="" type="checkbox"> MPEG-1第二部分(MPEG-1第 二部分主要使用在VCD上,有些在线视频也使用这种格式。该编解码器的质量大致上和原有的VHS录像带相当。)</li><li><input checked="" disabled="" type="checkbox"> MPEG-2第二部分(MPEG-2第二部分等同于H.262, 使用在DVD、SVCD和大多数数字视频广播系统和有线分布系统(cable distribution systems)中。)</li><li><input checked="" disabled="" type="checkbox"> MPEG-4第二部分(MPEG 4第二部分标准可以使用在网络传输、广播和媒体存储上。比起MPEG-2和第一版的H.263, 它的压缩性能有所提高。)</li><li><input checked="" disabled="" type="checkbox"> MPEG -4第十部分(MPEG 4第十部分技术上和ITU-T H.264是相同的标准，有时候也被叫做AVC)最后这两个编码组织合作，诞生了H.264/AVC标准。ITU-T给这个标准命名为H.264，而ISO/IEC称它为MPEG-4高级视频编码(Advanced Video Coding, AVC)。</li></ul><h4 id="视频的基础参数"><a href="#视频的基础参数" class="headerlink" title="视频的基础参数"></a>视频的基础参数</h4><h5 id="分辨率"><a href="#分辨率" class="headerlink" title="分辨率"></a>分辨率</h5><p>视频是由连续的图像构成的。每一张图像称为一帧(frame)。图像则是由像素(pixel)构成的。一张图像有多少像素，称为这个图像的分辨率。例如1920×1080的图像，说明它是由横纵1920×1080个像素点构成。视频的分辨率就是每一帧图像的分辨率。</p><h5 id="帧率"><a href="#帧率" class="headerlink" title="帧率"></a>帧率</h5><p>一个视频，每一秒由多少图像构成，称为这个视频的帧率(frame-rate)。常见的帧率有24000/1001=23.976, 30000/1001=29.970, 60000/1001=59.940, 25.000, 50.000等等。这个数字是一秒钟内闪过的图像的数量。好比23.976，就是1001秒内，有24000张图像。视频的帧率是能够是恒定的(cfr, Const Frame-Rate)，也能够是变化的(vfr, Variable Frame-Rate)。</p><h5 id="码率"><a href="#码率" class="headerlink" title="码率"></a>码率</h5><p>码流(Data Rate)是指视频文件在单位时间内使用的数据流量，也叫码率或码流率，通俗一点的理解就是取样率,是视频编码中画面质量控制中最重要的部分，通常单位是kb/s或者Mb/s。通常来讲一样分辨率下，视频文件的码流越大，压缩比就越小，画面质量就越高。码流越大，说明单位时间内取样率越大，数据流，精度就越高，处理出来的文件就越接近原始文件，图像质量越好，画质越清晰，要求播放设备的解码能力也越高。</p><p>单位通常是Kbps(Kbit/s)或者Mbps(Mbit/s)。注意1B(Byte)=8b(bit)。因此一个24分钟，900MB的视频：<br>体积：900MB = 900MByte = 7200Mbit<br>时间：24min = 1440s<br>码率：7200/1440 = 5000 Kbps = 5Mbps</p><p>当视频文件的时间基本相同的时候（好比如今一集大概是24分钟），码率和体积基本上是等价的，都是用来描述视频大小的参数。长度分辨率都相同的文件，体积不一样，实际上就是码率不一样。码率也能够解读为单位时间内，用来记录视频的数据总量。码率越高的视频，意味着用来记录视频的数据量越多，潜在的解读就是视频能够拥有更好的质量。</p><h5 id="比特率"><a href="#比特率" class="headerlink" title="比特率"></a>比特率</h5><p>比特率是指每秒传送的比特(bit)数。单位为bps(Bit Per Second)，比特率越高，传送的数据越大。在视频领域,比特率常翻译为码率。比特率表示通过编码（压缩）后的音、视频数据每秒钟须要用多少个比特来表示，而比特就是二进制里面最小的单位，要么是0，要么是1。比特率与音、视频压缩的关系，简单的说就是比特率越高，音、视频的质量就越好，但编码后的文件就越大；若是比特率越少则状况恰好相反。</p><h5 id="采样率"><a href="#采样率" class="headerlink" title="采样率"></a>采样率</h5><p>采样率（也称为采样速度或者采样频率）定义了每秒从连续信号中提取并组成离散信号的采样个数，它用赫兹（Hz）来表示。采样率是指将模拟信号转换成数字信号时的采样频率，也就是单位时间内采样多少点。一个采样点数据有多少个比特。比特率是指每秒传送的比特(bit)数。单位为 bps(Bit Per Second)，比特率越高，传送的数据越大，音质越好。比特率=采样率x采用位数x声道数 </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;MPEG-4是一套用于音频，视频信息的压缩编码标准，由国际标准化组织和国际电工委员会下属的动态影像专家组(Moving Picture Experts Group，即MPEG)制定，第一版在1998年10月通过，第二版在1999年12月通过。MPEG-4格式的主要用途在于网络上流、光盘、语音发送(视频电话)，以及电视广播。MPEG-4包含了MPEG-1及MPEG-2的绝大部分功能及其他格式的长处，并加入及扩展对虚拟现实模型语言的支持，面向对象的合成文件，以及数字版权管理(DRM)及其他交互功能。&lt;/p&gt;
&lt;p class=&quot;description&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="技术" scheme="https://blog.kixcs.com/categories/technique/"/>
    
    
      <category term="Video" scheme="https://blog.kixcs.com/tags/Video/"/>
    
  </entry>
  
  <entry>
    <title>Hitokoto一言API及微软Bing每日壁纸API的实现</title>
    <link href="https://blog.kixcs.com/archives/3869/"/>
    <id>https://blog.kixcs.com/archives/3869/</id>
    <published>2020-03-06T14:22:55.000Z</published>
    <updated>2020-03-06T14:45:54.396Z</updated>
    
    <content type="html"><![CDATA[<p class="description">一言网(Hitokoto.cn)创立于2016年，隶属于萌创Team，目前网站主要提供一句话服务。“动漫也好、小说也好、网络也好，不论在哪里，我们总会看到有那么一两个句子能穿透你的心。我们把这些句子汇聚起来，形成一言网络，以传递更多的感动。如果可以，我们希望我们没有停止服务的那一天。”简单来说，一言指的就是一句话，可以是动漫中的台词，也可以是网络上的各种小段子。或是感动，或是开心，有或是单纯的回忆，与大家分享，这就是一言存在的目的。</p><a id="more"></a><h4 id="Hitokoto一言API"><a href="#Hitokoto一言API" class="headerlink" title="Hitokoto一言API"></a>Hitokoto一言API</h4><p>下面简单介绍本站部署Hitokoto一言API的过程：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//Ps：喜欢使用官方接口也可以前往官方的API介绍地址参考部署：https://hitokoto.cn/api</span></span><br><span class="line"><span class="comment">//获取句子文件的绝对路径</span></span><br><span class="line"><span class="comment">//如果你介意别人可能会拖走这个文本，可以将文件名自定义一下，或者通过配置文件权限，禁止Nginx拉取也行。</span></span><br><span class="line">$path = dirname(<span class="keyword">__FILE__</span>);</span><br><span class="line">$file = file($path.<span class="string">"/hitokoto.txt"</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//随机读取一行</span></span><br><span class="line">$arr  = mt_rand( <span class="number">0</span>, count( $file ) - <span class="number">1</span> );</span><br><span class="line">$content  = trim($file[$arr]);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//编码判断，用于输出相应的响应头部编码</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'charset'</span>]) &amp;&amp; !<span class="keyword">empty</span>($_GET[<span class="string">'charset'</span>])) &#123;</span><br><span class="line">    $charset = $_GET[<span class="string">'charset'</span>];</span><br><span class="line">    <span class="keyword">if</span> (strcasecmp($charset,<span class="string">"gbk"</span>) == <span class="number">0</span> ) &#123;</span><br><span class="line">        $content = mb_convert_encoding($content,<span class="string">'gbk'</span>, <span class="string">'utf-8'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $charset = <span class="string">'utf-8'</span>;</span><br><span class="line">&#125;</span><br><span class="line">header(<span class="string">"Content-Type: text/html; charset=$charset"</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//格式化判断，输出js或纯文本</span></span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">'format'</span>] === <span class="string">'js'</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"function hitokoto()&#123;document.write('"</span> . $content .<span class="string">"');&#125;"</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> $content;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**以上代码保存为index.php，然后上传到网站根目录下的hitokoto文件夹（这个自己随机定义）即可。</span></span><br><span class="line"><span class="comment">*把hitokoto.txt上传至网站目录，并写入相应内容。</span></span><br><span class="line"><span class="comment">*尽管如此，倘若有高并发请求的业务需求，推荐使用MySQL来进行内容管理。</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>现在，通过域名/路径就可以看到返回的结果了。[<span class="exturl" data-url="aHR0cHM6Ly9teWRvbWFpbi5jb20vaGl0b2tvdG9d" title="https://mydomain.com/hitokoto]">https://mydomain.com/hitokoto]<i class="fa fa-external-link"></i></span><br>部署方法如下所示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"https://你的域名/hitokoto/?format=js&amp;charset=utf-8"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;div id="hitokoto"&gt;&lt;script&gt;hitokoto()&lt;/</span>script&gt;&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure><h4 id="微软Bing每日壁纸API"><a href="#微软Bing每日壁纸API" class="headerlink" title="微软Bing每日壁纸API"></a>微软Bing每日壁纸API</h4><p>必应美图官方的 API 接口如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;国内版</span><br><span class="line">https:&#x2F;&#x2F;cn.bing.com&#x2F;HPImageArchive.aspx?idx&#x3D;0&amp;n&#x3D;1</span><br><span class="line">https:&#x2F;&#x2F;cn.bing.com&#x2F;HPImageArchive.aspx?format&#x3D;js&amp;idx&#x3D;0&amp;n&#x3D;1&amp;mkt&#x3D;zh-CN</span><br><span class="line">&#x2F;&#x2F;国际版[From: https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;10639914&#x2F;is-there-a-way-to-get-bings-photo-of-the-day]</span><br><span class="line">https:&#x2F;&#x2F;www.bing.com&#x2F;HPImageArchive.aspx?format&#x3D;js&amp;idx&#x3D;0&amp;n&#x3D;1</span><br><span class="line">XML: https:&#x2F;&#x2F;www.bing.com&#x2F;HPImageArchive.aspx?format&#x3D;xml&amp;idx&#x3D;0&amp;n&#x3D;1&amp;mkt&#x3D;en-US</span><br><span class="line">JSON: https:&#x2F;&#x2F;www.bing.com&#x2F;HPImageArchive.aspx?format&#x3D;js&amp;idx&#x3D;0&amp;n&#x3D;1&amp;mkt&#x3D;en-US</span><br><span class="line">RSS: https:&#x2F;&#x2F;www.bing.com&#x2F;HPImageArchive.aspx?format&#x3D;rss&amp;idx&#x3D;0&amp;n&#x3D;1&amp;mkt&#x3D;en-US</span><br></pre></td></tr></table></figure><p>其中参数说明:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">参数名称                值含义</span><br><span class="line"></span><br><span class="line">format(非必需)      返回数据格式，未定义则默认返回XML格式</span><br><span class="line">                       •js(常使用，返回JSON格式)</span><br><span class="line">                       •xml(返回XML格式)</span><br><span class="line"></span><br><span class="line">idx(非必需)         请求图片截止天数</span><br><span class="line">                       •0(今天) </span><br><span class="line">                       •-1(截止到明天，预准备) </span><br><span class="line">                       •1(截止至昨天，最多支持获取7天前的图片) </span><br><span class="line"></span><br><span class="line">n(必需)             1-8返回请求数量，目前最多一次获取8张</span><br><span class="line"></span><br><span class="line">mkt(非必需)         国家&#x2F;地区代码</span><br><span class="line">                       •zh-CN(中国) </span><br><span class="line">                       •en-US(美国)</span><br></pre></td></tr></table></figure><p>根据官方API返回的内容，对域名和url字段进行拼接即可得到图片地址。该.php文件内容如下:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> Template Name: API-BingPicture</span></span><br><span class="line"><span class="comment"> description: template for TOMORROW 星辰</span></span><br><span class="line"><span class="comment"> https://www.tomorrow.wiki/archives/453</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">if</span>(file_exists(<span class="string">"bingDaily.jpg"</span>))</span><br><span class="line">&#123;</span><br><span class="line">    $time = time();</span><br><span class="line">         </span><br><span class="line">    <span class="comment">//文件修改时间和现在时间相差 24 小时以下的话，直接导向静态文件 jpg，否则重新生成 jpg</span></span><br><span class="line">    <span class="keyword">if</span>($time - filemtime(<span class="string">"bingDaily.jpg"</span>) &lt; <span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        header(<span class="string">"Location:./bingDaily.jpg"</span>);</span><br><span class="line">      <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$str=file_get_contents(<span class="string">'https://cn.bing.com/HPImageArchive.aspx?idx=0&amp;n=1'</span>);</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/(.+?)&lt;\/url&gt;/ies"</span>, $str, $matches)) </span><br><span class="line">&#123;</span><br><span class="line">$imgurl=<span class="string">'https://cn.bing.com'</span>.$matches[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line">ob_end_clean();</span><br><span class="line">ob_start(); </span><br><span class="line">header(<span class="string">'Content-Type: image/JPEG'</span>);</span><br><span class="line">@readfile($imgurl);</span><br><span class="line">$temp =  ob_get_contents(); </span><br><span class="line">@ob_flush();</span><br><span class="line">$fp = fopen(<span class="string">"bingDaily.jpg"</span>,<span class="string">'w'</span>); </span><br><span class="line">fwrite($fp,$temp) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'写文件错误'</span>); </span><br><span class="line">header(<span class="string">"Location:./bingDaily.jpg"</span>);</span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>最后，附上两条集成的API(对API进行外部资源引用注意Nginx的跨域配置问题):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;已拦截跨源请求：同源策略禁止读取位于 https:&#x2F;&#x2F;api.kixcs.com&#x2F;hitokoto&#x2F;?encode&#x3D;json 的远程资源。</span><br><span class="line">（原因：CORS 头缺少 &#39;Access-Control-Allow-Origin&#39;）。</span><br><span class="line">&#x2F;&#x2F;.php文件中，开启跨域Ajax支持。</span><br><span class="line">header(&#39;Access-Control-Allow-Origin:*&#39;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;或者Nginx配置</span><br><span class="line"> location &#x2F; &#123;</span><br><span class="line">            # 允许 所有头部 所有域 所有方法</span><br><span class="line">            add_header &#39;Access-Control-Allow-Origin&#39; &#39;*&#39;;</span><br><span class="line">            add_header &#39;Access-Control-Allow-Headers&#39; &#39;*&#39;;</span><br><span class="line">            add_header &#39;Access-Control-Allow-Methods&#39; &#39;*&#39;;</span><br><span class="line">            # OPTIONS 直接返回204</span><br><span class="line">            if ($request_method &#x3D; &#39;OPTIONS&#39;) &#123;</span><br><span class="line">                return 200;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;api.kixcs.com&#x2F;hitokoto&#x2F;</span><br><span class="line">https:&#x2F;&#x2F;api.kixcs.com&#x2F;bing</span><br></pre></td></tr></table></figure><h4 id="备选方法"><a href="#备选方法" class="headerlink" title="备选方法"></a>备选方法</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">define(<span class="string">'IN_HITOKOTO'</span>, <span class="keyword">TRUE</span>);</span><br><span class="line">header(<span class="string">'Content-Type: text/html; charset=UTF-8'</span>);</span><br><span class="line"><span class="comment">//开启跨域Ajax支持</span></span><br><span class="line">header(<span class="string">'Access-Control-Allow-Origin:*'</span>);</span><br><span class="line"><span class="comment">//初始化资源文件</span></span><br><span class="line">$array = file(<span class="string">'./content.php'</span>);</span><br><span class="line"><span class="comment">//参数传递</span></span><br><span class="line">$encode = $_GET[<span class="string">'encode'</span>];</span><br><span class="line">$id = $_GET[<span class="string">'id'</span>];</span><br><span class="line"><span class="comment">//一言开始行数（0为验证行）</span></span><br><span class="line">$id_min = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//一言结束行数</span></span><br><span class="line">$id_max = <span class="number">3388</span>;</span><br><span class="line"><span class="comment">//随机 - 判断数字</span></span><br><span class="line"><span class="keyword">if</span> (!$id == <span class="keyword">NULL</span> &amp;&amp; is_numeric($id))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//判断大小</span></span><br><span class="line">    <span class="keyword">if</span> ($id &gt;= $id_min &amp;&amp; $id &lt;= $id_max)</span><br><span class="line">    &#123;</span><br><span class="line">        $number = $id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        $number = rand($id_min,$id_max);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    $number = rand($id_min,$id_max);</span><br><span class="line">&#125;</span><br><span class="line">$string = $array[$number];</span><br><span class="line"><span class="comment">//判断输出类型</span></span><br><span class="line"><span class="keyword">if</span> ($encode == <span class="string">'javascript'</span> || $encode == <span class="string">'js'</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'function getHitokoto()&#123;document.write("'</span>,trim($string),<span class="string">'");&#125;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> trim($string);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用UTF-8-BOM编码（content.php），注意一言文本行数要与index.php中的$id_max匹配。</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">if</span>(!defined(<span class="string">'IN_HITOKOTO'</span>))&#123;<span class="keyword">echo</span> <span class="string">"Access Denied."</span>;<span class="keyword">exit</span>();&#125;;<span class="meta">?&gt;</span></span><br><span class="line">你们媒体千万要注意啊，不要“见着风，是得雨”啊。</span><br><span class="line">接到这些消息，你媒体本身也要判断，明白意思吗？</span><br><span class="line">假使这些完全……无中生有的东西，你再帮他说一遍，你等于……你也等于……你也有责任吧？</span><br><span class="line">..........</span><br><span class="line">..........</span><br></pre></td></tr></table></figure><p>请求方式:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$id</span><br><span class="line">Normal: Random ID</span><br><span class="line">Option: $id_min ~ $id_max</span><br><span class="line">Request URL: https:&#x2F;&#x2F;api.kixcs.com&#x2F;hitokoto&#x2F;?id&#x3D;2</span><br><span class="line">Request Method: GET</span><br><span class="line">Respond:接到这些消息，你媒体本身也要判断，明白意思吗？</span><br><span class="line">(The id of this sentence is 2.)</span><br><span class="line"></span><br><span class="line">$encode</span><br><span class="line">Normal: text</span><br><span class="line">Option: javascript or js</span><br><span class="line">Request URL: https:&#x2F;&#x2F;api.kixcs.com&#x2F;hitokoto&#x2F;?encode&#x3D;js</span><br><span class="line">Request Method: GET</span><br><span class="line">Respond:function getHitokoto()&#123;document.write(&quot;我没有说要钦定，没有任何这个意思。&quot;);&#125;</span><br></pre></td></tr></table></figure><p>前端页面中，使用如下代码进行调用:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"https://api.kixcs.com/hitokoto/?encode=javascript"</span>&gt;&lt;<span class="regexp">/script&gt; </span></span><br><span class="line"><span class="regexp">&lt;span class="getHitokoto"&gt;&lt;script&gt;getHitokoto()&lt;/</span>script&gt;&lt;<span class="regexp">/span&gt;</span></span><br></pre></td></tr></table></figure><p>注意，倘若控制台出现:”Refused to execute script from because its MIME type (‘text/html’) is not executable, and strict MIME type checking is enabled.”类似错误，JS的MIME的type=”text/javascript”配置正确，则有可能是CDN引发的问题。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//github.com/rails/webpacker/issues/1651</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p class=&quot;description&quot;&gt;
一言网(Hitokoto.cn)创立于2016年，隶属于萌创Team，目前网站主要提供一句话服务。“动漫也好、小说也好、网络也好，不论在哪里，我们总会看到有那么一两个句子能穿透你的心。我们把这些句子汇聚起来，形成一言网络，以传递更多的感动。如果可以，我们希望我们没有停止服务的那一天。”
简单来说，一言指的就是一句话，可以是动漫中的台词，也可以是网络上的各种小段子。或是感动，或是开心，有或是单纯的回忆，与大家分享，这就是一言存在的目的。
&lt;/p&gt;
    
    </summary>
    
    
      <category term="设计" scheme="https://blog.kixcs.com/categories/design/"/>
    
    
      <category term="API" scheme="https://blog.kixcs.com/tags/API/"/>
    
  </entry>
  
  <entry>
    <title>一些前端JS CDN开源库的国内镜像及Hexo相关配置</title>
    <link href="https://blog.kixcs.com/archives/9e1/"/>
    <id>https://blog.kixcs.com/archives/9e1/</id>
    <published>2020-03-03T13:56:39.000Z</published>
    <updated>2021-01-14T14:29:02.129Z</updated>
    
    <content type="html"><![CDATA[<p>由于国内外互联网的环境差异，许多开源的JS库均采用海外CDN托管的方式，致使无法保证大陆的访问体验。因此特此分享一下公益项目，托管了CDNJS的所有开源JS库以及反代了Google Fonts、Ajax和Gravatar，并且全部支持http和https。该公益库每天定时同步CDN，抑或是采用Nginx的反向代理配合关键词替换的方式实现。倘若觉得麻烦，可以通过jsdelivr配合GitHub来保证境内的网络响应速度，前者貌似是唯一一家在国内取得ICP执照的公共CDN，在国内合作伙伴为网宿科技。</p><p class="description"></p><a id="more"></a><h4 id="CDNJS-开源JS库"><a href="#CDNJS-开源JS库" class="headerlink" title="CDNJS 开源JS库"></a>CDNJS 开源JS库</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//所有的JS/CSS库如下链接所示:</span></span><br><span class="line">https:<span class="comment">//cdnjs.loli.net/ajax/libs/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//如果使用 cdnjs.com 只需要替换 cdnjs.cloudflare.com 为 cdnjs.loli.net 即可，如</span></span><br><span class="line">&lt;script src=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;script src="https:/</span><span class="regexp">/cdnjs.loli.net/</span>ajax/libs/jquery/<span class="number">3.2</span><span class="number">.1</span>/jquery.min.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//CDNJS的API开发文档请详见 https://cdnjs.com/api</span></span><br></pre></td></tr></table></figure><h4 id="Google-Fonts"><a href="#Google-Fonts" class="headerlink" title="Google Fonts"></a>Google Fonts</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//只需要替换 fonts.googleapis.com 为 fonts.loli.net 即可</span></span><br><span class="line">&lt;link href=<span class="string">'https://fonts.googleapis.com/css?family=Open+Sans'</span> rel=<span class="string">'stylesheet'</span>&gt;</span><br><span class="line">&lt;link href=<span class="string">'https://fonts.loli.net/css?family=Open+Sans'</span> rel=<span class="string">'stylesheet'</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果需要 Material icons ，可进行如下替换:</span></span><br><span class="line"><span class="comment">//https://material.io/icons/</span></span><br><span class="line">&lt;link href=<span class="string">'https://fonts.googleapis.com/icon?family=Material+Icons'</span> rel=<span class="string">'stylesheet'</span>&gt;</span><br><span class="line">&lt;link href=<span class="string">'https://fonts.loli.net/icon?family=Material+Icons'</span> rel=<span class="string">'stylesheet'</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果需要 Early Access，可进行如下替换:</span></span><br><span class="line"><span class="comment">//https://fonts.google.com/earlyaccess</span></span><br><span class="line">@<span class="keyword">import</span> url(https:<span class="comment">//fonts.googleapis.com/earlyaccess/notosanskannada.css); </span></span><br><span class="line">@<span class="keyword">import</span> url(https:<span class="comment">//fonts.loli.net/earlyaccess/notosanskannada.css); </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//如果需要下载单个字体，只需要把 fonts.gstatic.com 替换成 gstatic.loli.net 或 themes.googleusercontent.com 替换成 themes.loli.net 即可</span></span><br><span class="line">https:<span class="comment">//fonts.gstatic.com/s/opensans/v14/K88pR3goAWT7BTt32Z01mxJtnKITppOI_IvcXXDNrsc.woff2</span></span><br><span class="line">https:<span class="comment">//gstatic.loli.net/s/opensans/v14/K88pR3goAWT7BTt32Z01mxJtnKITppOI_IvcXXDNrsc.woff2</span></span><br><span class="line"></span><br><span class="line">https:<span class="comment">//themes.googleusercontent.com/static/fonts/anonymouspro/v3/Zhfjj_gat3waL4JSju74E-V_5zh5b-_HiooIRUBwn1A.ttf</span></span><br><span class="line">https:<span class="comment">//themes.loli.net/static/fonts/anonymouspro/v3/Zhfjj_gat3waL4JSju74E-V_5zh5b-_HiooIRUBwn1A.ttf</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Google Fonts的API文档请详见: https://developers.google.com/fonts/docs/getting_started</span></span><br></pre></td></tr></table></figure><h4 id="Google前端公共库"><a href="#Google前端公共库" class="headerlink" title="Google前端公共库"></a>Google前端公共库</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直接替换 ajax.googleapis.com 为 ajax.loli.net 即可，如</span></span><br><span class="line">&lt;script type=<span class="string">'text/javascript'</span> src=<span class="string">'https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js'</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;script type='text/</span>javascript<span class="string">' src='</span>https:<span class="comment">//ajax.loli.net/ajax/libs/jquery/3.2.1/jquery.min.js'&gt;&lt;/script&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Google前端库API开发文档详见: https://developers.google.com/speed/libraries/</span></span><br></pre></td></tr></table></figure><h4 id="Gravatar-头像"><a href="#Gravatar-头像" class="headerlink" title="Gravatar 头像"></a>Gravatar 头像</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直接替换 *.gravatar.com 为 gravatar.loli.net 即可</span></span><br><span class="line">https:<span class="comment">//secure.gravatar.com/avatar/233</span></span><br><span class="line">https:<span class="comment">//gravatar.loli.net/avatar/233</span></span><br></pre></td></tr></table></figure><p>鸣谢<span class="exturl" data-url="aHR0cHM6Ly9zYi5zYi9ibG9nL2Nzcy1jZG4v" title="https://sb.sb/blog/css-cdn/">烧饼博客<i class="fa fa-external-link"></i></span>的无私分享和长久以来的维护工作，再次感谢~</p><h4 id="Hexo修改字体"><a href="#Hexo修改字体" class="headerlink" title="Hexo修改字体"></a>Hexo修改字体</h4><h5 id="修改-config-yml"><a href="#修改-config-yml" class="headerlink" title="修改 _config.yml"></a>修改 _config.yml</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//文件路径：~/blog/themes/next/_config.yml，将下列代码中的部分替换即可。</span></span><br><span class="line">font:</span><br><span class="line">- enable: <span class="literal">false</span></span><br><span class="line">+ enable: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  # Uri of fonts host. E.g. //fonts.googleapis.com (Default).</span><br><span class="line">+ host: https:<span class="comment">//fonts.loli.net</span></span><br><span class="line"></span><br><span class="line">  # Font options:</span><br><span class="line">  # `external: true` will load this font family from `host` above.</span><br><span class="line">  # `family: Times New Roman`. Without any quotes.</span><br><span class="line">  # `size: xx`. Use `px` as unit.</span><br><span class="line"></span><br><span class="line">  # Global font settings used for all elements in &lt;body&gt;.</span><br><span class="line">  global:</span><br><span class="line">    external: <span class="literal">true</span></span><br><span class="line">+   family: Noto Serif SC</span><br><span class="line">    size:</span><br></pre></td></tr></table></figure><h5 id="修改-base-styl"><a href="#修改-base-styl" class="headerlink" title="修改 base.styl"></a>修改 base.styl</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//文件路径：~/blog/themes/next/source/css/_variables/base.styl</span></span><br><span class="line">-$font-family-monospace    = consolas, Menlo, $font-family-chinese, monospace</span><br><span class="line">+$font-family-monospace    = consolas, Menlo, $font-family-base, monospace</span><br><span class="line">-$font-family-monospace    = get_font_family(<span class="string">'codes'</span>), consolas, Menlo, $font-family-chinese, monospace <span class="keyword">if</span> get_font_family(<span class="string">'codes'</span>)</span><br><span class="line">+$font-family-monospace    = get_font_family(<span class="string">'codes'</span>), consolas, Menlo, $font-family-base, monospace <span class="keyword">if</span> get_font_family(<span class="string">'codes'</span>)</span><br></pre></td></tr></table></figure><h5 id="设置文字大小"><a href="#设置文字大小" class="headerlink" title="设置文字大小"></a>设置文字大小</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//文件路径：~/blog/themes/next/source/css/_variables/base.styl</span></span><br><span class="line"><span class="comment">//_config.yml中设置size属性为16px可能效果不理想</span></span><br><span class="line">$font-size-base     = <span class="number">16</span>px</span><br></pre></td></tr></table></figure><h5 id="更改字体颜色"><a href="#更改字体颜色" class="headerlink" title="更改字体颜色"></a>更改字体颜色</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//文件路径：~/blog/themes/next/source/css/_custom/custom.styl</span></span><br><span class="line"><span class="comment">//新版本NexT配置文件路径为: Hexo/MyBlog/source/_data/styles.styl，须在配置文件中启用。</span></span><br><span class="line"><span class="comment">//修改字体颜色</span></span><br><span class="line">body &#123;</span><br><span class="line">    color: #000;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="GitHub代理设置"><a href="#GitHub代理设置" class="headerlink" title="GitHub代理设置"></a>GitHub代理设置</h4><h5 id="Global-Proxy"><a href="#Global-Proxy" class="headerlink" title="Global Proxy"></a>Global Proxy</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.proxy http:<span class="comment">//127.0.0.1:2080</span></span><br><span class="line">git config --global https.proxy https:<span class="comment">//127.0.0.1:2080</span></span><br></pre></td></tr></table></figure><h5 id="GitHub-Proxy"><a href="#GitHub-Proxy" class="headerlink" title="GitHub Proxy"></a>GitHub Proxy</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*可以做到国内外仓库的Git分流</span></span><br><span class="line"><span class="comment">*注:无论是Git的全局代理还是GitHub分流代理，都是基于HTTPS协议的。</span></span><br><span class="line"><span class="comment">* 仅对 git clone https://github.com/[ID]/[repositories].git生效</span></span><br><span class="line"><span class="comment">* 对于SSH协议依旧无效，如: git clone git@github.com:[ID]/[repositories].git </span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">git config --global http.https:<span class="comment">//github.com.proxy https://127.0.0.1:2080</span></span><br><span class="line">git config --global https.https:<span class="comment">//github.com.proxy https://127.0.0.1:2080</span></span><br></pre></td></tr></table></figure><h5 id="Sock5-Proxy"><a href="#Sock5-Proxy" class="headerlink" title="Sock5 Proxy"></a>Sock5 Proxy</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.https:<span class="comment">//github.com.proxy socks5://127.0.0.1:2080</span></span><br><span class="line">git config --global https.https:<span class="comment">//github.com.proxy socks5://127.0.0.1:2080</span></span><br></pre></td></tr></table></figure><h5 id="Cancel-Proxy"><a href="#Cancel-Proxy" class="headerlink" title="Cancel Proxy"></a>Cancel Proxy</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global --unset http.proxy</span><br><span class="line">git config --global --unset https.proxy</span><br></pre></td></tr></table></figure><h5 id="Proxy-Info"><a href="#Proxy-Info" class="headerlink" title="Proxy Info"></a>Proxy Info</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global -l</span><br></pre></td></tr></table></figure><h4 id="GitHub-SSH设置"><a href="#GitHub-SSH设置" class="headerlink" title="GitHub SSH设置"></a>GitHub SSH设置</h4><p>新建~/.ssh/config文件，内容如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">Hostname github.com</span><br><span class="line">ProxyCommand connect -S <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">2080</span> %h %p</span><br></pre></td></tr></table></figure><p>Hexo配置文件内容进行如下调整：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/deployment.html</span></span><br><span class="line"><span class="comment"># git clone git@github.com:[ID]/[repositories].git </span></span><br><span class="line"><span class="comment"># repository: https://github.com/KuiperSirius/KuiperSirius.github.io.git</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">'git'</span></span><br><span class="line">  <span class="attr">repository:</span> <span class="string">git@github.com:KuiperSirius/KuiperSirius.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Extensions</span></span><br><span class="line">  <span class="comment">## Plugins: http://hexo.io/plugins/</span></span><br><span class="line">  <span class="comment">#RSS订阅</span></span><br><span class="line">  <span class="attr">plugin:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">hexo-generator-feed</span></span><br><span class="line">  <span class="comment">#Feed Atom</span></span><br><span class="line">  <span class="attr">feed:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">atom</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">atom.xml</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">20</span></span><br></pre></td></tr></table></figure><h4 id="GitHub-GPG设置"><a href="#GitHub-GPG设置" class="headerlink" title="GitHub GPG设置"></a>GitHub GPG设置</h4><p>首先，列出您拥有其公钥和私钥的GPG密钥，签名提交或标记需要私钥：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> gpg --list-secret-keys --keyid-format LONG</span></span><br><span class="line">/Users/hubot/.gnupg/secring.gpg</span><br><span class="line">------------------------------------</span><br><span class="line">sec   4096R/3AA5C34371567BD2 2016-03-10 [expires: 2017-03-10]</span><br><span class="line">uid                          Hubot </span><br><span class="line">ssb   4096R/42B317FD4BA89E7A 2016-03-10</span><br></pre></td></tr></table></figure><p>其次，需要让Git知道签名所用的GPG密钥ID：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.signingkey &#123;key_id&#125;</span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --global user.signingkey 3AA5C34371567BD2</span></span><br></pre></td></tr></table></figure><p>然后，在每次commit的时候，加上-S参数，表示这次提交需要用GPG密钥进行签名：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -S -m "..."</span><br></pre></td></tr></table></figure><p>如果觉得每次都需要手动加上-S有些麻烦，可以设置Git为每次commit自动要求签名：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global commit.gpgsign true</span><br></pre></td></tr></table></figure><p>但不论是否需要手动加上-S，commit时皆会弹出对话框，需要输入该密钥的密码，以确保是密钥拥有者本人操作。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;由于国内外互联网的环境差异，许多开源的JS库均采用海外CDN托管的方式，致使无法保证大陆的访问体验。因此特此分享一下公益项目，托管了CDNJS的所有开源JS库以及反代了Google Fonts、Ajax和Gravatar，并且全部支持http和https。该公益库每天定时同步CDN，抑或是采用Nginx的反向代理配合关键词替换的方式实现。倘若觉得麻烦，可以通过jsdelivr配合GitHub来保证境内的网络响应速度，前者貌似是唯一一家在国内取得ICP执照的公共CDN，在国内合作伙伴为网宿科技。&lt;/p&gt;
&lt;p class=&quot;description&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="设计" scheme="https://blog.kixcs.com/categories/design/"/>
    
    
      <category term="CDN" scheme="https://blog.kixcs.com/tags/CDN/"/>
    
      <category term="Fonts" scheme="https://blog.kixcs.com/tags/Fonts/"/>
    
  </entry>
  
  <entry>
    <title>利用GitHub仓库分支备份Hexo博客源文件</title>
    <link href="https://blog.kixcs.com/archives/a2af/"/>
    <id>https://blog.kixcs.com/archives/a2af/</id>
    <published>2020-03-01T14:29:13.000Z</published>
    <updated>2020-03-04T14:36:36.163Z</updated>
    
    <content type="html"><![CDATA[<p class="description">Hexo静态部署到托管平台很方便，考虑到异地更新并提交Hexo博客内容的需求，可以考虑通过仓库的多分支来解决。hexo部署命令生成的静态网址默认是保存在github_name/github_name.github.io的master分支上，因此，可以在原有的基础上增加一个hexo_source分支保存网址原始数据，并将这个分支设置为默认分支。如此以来，系统环境配置完成后，每次恢复和迁移文件时候只需要git clone即可获取迁移的文件了。 </p><a id="more"></a><h4 id="更改仓库的默认分支"><a href="#更改仓库的默认分支" class="headerlink" title="更改仓库的默认分支"></a>更改仓库的默认分支</h4><p>GitHub上的仓库初始都会有个master分支，也就是默认分支。对于一个仓库project_name，当我们通过git clone <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0t1aXBlclNpcml1cy9wcm9qZWN0X25hbWUuZ2l0" title="https://github.com/KuiperSirius/project_name.git">https://github.com/KuiperSirius/project_name.git<i class="fa fa-external-link"></i></span> 下载代码时，实际拉取的是默认分支master对应的代码。而使用hexo写博客时，通常是与md源文件打交道，对于deploy生成的master分支代码并不需要我们关注，因此可将仓库的默认分支改为保存源码的source分支，这样通过git clone拉取的就是source分支代码了。</p><h4 id="Git准备工作"><a href="#Git准备工作" class="headerlink" title="Git准备工作"></a>Git准备工作</h4><p>通常情况下，在原Hexo托管的仓库上建立分支，并确保原仓库内已有master分支(该分支通常被用于GitHub Pages的默认绑定)。进入本地博客根目录，进行如下操作。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">git初始化</span></span><br><span class="line">git init</span><br><span class="line"><span class="meta">#</span><span class="bash">初始化完成之后，添加修改的文件，由于Hexo就自带了.gitignore文件，即需要忽略的文件，add 全部文件。</span></span><br><span class="line">git add .</span><br><span class="line"><span class="meta">#</span><span class="bash">然后commit提交</span></span><br><span class="line">git commit -m "commit first time|描述内容"</span><br><span class="line"><span class="meta">#</span><span class="bash">提交成功之后，接下来需要push到github项目地址，需要先把Hexo源文件映射到远程resposity上。</span></span><br><span class="line">git remote add origin https://github.com/your-name/your-name.github.io.git</span><br></pre></td></tr></table></figure><p>.gitignore文件内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.DS_Store</span><br><span class="line">Thumbs.db</span><br><span class="line">db.json</span><br><span class="line">*.log</span><br><span class="line">node_modules/</span><br><span class="line">public/</span><br><span class="line">.deploy*/</span><br></pre></td></tr></table></figure><h4 id="创建新分支"><a href="#创建新分支" class="headerlink" title="创建新分支"></a>创建新分支</h4><p>接下来的工作即为将Hexo源文件push上去，其中仓库的master上是Hexo生成博客网页的代码，而Hexo源文件是要push到一个分支上面的，进行如下操作。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">所以接下来先要在repo上新建一个叫<span class="built_in">source</span>的分支</span></span><br><span class="line">git branch source</span><br><span class="line"><span class="meta">#</span><span class="bash">查看本地分支，并且切换到<span class="built_in">source</span>分支。</span></span><br><span class="line">git branch</span><br><span class="line">git checkout source</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">下列两步可酌情跳过</span></span><br><span class="line"><span class="meta">#</span><span class="bash">拉取远程代码，再把刚才添加的Hexo源文件代码push到<span class="built_in">source</span>这个分支。</span></span><br><span class="line">git pull origin master</span><br><span class="line">git push -u origin source</span><br></pre></td></tr></table></figure><h4 id="在Github上备份源文件"><a href="#在Github上备份源文件" class="headerlink" title="在Github上备份源文件"></a>在Github上备份源文件</h4><p>本地的博客源文件的修改就可以直接用git命令push到repo的source分支上了，通过如下命令将本地文件备份到Github上，假设目前在hexo博客的根目录下。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">添加修改内容到本地仓储</span></span><br><span class="line">git add .</span><br><span class="line"><span class="meta">#</span><span class="bash">提交修改内容到本地仓库</span></span><br><span class="line">git commit -m "Backup"</span><br><span class="line">git push [-f] origin source</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">或者配置push，以方便后期直接git push推送</span></span><br><span class="line">git push --set-upstream origin source</span><br><span class="line"><span class="meta">#</span><span class="bash">将本地分支和分支下的内容推送到远程</span></span><br><span class="line">git push</span><br><span class="line"><span class="meta">#</span><span class="bash">注意：执行 git push --<span class="built_in">set</span>-upstream origin <span class="built_in">source</span> 命令之后，以后修改博客源文件代码之后，直接使用git push不用再指定分支，就可以把代码push到<span class="built_in">source</span>分支上了。</span></span><br></pre></td></tr></table></figure><h4 id="结语及注意事项"><a href="#结语及注意事项" class="headerlink" title="结语及注意事项"></a>结语及注意事项</h4><p>建议先备份文件再生成博客。即先执行[git add .],[git commit -m “Date-Backup”],[git push origin source]将博客备份完成，然后执行hexo g -d发布博客。</p><p>确保hexo deploy推送的是master分支，hexo目录下的_config.yml文件通常会配置deploy推送的目标地址，这个一般在最初使用hexo时，就会配置为master，无需改动。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Deployment</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Docs: https://hexo.io/docs/deployment.html</span></span></span><br><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: https://github.com/KuiperSirius/KuiperSirius.github.io.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure><p>更换设备后，在配置好Hexo的环境下，把博客源文件代码克隆下来。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git clone ****** (Your repo address)</span><br><span class="line"><span class="meta">#</span><span class="bash">博客源文件下载下来之后，默认的分支是master，需要切换到<span class="built_in">source</span>分支。</span></span><br><span class="line">git checkout master/source</span><br><span class="line"><span class="meta">#</span><span class="bash">然后切换到博客目录依次执行以下命令</span></span><br><span class="line">npm install hexo</span><br><span class="line">npm install</span><br><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><p>注: 上述操作存在不完善的地方，仍然建议使用Google Drive/One Cloud等云存储备份站点文件。themes目录以内中的主题文件夹存在的.git目录，因为一个git仓库中不能包含另一个git仓库，否则提交主题文件夹会失败，出现远程仓库无法备份theme/next主题的问题。<br>详见:<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2lpc3NuYW4vaGV4by10aGVtZS1uZXh0L2lzc3Vlcy85MzI=" title="https://github.com/iissnan/hexo-theme-next/issues/932">https://github.com/iissnan/hexo-theme-next/issues/932<i class="fa fa-external-link"></i></span></p>]]></content>
    
    <summary type="html">
    
      &lt;p class=&quot;description&quot;&gt;
Hexo静态部署到托管平台很方便，考虑到异地更新并提交Hexo博客内容的需求，可以考虑通过仓库的多分支来解决。hexo部署命令生成的静态网址默认是保存在github_name/github_name.github.io的master分支上，因此，可以在原有的基础上增加一个hexo_source分支保存网址原始数据，并将这个分支设置为默认分支。如此以来，系统环境配置完成后，每次恢复和迁移文件时候只需要git clone即可获取迁移的文件了。 
&lt;/p&gt;
    
    </summary>
    
    
      <category term="技术" scheme="https://blog.kixcs.com/categories/technique/"/>
    
    
      <category term="GitHub" scheme="https://blog.kixcs.com/tags/GitHub/"/>
    
  </entry>
  
  <entry>
    <title>西方哲学史 希腊哲学 [美]弗兰克·梯利</title>
    <link href="https://blog.kixcs.com/archives/25c7/"/>
    <id>https://blog.kixcs.com/archives/25c7/</id>
    <published>2020-02-27T11:44:56.000Z</published>
    <updated>2020-03-01T14:21:05.473Z</updated>
    
    <content type="html"><![CDATA[<p class="description">很少有民族的发展能够远远超出神话阶段，除去希腊，其他民族可能都没有发展出一一种真正的哲学。基于此，论述就从希腊人开始。他们不仅为后来所有的西方思想体系奠定基础，而且几乎提出了两千年来欧洲文明研究的所有问题和答案。从简单的神话开端发展到复杂全面的体系，他们的哲学是所有民族提供的例证中的最好例证之一。激励着希腊思想者的独立精神和对真理的爱从未被超越过，也极少有能与之匹敌者。对于较深的思辨思想感兴趣的研究者来说，研究希腊哲学应当是一件有吸引力、有价值的锻炼。</p><a id="more"></a><h4 id="第一节-希腊哲学史"><a href="#第一节-希腊哲学史" class="headerlink" title="第一节 希腊哲学史"></a>第一节 希腊哲学史</h4><p>我们说的希腊哲学史是指在希腊起源并得到发展的理智运动。但是我们不仅应当将希腊人自己的体系，而且应当将那些展现希腊思想特征并兴盛于雅典、罗马、亚历山大或小亚细亚等地的体系包括在内，因为这些体系很明显是希腊文明的产物。</p><h4 id="第二节-环境"><a href="#第二节-环境" class="headerlink" title="第二节 环境"></a>第二节 环境</h4><p>我们要研究其哲学的这个民族居住在多山的希腊半岛，这一区域的自然特征很适合个强壮有活力的民族发展。这里有许多港口，有利于航海和商业，为移民到各岛屿及大陆提供了口岸。希腊的殖民地从大陆到小亚细亚海岸，最后到埃及、西西里、意大利南部和赫拉克勒斯的石柱，构成了一条连续的链条;这些殖民地并没有同宗主国失去联系，在和有着不同风俗、传统和制度的民族的积极交往中，他们轻易从中获利。</p><p>由这些条件带来的令人惊异的经济进步，商业、工业和贸易的发展，城市的兴起，财富的积累和日益增加的劳动分工，这些都对整个希腊的社会、政治、理智和宗教生活产生了深刻的影响，为-个新的、更加丰富的文明开辟了道路。这一自然和人文环境有助于激励理智和意志;它给人们的生活和世界- -个更加宽阔的事业，激发了人们的批评和反思精神，促进了独特人格的发展，促成了人类思想和行动各个方面的发展。一个民族生来就具有敏锐的智慧、对知识的热望、精致的美感、注重实际的精力和雄心，这-环境为这个民族磨炼其力量和才能提供了物质资料，让它能够在政治、宗教道德、文学和哲学领域取得快速进步。</p><h4 id="第三节-政治"><a href="#第三节-政治" class="headerlink" title="第三节 政治"></a>第三节 政治</h4><p>在其本土和殖民地的希腊城邦的命运呈现了某些共同特征:任何地方都是从部族首长专制经过贵族统治进而演化到民主制。《荷马史诗》 所描述的社会是一个等级社会，政体形式是部族首长专制。少数人对财富和文化的获取导致了贵族统治形式的建立，随后是寡头政治的建立。随着社会条件的改变，公民阶级(平民)出现并开始夺取特权阶级的领导权。从贵族制到民主制的转变，公元前7世纪和6世纪，那些勇敢而负有雄心的人不断尝试从君主手中夺取权力，僭主制在整个希腊世界得以确立。最后人们自己掌握政权，僭主制让位于民主制。</p><h4 id="第四节-文学"><a href="#第四节-文学" class="headerlink" title="第四节 文学"></a>第四节 文学</h4><p>我们可以将这些变化中的社会和政治条件视为希腊人意识觉醒的结果。新运动既是启蒙的征兆，又是其原因:它是对传统日渐增长的反思和批评的外在标志:它产生于对旧制度的反对和变革的要求。公元前6世纪的希腊文学史显示了反思和批评精神的发展，这同它在政治生活中的发展相似。以反映童年时代的天真为特征的荷马式乐观和客观性渐渐消失，诗人变得不太乐观，更加有批判性和主观性。</p><p>甚至在荷马的著作中我们也发现了他对人类行为偶然的道德反思，反思凡人的愚味，生命的悲惨、短暂以及不正义的邪恶。在赫西俄德的著作中，批评和悲观的气氛更加浓厚;他的《工作与时日》是一本道德手册，这本书严厉批评了时代的弊端，提供了道德准则和生活中的实用守则，赞扬了朴素的美德,并悲叹过去的美好时光。公元前7世纪的诗人(阿乐凯奥斯、西蒙尼特斯、阿尔基洛科斯)以伤感和讽刺的笔调谴责僭主制的出现并悲叹人类的弱点，但是力劝他们要勇敢承受命运，让诸神来决定结果。</p><p>这种教诲的和悲观的精神在公元前6世纪的诗歌中甚至更加明显;民族的政治命运成为谈论的主题，事物的新秩序受到谴责(通常更加严厉)。这一时期有寓言作家伊索和所谓的格言诗人(梭伦、甫西里第斯、特奥格尼斯)，他们明智的准则包含了伦理反思，可以被认为是道德哲学的萌芽。个人开始分析和批评人生一而不只是在过活。他在考虑人生的意义不再满足于表达民族传统的思想和观念，被激励着去提出他个人的伦理、政治和宗教的思想、希望。实际上这一从更大范围更复杂的经验中产生的探.索和不满的精神在对人类行为以伦理和政治理论为形式的哲学研究中达到了顶峰。希腊人的宗教生活对于研究他们的哲学史来说特别重要，但是在希腊世界，宗教和哲学之间的关系既密切又复杂，因此对这种关系的概述必须忽略许多重要的考虑。而且柏拉图之前时期的历史证据非常不完整，没有定论，以致权威们在许多重要观点上争论不休。</p><h4 id="第五节-希腊哲学的宗教起源"><a href="#第五节-希腊哲学的宗教起源" class="headerlink" title="第五节 希腊哲学的宗教起源"></a>第五节 希腊哲学的宗教起源</h4><p>希腊宗教有两个主要方面:一个是关于奥林匹亚诸神的宗教，通过《荷马史诗》而为人熟知。在史诗中，虽然规模宏大，但诸神展示了人类具有的情感和对人类事务的关心。这一模拟人的形象的思想从早期一直到公元前5世纪和4世纪希腊文明的顶峰，经历了一个长期加工的发展过程。这一发展与哲学的发展有着错综复杂的关系。希腊宗教的另一方面作为其首要特征与所谓的神话崇拜有关联，这一方面在公元前6世纪的宗教复兴中变得很重要。</p><p>在处理希腊宗教和希腊哲学之间的相互作用之前，我们应当指出，在基督教中的情形相比，在希腊历史中宗教、艺术和哲学相互交融的程度要更大。作为诸神中的至高无上者，宙斯这一概念的发展可以作为一个例证。在荷马的著作中，宙斯像其他神一样服从命运，但是在几个世纪后，在埃斯库罗斯的戏剧中，命运自身己经被等同于宙斯至高无上的意志。奥林匹亚诸神的宗教影响了哲学，反过来也受到哲学独立发展的概念的影响，并和我们已经提及的公元前6世纪的宗教复兴相互影响。有专家认为荷马时期服从于命运的神的概念根植于产生最初的希腊哲学一公元前6世纪的米利都学派的自然哲学的思想观点，米利都学派的思想被认为更是关乎科学的。我们将在稍后讨论这一点。当然米利都学派哲学的后来发展无疑与毕达哥拉斯、巴门尼德和赫拉克利特的哲学(他们都受到了公元前6世纪新的和十分不同的宗教虔诚的影响)一起为我们在埃斯库罗斯的宙斯那里发现的神话倾向提供了一个理智背景。这些哲学和其他各种影响混合在公元前4世纪的柏拉图和亚里士多德的哲学–神论中。</p><p>当哲学至少能够与希腊理智生活的其他要素区分开来的时候，人们通常发现某一时期的宗教精神不但存在于神话和偶像崇拜的表述中，也存在于哲学中，这并不出人意料。事实上，因为希腊宗教从未有过一-个高度有组织和专门化的形式，希腊人通常将其宗教信仰表述在艺术、诗歌和哲学中。我们必须将注意力转向诗歌，来考察哲学和希腊宗教的第一方面一对奥林匹亚诸神的崇拜之间的最初关系，这在所有关于这些形式的解释中是有代表性的。</p><p>荷马当然是不神学家，如果我们相信神学与传播宗教教义有关，他至少不是这一意义上的神学家。但是关于上帝的思考在赫西俄德的著作中已经相当理智化。他的《神谱》被认为创作于公元前8世纪，是一组叙事 史诗中最重要的，在这些叙事史诗中，人们第一次试图以传统神话作为其思考基础，从神圣存在者的角度来解释与他们有关的世界现象。事实上，就这样的著作在更加宽泛的意义上讨论宇宙结构而言，它们涉及了宇宙论:当它们涉及诸神的本性时，它们就是属于神学领域的思考:当重点分别放在世界和诸神的起源时，我们称其为宇宙进化论和神统系谱学。在赫西俄德看来，即使诸神开始存在，他所探究的学说是:产生是所有事物的根源，即使他是在考察最终的起源，他也不会提出这一问题:不能产生自身的事物是否需要产生的来源。因此在宇宙进化论和神统系谱学并存的语境中，他断言先于一切事物的卡俄斯(在真空的意义上)开始存在，在卡俄斯之后天和地开始形成:厄洛斯或者爱-他自己与天和地处于同一时期一-使 得天和地结合。从这一结合中厄洛斯的力量又产生了一系列的结合:具有宇宙进化重要意义的一群，其中世界的自然力量被赋予诗歌和神话解释，黑暗和夜晚产生了白天，大地由天孕育而产生河:具有宇宙进化理论和神统系谱学相混合的重要意义的一一群，其中提坦从天和地的结合中产生，他们最终被由宙斯和其他奧林匹亚诸神所代表的更加有秩序的力量所取代。</p><p>在较晚的时代，亚里士多德称赫西俄德及其同类人为早期原始的神学家，并将他们的方法与最早的哲学家的方法进行比较，得出结论认为这些神谱作家宣扬思想并以神话形式进行解释，而最早的哲学家是用严格的证明方法进行思考。这一区分有些道理，但是很明显神谱虽然在严格意义上不是哲学，却为哲学准备了基础。在同荷马的神话方法的比较中存在着一个 朝向理性解释的进步:在赫西俄德的著作中掌握着诸神的产生和关系的厄洛斯，与荷马著作中命运的神话概念相比，是朝向自然法观念的一个进步;相应地，有人认为在赫西俄德的厄洛斯概念中存在着单一自然原则这一概念的发端， 这一原则是后来哲学家的特点。但是一般说来，早期的神谱作家不是以一种我们现在所理解的科学和逻辑的方法来解释事物的起源，而是使用了诗歌的想象和流行的神话。希腊的第一个哲学学派，即米利都的自然哲学家组成的学派，产生于公元前6世纪。其成员有泰勒斯、阿那克西曼德和阿那克西米尼，他们以希腊小亚细亚的主要城市米利都的伊奥尼亚城为活动中心。伊奧尼亚那个时候是希腊庞大殖民帝国的一个重要部分，作为帝国基础的海洋贸易已经开始改变希腊社会早期的封建特征。官方的奧林匹亚诸神崇拜曾长期处在贵族地主家族的控制之下，在那个时候已经成为一种习俗，受到怀疑论的检查。(我们很快将要研究的公元前6世纪的宗教复兴当然是完全不同的问题。)在这样一个繁忙和务实的社会，这些最初的哲学家从对世界的神话式理解朝向通过感官获得的经验为基础的知识发展。他们哲学思考的起点是“存在的事物”，在那时这一表述包括了感官所能感知的一切:他们的目标是要确定这些事物的本质，或者自然(physis) 。但是在这点上，不能认为这一新的思考方式与早期的宇宙进化理论和神统系谱学思考有着巨大差别。因为那时自然(physis) 并没有我们用来翻译它的本质(nature)一词的含义。这个词最初与生长行为有关，与生长的来源有关，因此寻求事物的本质就是寻求基本的、现存的、生成的实在，万事万物从这一实在中产生。</p><p>对这样一个最终原则的探寻超出了赫西俄德关心的范围，但是他与米利都学派的观点有一点相似之处，在两者中，实在都是按照成长和生成来思考的。在以下两个事实间存在着进一步的相似: 一个事实是， 米利都学派认为基本的实在一当然他们可能用其他的词来表述一从根本 上讲是- -， 虽然它会按照某个适当原则将自己分为各种要素:另一个事实是，《荷马史诗》中的命运分配给诸神不同的职责。但是赫西俄德和这些(被认为更具科学性的思想者的)最初哲学家的观点之间最重要的相似之处可能在于他们对于神(the Divine) 这一表述的使用，他们都将其作为他们思想得以建立的基本原则的名称。</p><p>这一表述的意义在于，对它的应用并不必然限制在人身上，而是可以延伸到抽象的事物上。最初的哲学家将自然和神明确等同起来，这种等同主要并不是以前宗教意义上的等同;但它使希腊宗教范围持续扩展，并深化了这一宗教， 因为它代表了一种对神的探究，这一探究在赫西俄德那里并没有出现。当阿那克西曼德将他的基本解释性原则称为无定或无限的“神”，当泰勒斯如传说告诉我们的那样，说“万事万物都充满了神性”，这就回溯到了一种不太具有科学性的思考方式。但是人们所关心的这些与万物起源有关的问题非常深奧，以前的神话已经不能给出令人满意的回答。神的观念相应地得到了扩展和深化。诸神以前那些令人尊敬的属性现在被转化为这一基本的实在，被称为本质或者自然，人们用原来即存在的、不朽的、包容一切的、统治一切的等充满热情的语词来谈论它，无疑表明他们非常尊敬科学。</p><p>在这一发展过程中，与泰勒斯、阿那克西曼德和阿那克西米尼所作的最初表述相比，自然包含了新的和可能更加丰富的洞见:当心灵或者作为自然的一种解释的努斯(nous)的概念越来越突出时，希腊的神的观念恢复到了原来的神人同性论，虽然是在一个更高的水平上。</p><p>公元前6世纪宗教情感的复兴激发了希腊人的才智，这一复兴应当归于一种类型的崇拜，这一崇拜与对奥林匹亚诸神的颂扬相比，更多地起源于平民的谦卑性质。虽然荷马的诗歌在很大程度上忽视了本地的神衹，希腊人崇拜奧林匹亚诸神，并同他们站在一起，但本地神衹在人们同土地的抗争中表现出了强大的力量。</p><p>实际上，与贵族神话中的神衹相比，这些神衹享有更为重要的仪式上的重要性。他们保留着以前的特征，甚至奥林匹亚诸神的名字也开始依附于他们。他们现在获得了承认。从公元前8世纪希腊殖民地扩张就开始的政治和经济变化达到一定程度，这被专家们用来证明“阶级冲突”这一表 述实际应用的合理性。</p><p>新的宗教狂热是更加广泛的平民阶层权力日益增长的标志。当大量的乡村人因为经济变化而离开农村时，一种原来在乡村的崇拜形式就进入到城市:通常君主将对这些新神衹的崇拜作为一种煽动方式加以鼓励，这已成为当时的一个特征。狄俄尼索斯，一个具有野蛮一面的色雷斯神衹，对他的崇拜是在希腊乡村的一次归化后被引入雅典的，他迅速在阿波罗的祭司那里受到了欢迎。</p><p>得墨忒耳，一个希腊本土乡村的女神，也迅速被同化为奥林匹亚的神衹。对狄俄尼索斯的崇拜处于宗教复兴的狂热一面的核心。像其崇拜以艾留西斯为中心的得墨忒耳一样，狄俄尼索斯与春天大地的复苏联系在一起，以神衹死后的复活或者消失后的回归作为象征。在阿提卡，狄俄尼索斯作为酒神而受到崇拜，而得墨忒尔则作为丰收女神受到崇拜。对狄俄尼索斯的崇拜在不同地方会有所不同，但是它们都有相同的核心仪式:神秘仪式。新教徒通过这一仪式而被认为实现了与神衹合一，而这一神秘仪式在整个希腊广泛散播。</p><p>除了包含神秘仪式(这一希腊术语的拉J语形式后来成了我们使用的词语“圣礼”(sacrament) )的神秘崇拜外，这一崇拜还存在着公共和官方形式。在狄俄尼索斯崇拜的情形中，神秘仪式通常具有狂欢的特征，但是经过了修改以便更易于被市民接受:众所周知，实际上与对狄俄尼索斯的公共崇拜相联系的庆祝活动与阿提卡戏剧的演变有很大关系。对狄俄尼索斯的崇拜仪式和与奧菲斯这一名 字有关的狄俄尼索斯宗教混合起来，从而经历了进一步的修正。奥菲斯是一个神话中的色雷斯歌手，他用里拉琴演奏，不仅使人和动物着迷，也令神衹着迷。奥菲斯希望用他令人愉快的音乐说服冥王的王后让他的爱人复生，但是最后却被狄俄尼索斯狂暴的女祭司撕成碎片。这样他就被等同于这一神衹，在一个狄俄尼索斯神话的奥菲斯式版本中，狄俄尼索斯也在重生之前被撕成碎片。这一奧菲斯式影响在狄俄尼索斯运动中与其背景相比具有更少的原始性，在与神衹合一而追求永恒的努力中，这一影响包含了伦理要素。我们已经注意到，狄俄尼索斯崇拜是如何通过接受城市的平民生活而失去了很多原始特征的。奥菲斯运动代表了对这一宗教运动的一个进一步的加工，因此很容易理解为什么一位专家认为奧菲斯是被驯服和穿上衣服的狄俄尼索斯。</p><p>在公元前6世纪的宗教复兴中，能够在哲学中追溯的大多数影响可以被认为是奥菲斯教的影响。在这些影响中首先是奧菲斯教灵魂学说的影响，特别是毕达哥拉斯兄弟会所接受的奥菲斯教的修正形式。奥菲斯教相信灵魂的轮回，灵魂被认为是不朽的，从神圣状态经历最初的下降，在接下来的转世化身中，灵魂又努力回到神圣状态。这一伦理上的关注在很大程度上修正了狄俄尼索斯教将重点放在大地的复苏上。在毕达哥拉斯的著作中，通过将灵魂原则等同于心灵，在稍晚的阿那克萨戈拉的类似倾向中，他们为柏拉图和亚里士多德所坚持的观点铺平了道路，后两人所持观点涉及到神性原则的理智特征和这一特征与人类灵魂的联系。从总体上看，公元前6世纪的宗教复兴并没有为哲学提供教条式的预设，反而为宗教虔诚导向的思想发展提供了良好的背景。毕达哥拉斯学派、巴门尼德及赫拉克利特的哲学都显示了与其同时代宗教生活的一致性，而没有反思宗教生活的直接影响。这些哲学家用热情和个人品质在表达自己，这让人想起同时代的诗人埃斯库罗斯和品达，人们也可以说公元前6世纪宗教生活的最好例证出现在这些哲学家和诗人的著作中，而不是出现在神话崇拜中。</p><p>此处所提及的三种哲学都意识到了米利都学派自然哲学的背景，这种哲学虽然涉及到“神”，却首先对呈现在感官感知中的物质和事物充满空间的方面感兴趣。毕达哥拉斯学派、巴门尼德和赫拉克利特保留了米利都学派的唯理论:他们就像米利都学派的“自然哲学家”，但是他们更多强调了对神的理解。毕达哥拉斯学派对宇宙论感兴趣，这在柏拉图那里得到响应，但是他们学说的核心是关于“一”或者“单一”(monad) 的观念，按照他们说的神秘主义，各种各样的可见物体从“一”中产生:统治这个不完善现象世界的存在的理性汇集在这个“一”的本质中。而且，既然所有的存在都从“一”中产生，就必须回到“一”中，可见世界受到贬损，所有的价值和完善都归于这个“一”。很明显，此处与奥菲斯教义中关于灵魂从最初的神圣状态下降的表述是相似的。奥菲斯教的情感主义在这里被进一步遏制，他们把更大的重要性分配给对理论意义上的智慧的追求，理论是对理性和永恒真理的沉思:但同时奥菲斯教的实质洞见在毕达哥拉斯学派的“哲学是一种生活方式”的观点中保存下来。</p><p>对于巴门尼德和赫拉克利特来说，神性原则也被认为是“一”， 这种一神论倾向在晚期希腊哲学中非常重要。巴门尼德将变化的因而是虚幻的感知世界和实在世界区分开来，实在世界是不变的和神圣的存在，可以通过理性的洞察而达到。他将关于这一神 圣实在的知识称为真理之路，用通过神启得来的赞美和虔诚的措辞来表述他对真理之路的体验。各种各样变化的事物如果可以描述，则完全是虚幻的，只能经由被命名为意见之路的宇宙论来把握，在其中“没有真的信念”。真理之路和意见之路这一区分的伦理特征就是奥菲斯教对灵魂的神圣状态和下降状态所作的区分。</p><p>赫拉克利特的学说也坚持了前述观点中的一神论和唯理论预设，虽然他没有贬损感觉世界。他将一个基本的和神圣的原则等同于火。灵魂实体，或者自然通过量度或者理性而得到限定，理性使得可见世界永不停息的所有变化都成为-种交换，因为理性使得所有的对立面保持和谐。赫拉克利特显然反对许多骗子的活动，这些骗子利用了神话崇拜的流行:但是他晦涩难懂的表述无疑具有一种宗教特征，他当然也对他的出生地伊奥尼亚发展出的最早的科学性没有兴趣。</p>]]></content>
    
    <summary type="html">
    
      &lt;p class=&quot;description&quot;&gt;
很少有民族的发展能够远远超出神话阶段，除去希腊，其他民族可能都没有发展出一一
种真正的哲学。基于此，论述就从希腊人开始。他们不仅为后来所有的西方
思想体系奠定基础，而且几乎提出了两千年来欧洲文明研究的所有问题和答案。从简单的
神话开端发展到复杂全面的体系，他们的哲学是所有民族提供的例证中的最好例证之一。
激励着希腊思想者的独立精神和对真理的爱从未被超越过，也极少有能与之匹敌者。对于较深的思辨思想感兴趣的研究者来说，研究希腊哲学应当是一件有吸引
力、有价值的锻炼。
&lt;/p&gt;
    
    </summary>
    
    
      <category term="文学" scheme="https://blog.kixcs.com/categories/literature/"/>
    
    
      <category term="History" scheme="https://blog.kixcs.com/tags/History/"/>
    
  </entry>
  
  <entry>
    <title>关于网络异常流量清洗系统的若干思考</title>
    <link href="https://blog.kixcs.com/archives/3ac5/"/>
    <id>https://blog.kixcs.com/archives/3ac5/</id>
    <published>2020-01-03T13:58:32.000Z</published>
    <updated>2020-03-01T12:23:49.816Z</updated>
    
    <content type="html"><![CDATA[<p class="description">随着网络技术和网络经济的发展，网络的重要性日益突出。与此同时，网络中存在的安全漏洞也在相应的增加，网络安全问题所造成的影响也越来越大，另一方面给企业和社会的影响带来了恶劣影响。据显示，DDoS攻击中，90%以上属于TCP协议栈攻击)，因此在当前大流量、分布广、隐蔽性强的DDoS攻击环境下，如何有效防范DDos攻击对维护当前网络稳定性与安全性具有重要意义。而伴随着计算机的不断普及与应用，在大规模DDoS网络流量下，传统防范技术对服务器的防范能力已不再奏效。</p><a id="more"></a><p>企业传统的DDoS攻击防御方式往往只能被动的不计成本的采用不断提升服务器性能和带宽的方式来保障自己企业的正常业务所需要的资源。随着DDoS攻击的规模不断增大，攻击手段不断智能化，这种通过预留资源的方式防御DDoS攻击的效果日益不明显。因此，专业的DDoS攻击防御方案对现今的企业核心网络业务保障来说显得尤为重要。</p><p>从城域网中接入的用户角度来看，在面临大量DDoS攻击的情况下，企业需要升级当前DDoS攻击防御系统，然而DDoS攻击自身的复杂性导致了企业难以独立完成对DDoS的防御；从运营商的角度来说，通过对城域网中大量的DDoS流量的过滤，可以有效减少城域网自身的负载，为城域网的业务提供有效的保障，同时也能够促进自身的发展；综上所述，在城域网侧为企业客户开展流量清洗实现对DDoS攻击的防御，可以同时满足运营商和大客户的双重需要，已经成为目前运营商的必然需求。</p><p>自1999年8月第一起DDoS攻击发生以来，人们就对DDoS攻击及其对策展开了深入的研究。1999年11月，CERT/CC发表的Distributed-Systems Intruder Tools Workshop报告中，最早全面阐述了DDoS攻击的原理，并针对系统管理员、ISP、以及事件响应小组，从预防、检测、响应三方面依次给出了即时、短期、长期的解决方案。随后，SANS和Cisco Systerms等几个著名的安全组织、公司，也针对DDoS攻击的防御提出了见解。华盛顿大学的Dave Dittrich在Distributed Denial of Service(DDoS)Attacks/tools提出了最新的DDoS攻击及防御的研究资料。在攻击工具研究方面，许多DDoS攻击工具(如: Trinoo、 TFN、Stacheldraht、TFN2K、Shaft、 Mstream 等)被详细地分析。一方面为防御DDoS攻击提供重要参考，另一方面攻击者利用相关信息进一步改进攻击工具。Mixter在Tribe Flood Network 3000中对DDoS攻击工具进行了理论性的评价，并给出了网络入侵检测规则。</p><p>在防御研究方面，人们从攻击前防御、攻击期间防范和攻击后防御等方面对DDoS防御措施进行了深入研究,研究的方向主要体现在攻击中的检测与过滤技术以及攻击后的攻击源追踪技术。Farguson和Senie基于DDoS攻击伪造源IP地址的特性，提出了入口报文过滤技术。该技术从理论来说，能够有效杜绝DDoS攻击，然而就实现而言，部署难度大不易实施。Park和Lee提出的基于路由报文过滤机制。该技术使用BGP信息来识别伪造源IP地址的报文。实验表明，如果采用此方案有效防范DDoS攻击，就需要在18%的Internet核心路由器上部署该机制，同样，该方案的部署仍然困难。</p><p>目前，研究主要通过在受害者和ISP网络上游部署检测与过滤机制，进行攻击报文过滤。其弊端在于，当大规模的DDoS攻击发生时，该机制的防范效率明显降低。Bellovin在Internet Draft:ICMP Traceback Messages中提议，利用路由器向目的IP发送ICMP Traceback Messages重建攻击流的路径。Barros基于Bellovin的方案进行了改进，以适用于反射式DDoS攻击。</p><p>2000年，Burch 和Cheswick提出通过报文记载其路由信息。路由器在报文头部(随机或确定)写入地址信息，接收方根据此报文构建路由路径。Savage等深入的研究了概率性报文标记机制，并提出地址信息标记方法。随后，Song 和Perrig提出了更为精简的报文标记算法，该算法的路径恢复更加快捷。Snoren 等提出基于Hash的IP Traceback技术，该技术利用源路径重构攻击流路径。当DDoS攻击存在大量攻击源时，IP Traceback技术追踪攻击源的效率会明显下降。在DDoS预防、攻击缓解和攻击流偏转、以及攻击记录的分析等方面，不少研究集中于网络和主机DDoS攻击下的可存活性研究以及构建DDoS攻击容忍网络。从国内外对DDoS研究的现状来看，在大规模DDoS攻击的情况下，很多DDoS防范技术的防御能力效率显著下降，攻击者通过对攻击工具的改进，很容易向目标机器发起DDoS攻击，因此DDoS防范措施还需要进一步改进。</p><p>随着计算机的不断普及与应用，在大规模DDoS网络流量下，传统防范技术对服务器的防范能力已不再奏效。基于此种情况本文提出了流量清洗的方法来防范SYN Flood攻击。大量攻击者通过占用带宽和抢占资源方式致使目标服务器发生拒绝服务，进而影响了运营商和企业的正常业务。</p><p>针对SYN Flood攻击隐蔽性强、规模大等特点，本文提出了流量清洗防范的思想。流量清洗防范采用层次过滤的方式，将网络总流量区分可信源流量、不可信源流量和未知源流量，并根据网络状态进行具体处理。基于用户需求，将流量清洗系统划分为功能模块和公共模块。功能模块包括统计分析模块、流牵引模块、清洗平台和半连接处理，公共模块包括特征库模块和总连接计数模块。统计分析模块进行黑名单和白名单匹配，完成对网络流量的初步过滤;流牵引模块通过设置SYN速率限值，判断是否需要对异常流量二次过滤;半连接处理接收清洗平台处理结果，建立生成动态列表信息，并更新特征库参数;总连接计数模块处理IN方向和OUT方向的报文，完成特征库全连接总数的更新。</p><p>流量清洗系统基于需求设计实现后，对网络流量进行了层次过滤。从验证结果来看，系统对攻击者识别的准确率提高，同时也增强了对SYN Flood攻击的处理与防御能力。</p><p>为了提高企业或运营商在遭受大量DDoS攻击时对DDoS的防御能力，流量清洗系统欲采用网络流量层次性过滤的思想，通过对整体流量进行区分处理。对设备接收的流量区分为可信源流量、未知源流量和不可信源流量，并针对三种流量依次诵过系统相关模块进行初步讨滤、二次过滤、cookie验证和建立动杰名单等外理。流量清洗系统根据用户需求将整体系统划分四个主要模块(包括统计分析模块、流牵引模块、清洗平台和半连接处理)和二个公共模块(总连接计数和特征库模块)。以下模块为论文所涉及的主要工作:</p><ul><li><p>在统计分析模块中将对流量进行初步过滤。对IN方向的流量，通过黑、白名单匹配，放行可信源流量。根据当前网络状态，对未知源和不可信源流量，判断是否需要对报文做丢包处理。</p></li><li><p>在流牵引模块中，将对进入设备的流量进行二次过滤。通过设置SYN限值判断是否对未知源流量和不可信源流量进行清洗处理。</p></li><li><p>在半连接处理中，将通过接收清洗平台处理结果，生成动态列表信息，包括动态白名单列表和动态黑名单列表，并更新特征库相应参数信息。</p></li><li><p>总连接计数模块的处理主要集中报文的IN方向和OUT方向，根据接收报文类型进行相关处理，并完成对特征库中全连接总数的更新。</p></li></ul><p>流量清洗系统划分为功能模块和公共模块。功能模块包括统计分析模块、流牵引模块、清洗平台和半连接处理，公共模块包括特征库模块和总连接计数模块。</p><p>统计分析模块从特征库中获取黑、白名单列表信息，完成刘流量区分，并依据网络状态对总体流量进行初步过滤。</p><p>流牵引模块在统计分析模块处理的基础上，对网络流量进行第二次过滤。通过设置SYN限值，判断是否需要对未知源流量和不可信源流量做清洗处理。</p><p>半连接处理通过接收清洗平台的处理结果，生成动态列表信息，包括动态白名单列表和动态黑名单列表，并更新特征库相应参数。</p><p>总连接计数模块的处理主要集中报文的IN方向和OUT方向，通过对总连接计数模块的处理完成特征库中全连接总数的更新。</p>]]></content>
    
    <summary type="html">
    
      &lt;p class=&quot;description&quot;&gt;
随着网络技术和网络经济的发展，网络的重要性日益突出。与此同时，网络中存在的安全漏洞也在相应的增加，网络安全问题所造成的影响也越来越大，另一方面给企业和社会的影响带来了恶劣影响。据显示，DDoS攻击中，90%以上属于TCP协议栈攻击)，因此在当前大流量、分布广、隐蔽性强的DDoS攻击环境下，如何有效防范DDos攻击对维护当前网络稳定性与安全性具有重要意义。而伴随着计算机的不断普及与应用，在大规模DDoS网络流量下，传统防范技术对服务器的防范能力已不再奏效。
&lt;/p&gt;
    
    </summary>
    
    
      <category term="随想" scheme="https://blog.kixcs.com/categories/thinking/"/>
    
    
      <category term="DDoS" scheme="https://blog.kixcs.com/tags/DDoS/"/>
    
  </entry>
  
  <entry>
    <title>浅析Google人工智能系统TensorFlow</title>
    <link href="https://blog.kixcs.com/archives/4cb2/"/>
    <id>https://blog.kixcs.com/archives/4cb2/</id>
    <published>2019-10-26T13:39:16.000Z</published>
    <updated>2020-03-01T12:11:51.056Z</updated>
    
    <content type="html"><![CDATA[<p class="description">2016年3月份，Google的围棋人工智能程序AlphaGo以4比1的大比分，战胜人类选手李世石，在全球成功引起广泛关注，引起了一波人工智能的热潮。从智能手机的语音助手，到相机的人脸识别，人工智能技术已经进入到我们生活的方方面面，在未来将深刻的影响我们的生活。为了加速深度学习领域的发展，2015年11月9日，Google发布深度学习框架TensorFlow并宣布开源。在短短的一年时间内，在GitHub上，TensorFlow就成为了最流行的深度学习项目。</p><a id="more"></a><h3 id="背景及概述"><a href="#背景及概述" class="headerlink" title="背景及概述"></a>背景及概述</h3><p>关于TensorFlow，截至今天，短短的两年内，其 GitHub 库大约 845 个贡献者共提交超过 17000 次。</p><p>详细的来说，TensorFlow 是一个开源的、基于 Python 的机器学习框架，由 Google Brain 团队为深度神经网络（DNN）开发的功能强大的开源软件库，在 Apache 2.x 协议许可下可用，并在图形分类、音频处理、推荐系统和自然语言处理等场景下有着丰富的应用，是目前最热门的机器学习框架。</p><p>Google在很多年前就已经开始把深度学习的技术应用到很多产品当中，在这个过程当中，Google也迭代、开发了好几代支持深度学习的软件系统, TensorFlow现在已经演化成一个相当完整的深度学习软件开放平台。</p><h3 id="TensorFlow的应用场景"><a href="#TensorFlow的应用场景" class="headerlink" title="TensorFlow的应用场景"></a>TensorFlow的应用场景</h3><p>TensorFlow有诸多应用场景，例如: TensorFlow支持多种硬件的平台, 比如说，它支持CPU、GPU混合搭建的数据中心的训练平台，它也支持将数据中心训练好的模型，相对便捷地部署到不同的移动端应用上，可以支持类似Google自主研发的TPU处理器; TensorFlow支持多种开发环境: 支持多种硬件的平台是基础，TensorFlow一直以来的一个目标，就是能够帮助尽量多的开发者，能够把深度学习的技术利用起来，最终使得广大的用户从中能力得到益处，基于这个想法，TensorFlow一直很重视多种程序员开发环境的支持。比如说，开发者可以在主要的开发环境中使用TensorFlow。TensorFlow在Google内部的应用推广是非常全面和彻底的，比如说TensorFlow很早就帮助Google的核心业务（搜索和广告），实施了深度学习的模型，并且在核心业务上体现了它的性能。在垃圾邮件过滤中，Google也使用了TensorFlow训练的模型，同时在安卓的应用程序推荐上，也上线了TensorFlow的模型等等。TensorFlow深入移动端,</p><p>任何曾经试图在 Python 中只利用 NumPy 编写神经网络代码的人都知道那是多么麻烦。编写一个简单的一层前馈网络的代码尚且需要 40 多行代码，当增加层数时，编写代码将会更加困难，执行时间也会更长。TensorFlow 使这一切变得更加简单快捷，从而缩短了想法到部署之间的实现时间。</p><p>就TensorFlow的原理而言 ，TensorFlow 允许将深度神经网络的计算部署到任意数量的 CPU 或 GPU 的服务器、PC 或移动设备上，且只利用一个 TensorFlow API。相较于其他的深度学习库而言，如 Torch、Theano、Caffe 和 MxNet，包括 TensorFlow 在内的大多数深度学习库能够自动求导、开源、支持多种 CPU/GPU、拥有预训练模型，并支持常用的NN架构，如递归神经网络（RNN）、卷积神经网络（CNN）和深度置信网络（DBN）。</p><p>TensorFlow 则还有更多的特点，如下：支持所有流行语言，如 Python、C++、Java、R和Go；可以在多种平台上工作，甚至是移动平台和分布式平台；它受到大多数主流云计算服务平台（AWS、Google和Azure）的支持；Keras——高级神经网络 API，已经与 TensorFlow 整合；与 Torch/Theano 比较，TensorFlow 拥有更好的计算图表可视化；允许模型部署到工业生产中，并且容易使用；有非常好的社区支持；TensorFlow 不仅仅是一个软件库，它是一套包括 TensorFlow，TensorBoard 和 TensorServing 的软件。</p><p>谷歌 research 博客列出了全球一些使用 TensorFlow 开发的有趣项目：Google 翻译运用了 TensorFlow 和 TPU（Tensor Processing Units）；Project Magenta 能够使用强化学习模型生成音乐，运用了 TensorFlow；澳大利亚海洋生物学家与来自昆士兰大学（Queensland University）的计算机科学家合作，使用了 TensorFlow 来发现和理解濒临灭绝的海牛；一位日本农民运用 TensorFlow 开发了一个应用程序，使用大小和形状等物理特性对黄瓜进行分类；在医学领域，发射科的医生通过采用TensorFlow，使其在医学扫描中能够识别帕金森病的迹象。湾区的数据科学家在树莓派上使用TensorFlow来追踪记录加州火车的动态。</p><p>为了更好地理解TensorFLow,首先要明白Tensorflow 不是一个普通的 Python 库，大多数 Python 库被编写为 Python 的自然扩展形式。当开发者导入一个库时，开发者得到的是一组变量、函数和类，它们补充并扩展了代码“工具箱”。 Python 和 Tensorflow 之间的联系，可以类比 Javascript 和 HTML 之间的关系。Javascript 是一种全功能的编程语言，可以实现各种出色的效果。HTML 是用于表示某种类型的实用计算抽象（这里指的是可由 Web 浏览器呈现的内容）的框架。Javascript 在交互式网页中的作用是组装浏览器看到的 HTML 对象，然后在需要时通过将其更新为新的 HTML 来与其交互。与 HTML 类似，Tensorflow 是用于表示某种类型的计算抽象（称为“计算图”）的框架。当开发者用 Python 操作 Tensorflow 时，开发者用 Python 代码做的第一件事是组装计算图。之后第二个任务就是与它进行交互（使用 Tensorflow 的“会话”）。但重要的是，要记住计算图不在变量内部，它处在全局命名空间内。莎士比亚曾经说过：“所有的 RAM 都是一个阶段，所有的变量都只不过是指针。”</p><h3 id="TensorFlow的技术细节"><a href="#TensorFlow的技术细节" class="headerlink" title="TensorFlow的技术细节"></a>TensorFlow的技术细节</h3><p>Tensorflow的第一个关键抽象：计算图。计算图实质上是一个全局数据结构：计算图是一个有向图，捕获有关计算方法的指令。第二个关键抽象：会话。会话的作用是处理内存分配和优化，使开发者能够实际执行由图形指定的计算。可以将计算图想象为我们想要执行的计算的“模板”：它列出了所有的步骤。为了使用这个图表，开发者还需要发起一个会话，它使开发者能够实际地完成任务。例如，遍历模板的所有节点来分配一组用于存储计算输出的存储器。为了使用 Tensorflow 进行各种计算，我们既需要图也需要会话。会话包含一个指向全局图的指针，该指针通过指向所有节点的指针不断更新。这意味着在创建节点之前还是之后创建会话都无所谓。创建会话对象后，可以使用 sess.run(node) 返回节点的值，并且 Tensorflow 将执行确定该值所需的所有计算。</p><p>Tensorflow 仅通过必需的节点自动路由计算这一事实是它的巨大优势。如果计算图非常大并且有许多不必要的节点，它就能节约大量运行时间。它允许我们构建大型的“多用途”图形，这些图形使用单个共享的核心节点集合根据采取的计算路径来做不同的任务。对于几乎所有应用程序而言，根据所采用的计算路径考虑 sess.run() 的调用方法是很重要的。关于变量和副作用，对Tensorflow而言，了解变量对于使用进行深度学习来说至关重要，因为模型的参数就是变量。在训练期间，你希望通过梯度下降在每个步骤更新参数，但在计算过程中，开发者希望保持参数不变，并将大量不同的测试输入集传入到模型中。模型所有的可训练参数很有可能都是变量。</p><p>为了进一步了解TensorFlow，下面进行对TensorFlow的一些简介：</p><h4 id="张量和图"><a href="#张量和图" class="headerlink" title="张量和图:"></a>张量和图:</h4><p>TensorFlow 是一种采用数据流图（data flow graphs），用于数值计算的开源软件库。其中 Tensor 代表传递的数据为张量（多维数组），Flow 代表使用计算图进行运算。数据流图用「结点」（nodes）和「边」（edges）组成的有向图来描述数学运算。「结点」一般用来表示施加的数学操作，但也可以表示数据输入的起点和输出的终点，或者是读取/写入持久变量（persistent variable）的终点。边表示结点之间的输入/输出关系。这些数据边可以传送维度可动态调整的多维数据数组，即张量（tensor）。在 Tensorflow 中，所有不同的变量和运算都是储存在计算图。所以在我们构建完模型所需要的图之后，还需要打开一个会话（Session）来运行整个计算图。在会话中，我们可以将所有计算分配到可用的 CPU 和 GPU 资源中。</p><h4 id="常量和变量："><a href="#常量和变量：" class="headerlink" title="常量和变量："></a>常量和变量：</h4><p>TensorFlow 中最基本的单位是常量（Constant）、变量（Variable）和占位符（Placeholder）。常量定义后值和维度不可变，变量定义后值可变而维度不可变。在神经网络中，变量一般可作为储存权重和其他信息的矩阵，而常量可作为储存超参数或其他结构信息的变量。</p><h4 id="占位符和feed-dict"><a href="#占位符和feed-dict" class="headerlink" title="占位符和feed_dict"></a>占位符和feed_dict</h4><p>我们已经创建了各种形式的常量和变量，但 TensorFlow 同样还支持占位符。占位符并没有初始值，它只会分配必要的内存。在会话中，占位符可以使用 feed_dict 馈送数据。feed_dict 是一个字典，在字典中需要给出每一个用到的占位符的取值。在训练神经网络时需要每次提供一个批量的训练样本，如果每次迭代选取的数据要通过常量表示，那么 TensorFlow 的计算图会非常大。因为每增加一个常量，TensorFlow 都会在计算图中增加一个结点。所以说拥有几百万次迭代的神经网络会拥有极其庞大的计算图，而占位符却可以解决这一点，它只会拥有占位符这一个结点。</p><h4 id="TensorFlow中的神经网络"><a href="#TensorFlow中的神经网络" class="headerlink" title="TensorFlow中的神经网络:"></a>TensorFlow中的神经网络:</h4><p>输入数据集，数据集分为训练数据集和标注、测试数据集和标注（包括验证数据集和标注）。测试和验证集能赋值到constant() 中，而训练集可以导入 tf.placeholder() 中，训练集只有导入占位符我们才能在随机梯度下降中成批量地进行训练。确定神经网络模型，该模型可以是简单的一层全连接网络或 9 层、16 层的复杂卷积网络组成。网络定义的权重矩阵和偏置向量后需要执行初始化，每一层需要一个权重矩阵和一个偏置向量。构建损失函数，并计算训练损失。模型会输出一个预测向量，我们可以比较预测标签和真实标签并使用交叉熵函数和 softmax 回归来确定损失值。训练损失衡量预测值和真实值之间差距，并用于更新权重矩阵。优化器，优化器将使用计算的损失值和反向传播算法更新权重和偏置项参数。</p><h4 id="TensorFlow中的深度神经网络"><a href="#TensorFlow中的深度神经网络" class="headerlink" title="TensorFlow中的深度神经网络:"></a>TensorFlow中的深度神经网络:</h4><p>LeNet5 由两个卷积层加上三个全连接层组成，因此它是一种浅层神经网络。卷积神经网络最出名的就是 2012 年所提出的 AlexNet、2013 年的 7 层 ZF-Net 和 2014 年提出的 16 层 VGGNet。到了 2015 年，谷歌通过 Inception 模块开发出 22 层的卷积神经网络 （GoogLeNet），而微软亚洲研究院创造出了 152 层的卷积神经网络：ResNet。</p><h3 id="Google-I-O上的TensorFlow"><a href="#Google-I-O上的TensorFlow" class="headerlink" title="Google I/O上的TensorFlow"></a>Google I/O上的TensorFlow</h3><p>在2017年Google I/O开发者大会上，同时提出的还有Google Tensor Lite。TensorFlow Lite 是 TensorFlow 移动和嵌入式设备轻量级解决方案。它使设备机器学习具有低延迟和更小的二进制体积。TensorFlow Lite 同时支持 Android 神经网络 API的硬件加速。TensorFlow Lite 使用多项技术降低延迟，例如移动 app 内核优化、pre-fused 激活、允许更快更小（定点）模型的量化内核。关于TensorFlow Lite 所包含的内容，有以下几点:</p><ul><li><p>支持一系列量子和浮点的核心运算符,并针对移动平台进行了优化。它结合 pre-fused 激活和其他技术来进一步提高性能和量化精度。此外，TensorFlow Lite 还支持在模型中使用自定义操作。</p></li><li><p>TensorFlow Lite 基于FlatBuffers定义了一个新的模型文件格式。FlatBuffers 是一个开源的高效的跨平台序列化库。它与 protocol buffers类似,但主要区别是 FlatBuffers 常与 per-object 内存分配相结合在您直接访问数据时不需要再次解析包。此外，FlatBuffers 的代码体积比 protocol buffers 小很多。</p></li><li><p>TensorFlow Lite 拥有一个新的移动设备优化的解释器保证应用程序的精简和快速。解释器使用静态图形排序和自定义（less-dynamic）内存分配器来确保最小的负载，初始化和执行延迟。</p></li><li><p>TensorFlow Lite 针对支持的设备提供了一个利用硬件加速的接口。通过 Android 神经网络库，作为 Android O-MR1 的一部分发布。</p></li></ul><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>TensorFlow 是一个人人都触手可及的完全开源的机器学习框架，适用于众多领域，在研究工作以及实际产品开发中都能发挥重要的作用。Google还赋予了 TensorFlow 很快的运行速度，并使其能适应更多的应用领域。举例来说，清华大学自然语言处理实验室的研究人员已通过 TensorFlow 来加强他们对语言理解的研究工作；而像京东、小米等众多中国企业也在使用 TensorFlow。与此同时，在中国的初创公司当中，也有不少 TensorFlow 的使用者，CastBox就是其中之一。CastBox开发的播客应用程序利用 TensorFlow 对他们的用户偏好进行分析，并向听众提供个性化的推荐。</p><p>简而言之，TensorFlow 是一个端到端开源机器学习平台。它拥有一个包含各种工具、库和社区资源的全面灵活生态系统，可以让研究人员推动机器学习领域的先进技术的发展，并让开发者轻松地构建和部署由机器学习提供支持的应用。除此之外，TensorFlow可以轻松地构建模型，随时随地进行可靠的机器学习生产，以及实现强大的研究实验。</p><p>尽管人工智能已被越来越多的开发者们应用于前沿研究，或产品及服务的开发当中，但这仅仅是人工智能无限的潜力的冰山一角。人工智能的神奇之处，在于它能被应用在医疗保健、交通运输和环境保护等方方面面，为复杂的社会问题探寻解决方案。如今，在人工智能的协助下，人们得以探索全新的研究领域，开发创新的产品，让数以百万计的人类从中获益。</p>]]></content>
    
    <summary type="html">
    
      &lt;p class=&quot;description&quot;&gt;
2016年3月份，Google的围棋人工智能程序AlphaGo以4比1的大比分，战胜人类选手李世石，在全球成功引起广泛关注，引起了一波人工智能的热潮。从智能手机的语音助手，到相机的人脸识别，人工智能技术已经进入到我们生活的方方面面，在未来将深刻的影响我们的生活。为了加速深度学习领域的发展，2015年11月9日，Google发布深度学习框架TensorFlow并宣布开源。在短短的一年时间内，在GitHub上，TensorFlow就成为了最流行的深度学习项目。
&lt;/p&gt;
    
    </summary>
    
    
      <category term="设计" scheme="https://blog.kixcs.com/categories/design/"/>
    
    
      <category term="Google" scheme="https://blog.kixcs.com/tags/Google/"/>
    
      <category term="TensorFlow" scheme="https://blog.kixcs.com/tags/TensorFlow/"/>
    
  </entry>
  
  <entry>
    <title>汉诺塔的递归算法</title>
    <link href="https://blog.kixcs.com/archives/36f2/"/>
    <id>https://blog.kixcs.com/archives/36f2/</id>
    <published>2019-10-25T10:57:04.000Z</published>
    <updated>2020-03-09T11:40:44.104Z</updated>
    
    <content type="html"><![CDATA[<p>最早发明这个问题的人是法国数学家爱德华·卢卡斯。传说越南河内某间寺院有三根银棒，上串 64 个金盘。寺院里的僧侣依照一个古老的预言，以上述规则移动这些盘子；预言说当这些盘子移动完毕，世界就会灭亡，上述又称梵天寺之塔问题。但不知道是卢卡斯自创的这个传说，还是他受他人启发。这个传说有若干变体：寺院换成修道院、僧侣换成修士等等。寺院的地点众说纷纭，其中一说是位于越南的河内，所以被命名为“河内塔”。另外亦有“金盘是创世时所造”、“僧侣们每天移动一盘”之类的背景设定。</p><p class="description"></p><a id="more"></a><h4 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h4><p>汉诺塔（又称河内塔）问题是源于印度一个古老传说的益智玩具。大梵天创造世界的时候做了三根金刚石柱子，在一根柱子上从下往上按照大小顺序摞着64片黄金圆盘。大梵天命令婆罗门把圆盘从下面开始按大小顺序重新摆放在另一根柱子上。并且规定，在小圆盘上不能放大圆盘，在三根柱子之间一次只能移动一个圆盘。</p><h4 id="规律"><a href="#规律" class="headerlink" title="规律"></a>规律</h4><p>归纳可得，当移动的盘子为n个时，移动的次数为2^n - 1。</p><h4 id="调用方法的栈机制"><a href="#调用方法的栈机制" class="headerlink" title="调用方法的栈机制"></a>调用方法的栈机制</h4><p>从主线程开始调用方法/函数进行不停的压栈和出栈操作，函数的调用就是将函数压入栈中，函数的结束就是函数出栈的过程，这样就保证了方法调用的顺序流，即当函数出现多层嵌套时，需要从外到内一层层把函数压入栈中，最后栈顶的函数先执行结束（最内层的函数先执行结束）后出栈，再倒数第二层的函数执行结束出栈，到最后，第一个进栈的函数调用结束后从栈中弹出回到主线程，并且结束。</p><h4 id="递归算法的实现-Java语言描述"><a href="#递归算法的实现-Java语言描述" class="headerlink" title="递归算法的实现(Java语言描述)"></a>递归算法的实现(Java语言描述)</h4><p>实现该递归算法可以分为三步走，首先需要把n-1个盘子从A柱移到B柱(C柱作为辅助)；然后再将第n个盘子/最大的盘子从A柱移动到C柱；最后将B柱上的n-1个盘子移动到C柱上(A柱作为辅助)即可。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*程序目的：利用汉诺塔函数来求出不同盘子移动的步骤</span></span><br><span class="line"><span class="comment">*2019-10-24 Summer</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Summer</span></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args [])</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> j;</span><br><span class="line">String str;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> m =<span class="number">0</span>;<span class="comment">//标记移动次数</span></span><br><span class="line">BufferedReader keyin=<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</span><br><span class="line">System.out.print(<span class="string">"请输入盘子数量:"</span>);</span><br><span class="line">str=keyin.readline();</span><br><span class="line">j=Integer.parseInt(str);</span><br><span class="line">hanoi(j,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">hanoi</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> p1,<span class="keyword">int</span> p2,<span class="keyword">int</span> p3)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(n==<span class="number">1</span>)&#123; <span class="comment">//圆盘仅剩一个时，直接移动到C柱。</span></span><br><span class="line"> System.out.println(<span class="string">"第"</span>+(++m)+<span class="string">"次移动，从"</span>+p1+<span class="string">"移动到"</span>+p3+<span class="string">"。"</span>)</span><br><span class="line"> &#125;<span class="keyword">else</span>&#123;<span class="comment">//递归算法分三步走</span></span><br><span class="line">  hanoi(n-<span class="number">1</span>,p1,p3,p2); <span class="comment">//hanoi(int n,int p1,int p2,int p3)中，形参p2所在的位置表示过渡参数。</span></span><br><span class="line">  System.out.println(<span class="string">"第"</span>+(++m)+<span class="string">"次移动，从"</span>+p1+<span class="string">"移动到"</span>+p3+<span class="string">"。"</span>);</span><br><span class="line">  hanoi(n-<span class="number">1</span>,p2,p1,p3);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最早发明这个问题的人是法国数学家爱德华·卢卡斯。传说越南河内某间寺院有三根银棒，上串 64 个金盘。寺院里的僧侣依照一个古老的预言，以上述规则移动这些盘子；预言说当这些盘子移动完毕，世界就会灭亡，上述又称梵天寺之塔问题。但不知道是卢卡斯自创的这个传说，还是他受他人启发。这个传说有若干变体：寺院换成修道院、僧侣换成修士等等。寺院的地点众说纷纭，其中一说是位于越南的河内，所以被命名为“河内塔”。另外亦有“金盘是创世时所造”、“僧侣们每天移动一盘”之类的背景设定。&lt;/p&gt;
&lt;p class=&quot;description&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="随想" scheme="https://blog.kixcs.com/categories/thinking/"/>
    
    
      <category term="Algorithm" scheme="https://blog.kixcs.com/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>浅析DNS流媒体解锁在代理环境中的应用</title>
    <link href="https://blog.kixcs.com/archives/90d0/"/>
    <id>https://blog.kixcs.com/archives/90d0/</id>
    <published>2019-09-10T11:01:20.000Z</published>
    <updated>2020-03-13T12:46:50.317Z</updated>
    
    <content type="html"><![CDATA[<p class="description"></p>在谈论DNS流媒体解锁所需的SNI代理服务器之前，先来回顾和了解下通常情况下DNS请求发出之后的整个生命周期。首先，在客户端发出基于UDP协议53端口的DNS请求后，浏览器DNS缓存机制会率先寻找本地的缓存。假如未命中缓存则调用操作系统的getaddrinfo()系统函数，向操作系统寻求解析结果。倘若操作系统的DNS缓存依旧无法响应请求，则计算机向配置的上游DNS服务器发送请求，DNS服务器经历了递归和迭代之后，成功的将解析结果返回给设备的操作系统，随后向该IP发起HTTPS连接即可。<a id="more"></a><h4 id="简述DNS解锁"><a href="#简述DNS解锁" class="headerlink" title="简述DNS解锁"></a>简述DNS解锁</h4><p>通常情况下，关于DNS流媒体解锁适用的业务场景即为通过代理服务器可以畅通无碍的访问Netflix、HBO、Amazon Prime Video等平台，由于上述平台的某些使用限制，非IDC网段的请求才能被正常的响应，否则就会遇到类似”Proxy Error”这样的错误返回值。   </p><ul><li><input checked="" disabled="" type="checkbox"> 通常情况下的访问请求<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----------+       +--------------+       +-----------+</span><br><span class="line">|          |       |              |       |           |</span><br><span class="line">|  Client  +-------&gt; Proxy Server +-------&gt;  Website  |</span><br><span class="line">|          |       |              |       |           |</span><br><span class="line">+----------+       +--------------+       +-----------+</span><br></pre></td></tr></table></figure></li><li><input checked="" disabled="" type="checkbox"> 倘若代理服务器不支持访问某些流媒体网站，那么就需要在此基础上增加DNS代理。<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----------+       +--------------+       +------------------+      +---------+</span><br><span class="line">|          |       |              |       |                  |      |         |</span><br><span class="line">|  Client  +-------&gt; Proxy Server +-------&gt; Smart DNS Server +------&gt; Website |</span><br><span class="line">|          |       |              |       |                  |      |         |</span><br><span class="line">+----------+       +--------------+       +------------------+      +---------+</span><br></pre></td></tr></table></figure></li><li><input checked="" disabled="" type="checkbox"> 在支持访问流媒体的服务器上安装SNI代理，将远端服务器的部分流媒体流量全部转发到SNI代理服务器上，这样代理服务器也就具备了访问受限制的流媒体的能力。<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">                                            +-----------+</span><br><span class="line">                                            |           |</span><br><span class="line">                                        +---&gt;  Website  |</span><br><span class="line">+----------+      +----------------+    |   |           |</span><br><span class="line">|          |      |                |    |   +-----------+</span><br><span class="line">|  Client  +------&gt;  Proxy Server  +----+</span><br><span class="line">|          |      |                |    |   +-----------+      +--------------+</span><br><span class="line">+----------+      +----------------+    |   |           |      |              |</span><br><span class="line">                                        +---&gt; SNI Proxy +------&gt; Netflix/HBO  |</span><br><span class="line">                                            |           |      |              |</span><br><span class="line">                                            +-----------+      +--------------+</span><br></pre></td></tr></table></figure></li></ul><h4 id="使用netflix-proxy实现DNS解锁"><a href="#使用netflix-proxy实现DNS解锁" class="headerlink" title="使用netflix-proxy实现DNS解锁"></a>使用netflix-proxy实现DNS解锁</h4><p>该项目<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FiNzcvbmV0ZmxpeC1wcm94eQ==" title="https://github.com/ab77/netflix-proxy">GitHub<i class="fa fa-external-link"></i></span> 服务器操作系统要求为Ubuntu或者Debian，运行下列命令。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apt-get -y install vim dnsutils curl sudo</span><br><span class="line">curl -fsSL https://get.docker.com/ | sh || apt-get -y install docker.io</span><br><span class="line">mkdir -p ~/netflix-proxy</span><br><span class="line">cd ~/netflix-proxy</span><br><span class="line">curl -fsSL https://github.com/ab77/netflix-proxy/archive/latest.tar.gz | gunzip - | tar x --strip-components=1</span><br><span class="line">./build.sh</span><br></pre></td></tr></table></figure><p>运行完成后会给出相应用户名及密码，可以配置反向代理方便未来的维护和使用。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netflix-proxy-admin site=http://IP:8080/credentials=admin:password</span><br></pre></td></tr></table></figure><p>配置代理服务器的DNS服务器地址为流媒体解锁服务器IP地址</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">修改/etc/NetworkManager/NetworkManager.conf文件，在main部分添加<span class="string">"dns=none"</span>选项：</span></span><br><span class="line">vi /etc/NetworkManager/NetworkManager.conf</span><br><span class="line">[main]</span><br><span class="line">plugins=ifcfg-rh</span><br><span class="line">dns=none</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">修改/etc/resolv.conf文件</span></span><br><span class="line">vi /etc/resolv.conf</span><br><span class="line"><span class="meta">#</span><span class="bash">Generated by NetworkManager</span></span><br><span class="line">search openstacklocal</span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">nameserver *.*.*.*</span><br></pre></td></tr></table></figure><p>(可选)在服务器的其他地方保存resolv.conf文件的一个副本（假设放在/root）并设置一个crontab定时命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cp /root/resolv.conf /etc/resolv.conf</span><br><span class="line"><span class="meta">#</span><span class="bash">添加写保护：</span></span><br><span class="line">chattr +i /etc/resolv.conf</span><br><span class="line"><span class="meta">#</span><span class="bash">修改生成resolv.conf的相关配置文件，譬如centos7中：</span></span><br><span class="line">vi /etc/NetworkManager/NetworkManager.conf</span><br></pre></td></tr></table></figure><p>重启网络</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure><p>⚠新版遇到python3出问题后可更换至旧版，️新版主要是buil.sh中的一行命令：apt install python3.6，导致python环境部署失败，详情可见netflix-proxy.log。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">apt-get update\</span><br><span class="line">&amp;&amp; apt-get -y install vim dnsutils curl sudo\</span><br><span class="line">&amp;&amp; curl -fsSL https://get.docker.com/ | sh || apt-get -y install docker.io\</span><br><span class="line">&amp;&amp; mkdir -p ~/netflix-proxy\</span><br><span class="line">&amp;&amp; cd ~/netflix-proxy\</span><br><span class="line">&amp;&amp; curl -fsSL https://github.com/Newlearner365/netflix-proxy/archive/latest.tar.gz | gunzip - | tar x --strip-components=1\</span><br><span class="line">&amp;&amp; ./build.sh</span><br></pre></td></tr></table></figure><p>对于部署的docker容器的运行情况，可以使用docker ps -a命令来查看。</p><h4 id="使用Dnsmasq实现DNS解锁"><a href="#使用Dnsmasq实现DNS解锁" class="headerlink" title="使用Dnsmasq实现DNS解锁"></a>使用Dnsmasq实现DNS解锁</h4><p>该服务的原理是，使用Dnsmasq的DNS将网站解析劫持到SNI proxy反向代理的页面上。默认解锁Netflix/Hulu/HBO等流媒体，如需增删流媒体域名请编辑文件/etc/dnsmasq.d/custom_netflix.conf和/etc/sniproxy.conf，现以支持CentOS6/7， Debian8/9/10, Ubuntu16/18系统。</p><h5 id="安装方法"><a href="#安装方法" class="headerlink" title="安装方法"></a>安装方法</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate -O dnsmasq_sniproxy.sh https://raw.githubusercontent.com/myxuchangbin/dnsmasq_sniproxy_install/master/dnsmasq_sniproxy.sh &amp;&amp; bash dnsmasq_sniproxy.sh -i</span><br></pre></td></tr></table></figure><h5 id="卸载方法："><a href="#卸载方法：" class="headerlink" title="卸载方法："></a>卸载方法：</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate -O dnsmasq_sniproxy.sh https://raw.githubusercontent.com/myxuchangbin/dnsmasq_sniproxy_install/master/dnsmasq_sniproxy.sh &amp;&amp; bash dnsmasq_sniproxy.sh -u</span><br></pre></td></tr></table></figure><h5 id="DNS地址修改"><a href="#DNS地址修改" class="headerlink" title="DNS地址修改"></a>DNS地址修改</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/resolv.conf</span><br></pre></td></tr></table></figure><h5 id="调试排错"><a href="#调试排错" class="headerlink" title="调试排错"></a>调试排错</h5><ul><li><input checked="" disabled="" type="checkbox"> 确认sniproxy有效运行<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">重启sni命令:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">如果sni不在运行，可检查配置/etc/sniproxy.conf，避免nginx或者其他程序监听80,443，可将其配置文件的80更改为801等。 </span></span><br><span class="line"><span class="meta">#</span><span class="bash">443端口必须给sni监听放行，查看：netstat -tlunp|grep 443</span></span><br><span class="line">systemctl restart sniproxy</span><br></pre></td></tr></table></figure></li><li><input checked="" disabled="" type="checkbox"> 确认防火墙放行443,53端口<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">调试可直接关闭防火墙 </span></span><br><span class="line">systemctl stop firewalld.service</span><br></pre></td></tr></table></figure></li><li><input checked="" disabled="" type="checkbox"> 解析域名<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">配置完毕DNS后，解析域名，判断IP是否是NETFLIX代理机器IP。</span></span><br><span class="line">nslookup netflix.com</span><br><span class="line"><span class="meta">#</span><span class="bash">如果不存在nslookup命令，CENTOS安装：</span></span><br><span class="line">yum install -y bind-utils</span><br><span class="line"><span class="meta">#</span><span class="bash">DEBIAN安装：</span></span><br><span class="line">apt-get -y install dnsutils</span><br></pre></td></tr></table></figure></li></ul><p>相关工具:<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RsdW5kcXVpc3Qvc25pcHJveHk=" title="https://github.com/dlundquist/sniproxy">HTTPS代理<i class="fa fa-external-link"></i></span> <span class="exturl" data-url="aHR0cDovL3d3dy50aGVrZWxsZXlzLm9yZy51ay9kbnNtYXNxL2RvYy5odG1s" title="http://www.thekelleys.org.uk/dnsmasq/doc.html">Dnsmasq<i class="fa fa-external-link"></i></span> <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RvcGljcy9jYWRkeXNlcnZlcg==" title="https://github.com/topics/caddyserver">Caddy<i class="fa fa-external-link"></i></span></p>]]></content>
    
    <summary type="html">
    
      &lt;p class=&quot;description&quot;&gt;&lt;/p&gt;
在谈论DNS流媒体解锁所需的SNI代理服务器之前，先来回顾和了解下通常情况下DNS请求发出之后的整个生命周期。首先，在客户端发出基于UDP协议53端口的DNS请求后，浏览器DNS缓存机制会率先寻找本地的缓存。假如未命中缓存则调用操作系统的getaddrinfo()系统函数，向操作系统寻求解析结果。倘若操作系统的DNS缓存依旧无法响应请求，则计算机向配置的上游DNS服务器发送请求，DNS服务器经历了递归和迭代之后，成功的将解析结果返回给设备的操作系统，随后向该IP发起HTTPS连接即可。
    
    </summary>
    
    
      <category term="网络" scheme="https://blog.kixcs.com/categories/network/"/>
    
    
      <category term="DNS" scheme="https://blog.kixcs.com/tags/DNS/"/>
    
  </entry>
  
  <entry>
    <title>Kotlin容器,泛型及高阶函数应用</title>
    <link href="https://blog.kixcs.com/archives/83a8/"/>
    <id>https://blog.kixcs.com/archives/83a8/</id>
    <published>2019-07-09T09:12:58.000Z</published>
    <updated>2020-03-09T09:43:10.676Z</updated>
    
    <content type="html"><![CDATA[<p>2011年7月，JetBrains推出Kotlin项目，这是一个面向JVM的新语言，它已被开发数年之久，它是一种在Java虚拟机上运行的静态类型编程语言，也可以被编译成为JavaScript源代码。它主要是由俄罗斯圣彼得堡的JetBrains开发团队所发展出来的编程语言，其名称来自于圣彼得堡附近的科特林岛。2012年1月，著名期刊《Dr. Dobb’s Journal》中它被认定为该月的最佳语言。虽然与Java语法并不兼容，但Kotlin被设计成可以和Java代码相互运作，并可以重复使用如Java集合框架等的现有Java引用的函数库。</p><p class="description"></p><a id="more"></a><h5 id="容器类型"><a href="#容器类型" class="headerlink" title="容器类型"></a>容器类型</h5><p>Kotlin号称全面兼容Java，于是乎Java的容器类仍可在Kotlin中正常使用，包括大家熟悉的队列ArrayList、映射HashMap等等。不过Kotlin作为一门全新的语言，肯定还是要有自己的容器类，不然哪天Java跟Kotlin划清界限，那麻烦就大了。与Java类似，Kotlin也拥有三类基本的容器，分别是集合Set、队列List、映射Map，然后每类容器又分作只读与可变两种类型，这是为了判断该容器能否进行增删改等变更操作。Kotlin对修改操作很慎重，比如变量用val前缀表示不可修改，用var前缀表示允许修改；类默认是不允许继承的，只有添加open前缀才允许该类被继承；至于容器默认为只读容器，如果需要进行修改则需加上Mutable形成新的容器，比如MutableSet表示可变集合，MutableList表示可变队列，MutableMap表示可变映射。<br>既然Set/List/Map都属于容器，那么必定拥有相同的基本容器方法，具体说明如下：</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">isEmpty() : 判断该容器是否为空。</span><br><span class="line">isNotEmpty() : 判断该容器是否非空。</span><br><span class="line">clear() : 清空该容器。</span><br><span class="line">contains() : 判断该容器是否包含指定元素。</span><br><span class="line">iterator() : 获取该容器的迭代器。</span><br><span class="line">count() : 获取该容器包含的元素个数，也可通过size属性获得元素数量。</span><br></pre></td></tr></table></figure><p>初始化赋值 : Kotlin允许在声明容器变量之时进行初始赋值，这点很方便比Java先进，当然不同容器的初始化方法有所区别，具体的对应关系见下表：</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">名称:                  初始化方法:</span><br><span class="line">只读集合 Set           setOf()</span><br><span class="line">可变集合 MutableSet    mutableSetOf()</span><br><span class="line">只读队列 List          listOf()</span><br><span class="line">可变队列 MutableList   mutableListOf()</span><br><span class="line">只读映射 Map           mapOf()</span><br><span class="line">可变映射 MutableMap    mutableMapOf()</span><br></pre></td></tr></table></figure><p>以上是Kotlin容器的基本方法，更具体的增删改查等用法则有所不同，下面分别介绍这三类六种容器的详细用法。</p><h5 id="List类型"><a href="#List类型" class="headerlink" title="List类型"></a>List类型</h5><p>List是一种元素之间按照顺序排列的容器，它与集合的最大区别，便是多了个次序管理。正因为List建立了秩序规则，所以它比Set多提供了如下功能（注意凡是涉及到增删改的，都必须由MutableList来完成）：</p><ul><li><input checked="" disabled="" type="checkbox"> 队列的get方法能够获取指定位置的元素，也可直接通过下标获得该位置的元素。</li><li><input checked="" disabled="" type="checkbox"> MutableList的add方法每次都是把元素添加到队列末尾，也可指定添加的位置。</li><li><input checked="" disabled="" type="checkbox"> MutableList的set方法允许替换或者修改指定位置的元素。</li><li><input checked="" disabled="" type="checkbox"> MutableList的removeAt方法允许删除指定位置的元素。</li><li><input checked="" disabled="" type="checkbox"> MutableList提供了sort系列方法用于给队列中的元素重新排序，其中sortBy方法表示按照升序排列，sortByDescending方法表示按照降序排列。</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//空值判断</span></span><br><span class="line">List&lt;<span class="built_in">Int</span>&gt;?：List 本身可空，List 的元素不可空</span><br><span class="line">List&lt;<span class="built_in">Int</span>?&gt; ：List 本身不可空，List 的元素可空</span><br><span class="line">List&lt;<span class="built_in">Int</span>?&gt;? ：List 本身可空，List 的元素也可空</span><br></pre></td></tr></table></figure><p>对于List的遍历操作:for循环,迭代器循环,forEach循环,以及下标遍历。用法如下：</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line"><span class="keyword">val</span> mylist:MutableList&lt;String&gt; = mutableListOf(<span class="string">"联想"</span>,<span class="string">"联想 Y520"</span>,<span class="string">"惠普"</span>,<span class="string">"戴尔"</span>,<span class="string">"IBM"</span>,<span class="string">"长城"</span>,<span class="string">"方正"</span>,<span class="string">"联想 Y720"</span>,<span class="string">"联想 Y7000"</span>);</span><br><span class="line">print(<span class="string">"电脑畅销榜已添加，当前共有<span class="subst">$&#123;mylist.size&#125;</span>款电脑\n"</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"for-in 电脑畅销榜包含以下<span class="subst">$&#123;mylist.size&#125;</span>款电脑\n"</span>)</span><br><span class="line"><span class="keyword">for</span>(item <span class="keyword">in</span> mylist)&#123;</span><br><span class="line">print(<span class="string">"名称：<span class="subst">$&#123;item&#125;</span>\n"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除第二个元素</span></span><br><span class="line"><span class="keyword">if</span>(mylist.size&gt;=<span class="number">2</span>)&#123;</span><br><span class="line">mylist.removeAt(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">print(<span class="string">"removeAt电脑畅销榜已更新,当前包含以下<span class="subst">$&#123;mylist.size&#125;</span>款电脑\n"</span>)</span><br><span class="line">print(<span class="string">"for-in 电脑畅销榜包含以下<span class="subst">$&#123;mylist.size&#125;</span>款电脑\n"</span>)</span><br><span class="line"><span class="keyword">for</span>(item <span class="keyword">in</span> mylist)&#123;</span><br><span class="line">print(<span class="string">"名称：<span class="subst">$&#123;item&#125;</span>\n"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mylist.sortBy &#123; it.first() &#125;</span><br><span class="line">print(<span class="string">"for-in sort电脑畅销榜已按照it升序重新排列，包含以下<span class="subst">$&#123;mylist.size&#125;</span>款电脑\n"</span>)</span><br><span class="line"><span class="keyword">for</span>(item <span class="keyword">in</span> mylist)&#123;</span><br><span class="line">print(<span class="string">"名称：<span class="subst">$&#123;item&#125;</span>\n"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mylist.sortByDescending &#123; it.first() &#125;</span><br><span class="line">print(<span class="string">"for-in sort电脑畅销榜已按照it降序重新排列，包含以下<span class="subst">$&#123;mylist.size&#125;</span>款电脑\n"</span>)</span><br><span class="line"><span class="keyword">for</span>(item <span class="keyword">in</span> mylist)&#123;</span><br><span class="line">print(<span class="string">"名称：<span class="subst">$&#123;item&#125;</span>\n"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print(<span class="string">"iterator-while 电脑畅销榜包含以下<span class="subst">$&#123;mylist.size&#125;</span>款电脑\n"</span>)</span><br><span class="line"><span class="keyword">var</span> iter = mylist.iterator()</span><br><span class="line"><span class="keyword">while</span>(iter.hasNext())&#123;</span><br><span class="line">print(<span class="string">"名称：<span class="subst">$&#123;iter.next()&#125;</span>\n"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print(<span class="string">"foreach 电脑畅销榜包含以下<span class="subst">$&#123;mylist.size&#125;</span>款电脑\n"</span>)</span><br><span class="line">mylist.forEach &#123;</span><br><span class="line">print(<span class="string">"名称：<span class="subst">$&#123;it&#125;</span>\n"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print(<span class="string">"indices电脑畅销榜包含以下<span class="subst">$&#123;mylist.size&#125;</span>款电脑\n"</span>)</span><br><span class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> mylist.indices)&#123;</span><br><span class="line">print(<span class="string">"名称：<span class="subst">$&#123;mylist[i]&#125;</span>\n"</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Set类型"><a href="#Set类型" class="headerlink" title="Set类型"></a>Set类型</h5><p>Set集合是一种简单的容器，它具有以下特性：</p><ul><li><input checked="" disabled="" type="checkbox"> 容器内部的元素不按顺序排列，因此无法按照下标进行访问。</li><li><input checked="" disabled="" type="checkbox"> 容器内部的元素存在唯一性，通过哈希值校验是否存在相同的元素，如果存在则覆盖之；<br>因为Set是只读集合，初始化赋值后便不可更改，所以元素变更的方法只适用于可变集合MutableSet，但MutableSet的变更操作尚有以下限制。<ul><li><input checked="" disabled="" type="checkbox"> MutableSet的add方法仅仅往集合中添加元素，由于集合是无序的，因此不知道添加的具体位置。</li><li><input checked="" disabled="" type="checkbox"> MutableSet没有修改元素值的方法，一个元素一旦被添加，就不可被修改。</li><li><input checked="" disabled="" type="checkbox"> MutableSet的remove方法用于删除指定对象，但无法删除某个位置的元素，这是因为集合内的元素不是按顺序排列的。</li></ul></li></ul><p>对于Set的遍历操作:for循环,迭代器循环,forEach循环，三种循环遍历的用法如下：</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> goodsA:String=<span class="string">"惠普"</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> goodsB:String=<span class="string">"联想"</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> goodsC:String=<span class="string">"戴尔"</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> goodsD:String=<span class="string">"IBM"</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> goodsE:String=<span class="string">"长城"</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> goodsF:String=<span class="string">"方正"</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> myset:MutableSet&lt;String&gt; = mutableSetOf();</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">myset.add(goodsA)</span><br><span class="line">myset.add(goodsB)</span><br><span class="line">myset.add(goodsC)</span><br><span class="line">myset.add(goodsD)</span><br><span class="line">myset.add(goodsE)</span><br><span class="line">myset.add(goodsF)</span><br><span class="line">myset.remove(goodsA)</span><br><span class="line">print(<span class="string">"电脑畅销榜已添加，并且remove goodsA商品惠普，当前共有<span class="subst">$&#123;myset.size&#125;</span>款电脑\n"</span>)</span><br><span class="line">print(<span class="string">"for-in 电脑畅销榜包含以下<span class="subst">$&#123;myset.size&#125;</span>款电脑\n"</span>)</span><br><span class="line">print(<span class="string">"for-in测试\n"</span>)</span><br><span class="line"><span class="keyword">for</span>(item <span class="keyword">in</span> myset)&#123;</span><br><span class="line">print(item+<span class="string">"\n"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print(<span class="string">"iterator-while 电脑畅销榜包含以下<span class="subst">$&#123;myset.size&#125;</span>款电脑\n"</span>)</span><br><span class="line">print(<span class="string">"iterator测试\n"</span>)</span><br><span class="line"><span class="keyword">var</span> iter = myset.iterator()</span><br><span class="line"><span class="keyword">while</span>(iter.hasNext())&#123;</span><br><span class="line">print(iter.next()+<span class="string">"\n"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print(<span class="string">"foreach 电脑畅销榜包含以下<span class="subst">$&#123;myset.size&#125;</span>款电脑\n"</span>)</span><br><span class="line">print(<span class="string">"foreach测试\n"</span>)</span><br><span class="line">myset.forEach &#123;</span><br><span class="line">print(it+<span class="string">"\n"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print(<span class="string">"foreach\$拼接表达式电脑畅销榜包含以下<span class="subst">$&#123;myset.size&#125;</span>款电脑\n"</span>)</span><br><span class="line"><span class="keyword">var</span> dec=<span class="string">""</span></span><br><span class="line">myset.forEach &#123;</span><br><span class="line">dec=<span class="string">"<span class="subst">$&#123;dec&#125;</span>名称：<span class="subst">$&#123;it&#125;</span>\n"</span></span><br><span class="line">&#125;</span><br><span class="line">print(<span class="string">"<span class="variable">$dec</span>"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Map类型"><a href="#Map类型" class="headerlink" title="Map类型"></a>Map类型</h5><p>映射内部保存的是一组键值对（Key-Value），也就是说，每个元素都由两部分构成，第一部分是元素的键，相当于元素的名字；第二部分是元素的值，存放着元素的详细信息。元素的键与值是一一对应的关系，相同的键名指向的值对象是唯一的，所以映射中每个元素的键名各不相同，这个特性使得映射的变更操作与队列存在以下不同之处（注意增删操作必须由MutableMap来完成）：</p><ul><li><input checked="" disabled="" type="checkbox"> 映射的containsKey方法判断是否存在指定键名的元素，containsValue方法判断是否存在指定值对象的元素。</li><li><input checked="" disabled="" type="checkbox"> 映射的containsKey方法判断是否存在指定键名的元素，containsValue方法判断是否存在指定值对象的元素；</li><li><input checked="" disabled="" type="checkbox"> MutableMap的put方法不单单是添加元素，而是智能的数据存储；每次调用put方法，映射会先根据键名寻找同名元素，如果找不到就添加新元素，如果找得到就用新元素替换旧元素；</li><li><input checked="" disabled="" type="checkbox"> MutableMap的remove方法，是通过键名来删除元素的；</li><li><input checked="" disabled="" type="checkbox"> 调用mapOf和mutableMapOf方法初始化映射之时，有两种方式可以表达单个键值对元素。其一是采取“键名 to 值对象”的形式，其二是采取Pair配对方式形如“Pair(键名, 值对象)”，下面是这两种初始化方式的代码例子：</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//to方式初始化映射</span></span><br><span class="line"><span class="keyword">var</span> goodsMap = mapOf(<span class="string">"苹果"</span> to goodsA, <span class="string">"华为"</span> to goodsB, <span class="string">"小米"</span> to goodsC, <span class="string">"欧珀"</span> to goodsD, <span class="string">"步步高"</span> to goodsE, <span class="string">"魅族"</span> to goodsF)</span><br><span class="line"><span class="comment">//Pair方式初始化映射</span></span><br><span class="line"><span class="keyword">var</span> goodsMutMap = mutableMapOf(Pair(<span class="string">"苹果"</span>, goodsA), Pair(<span class="string">"华为"</span>, goodsB), Pair(<span class="string">"小米"</span>, goodsC), Pair(<span class="string">"欧珀"</span>, goodsD), Pair(<span class="string">"步步高"</span>, goodsE), Pair(<span class="string">"魅族"</span>, goodsF))</span><br><span class="line"></span><br><span class="line">遍历方式与Set相似，如下</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> goodsMutMap=mutableMapOf&lt;String, String&gt;(Pair(<span class="string">"苹果"</span>, goodsA),Pair(<span class="string">"华为"</span>, goodsB),Pair(<span class="string">"戴尔"</span>, goodsC),Pair(<span class="string">"华硕"</span>, goodsD),Pair(<span class="string">"弘基"</span>,goodsE),Pair(<span class="string">"联想"</span>, goodsE));</span><br><span class="line"><span class="keyword">for</span>(item <span class="keyword">in</span> goodsMutMap)&#123;</span><br><span class="line">print(<span class="string">"厂家：<span class="subst">$&#123;item.key&#125;</span>，名称：<span class="subst">$&#123;item.value&#125;</span>\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//迭代器循环</span></span><br><span class="line"><span class="keyword">var</span> iterator= goodsMutMap.iterator();</span><br><span class="line"><span class="keyword">while</span>(iterator.hasNext())&#123;</span><br><span class="line"><span class="keyword">var</span> item=iterator.next();</span><br><span class="line">print(<span class="string">"厂家：<span class="subst">$&#123;item.key&#125;</span>名称：<span class="subst">$&#123;item.value&#125;</span>\n"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//for each循环</span></span><br><span class="line">goodsMutMap.forEach&#123;</span><br><span class="line">print(<span class="string">"厂家：<span class="subst">$&#123;it.key&#125;</span>，名称：<span class="subst">$&#123;it.value&#125;</span>\n"</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="泛型函数"><a href="#泛型函数" class="headerlink" title="泛型函数"></a>泛型函数</h5><p>泛型的引入：函数的输入参数类型必须在定义函数时就要指定，可是有时候参数类型是不确定的，只有在函数调用时方能知晓具体类型，如此一来要怎样声明函数呢？<br>定义泛型函数时，得在函数名称前面添加“<T>”，表示以T声明的参数（包括输入参数和输出参数），其参数类型必须在函数调用时指定。<br>实例：</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">appendString</span><span class="params">(tag:<span class="type">String</span>, <span class="keyword">var</span> otherInfo:<span class="type">T</span>?)</span></span>:String&#123;</span><br><span class="line"><span class="keyword">var</span> str:String = <span class="string">"<span class="variable">$tag</span>:"</span></span><br><span class="line"><span class="keyword">for</span> (item <span class="keyword">in</span> otherInfo)&#123;</span><br><span class="line">str=<span class="string">"<span class="variable">$str</span><span class="subst">$&#123;item.toString()&#125;</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> str</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span>&#123;</span><br><span class="line"><span class="keyword">var</span> count = <span class="number">0</span></span><br><span class="line"><span class="keyword">when</span>(count%<span class="number">3</span>)&#123;</span><br><span class="line"><span class="number">0</span> -&gt; appendString&lt;String&gt;(<span class="string">"古代的四大发明"</span>,<span class="string">"造纸术"</span>,<span class="string">"印刷术"</span>,<span class="string">"火药"</span>,<span class="string">"指南针"</span>)</span><br><span class="line"><span class="number">1</span> -&gt; appendString&lt;<span class="built_in">Int</span>&gt;(<span class="string">"小于10的素数"</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>)</span><br><span class="line"><span class="keyword">else</span> -&gt; appendString&lt;<span class="built_in">Double</span>&gt;(<span class="string">"烧钱的日子"</span>,<span class="number">5.20</span>,<span class="number">6.18</span>,<span class="number">11.11</span>,<span class="number">12.12</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="内联函数"><a href="#内联函数" class="headerlink" title="内联函数"></a>内联函数</h5><p>注意到前面定义泛型函数appendString，是把它作为一个全局函数，也就是在类外面定义，不在类内部定义。因为类的成员函数依赖于类，只有泛型类（又称模板类）才能拥有成员泛型函数，普通类是不允许定义泛型函数的，否则编译器会直接报错。不过有个例外情况，如果参数类型都是继承自某种类型，那么允许在定义函数时指定从这个基类泛化开，凡是继承自该基类的子类，都可以作为输入参数进行函数调用，反之则无法调用函数。<br>举个例子，Int、Float和Double都继承自Number，但是定义一个setArrayNumber(array:Array<Number>)函数，它并不接受Array<Int>或者Array<Double>的入参，如果要让该方法同时接受源自Number的数组入参，就得定义泛化自Number的泛型函数，即将<T>改为<reified T : Number>，同时在fun前面添加关键字inline，表示该函数也为内联函数。内联函数在编译之时，会在调用处把该函数的内部代码直接复制一份，调用十次就会复制十份，而非普通函数那样仅仅提供一个函数的访问地址。该例子的函数定义代码如下所示：</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//该函数不接受Array&lt;Int&gt;，也不接受Array&lt;Double&gt;，只好沦为孤家寡人</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">setArrayNumber</span><span class="params">(array:<span class="type">Array</span>&lt;<span class="type">Number</span>&gt;)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> str:String = <span class="string">"数组元素依次排列："</span></span><br><span class="line"><span class="keyword">for</span> (item <span class="keyword">in</span> array) &#123;</span><br><span class="line">str = str + item.toString() + <span class="string">", "</span></span><br><span class="line">&#125;</span><br><span class="line">tv_function_result.text = str</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//只有内联函数才可以被具体化</span></span><br><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> T : Number&gt;</span> <span class="title">setArrayStr</span><span class="params">(array:<span class="type">Array</span>&lt;<span class="type">T</span>&gt;)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> str:String = <span class="string">"数组元素依次排列："</span></span><br><span class="line"><span class="keyword">for</span> (item <span class="keyword">in</span> array) &#123;</span><br><span class="line">str = str + item.toString() + <span class="string">", "</span></span><br><span class="line">&#125;</span><br><span class="line">tv_function_result.text = str</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="扩展函数"><a href="#扩展函数" class="headerlink" title="扩展函数"></a>扩展函数</h5><p>系统自带的类已经提供了许多方法，然而经常还是无法完全满足业务需求，此时开发者往往要写个工具类，比如StringUtil、DateUtil之类，来补充相关的处理功能，长此以往，工具类越来越多也越来越难以管理。<br>基于以上情况，Kotlin推出了扩展函数的概念，允许开发者给系统类补写新的方法，而无需另外编写额外的工具类。比如系统自带的数组Array提供了求最大值的max方法，提供了进行排序的sort方法，可是并未提供交换数组元素的方法。于是我们打算给Array增加新的交换方法，也就是添加一个扩展函数swap，与众不同的是要在函数名称前面加上“Array<Int>.”，表示该函数扩展自Array<Int>。swap函数的定义代码如下所示：</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> Array<span class="type">&lt;Int&gt;</span>.<span class="title">swap</span><span class="params">(pos1:<span class="type">Int</span>, pos2:<span class="type">Int</span>)</span></span>&#123;</span><br><span class="line"><span class="keyword">val</span> temp = <span class="keyword">this</span>[pos1]</span><br><span class="line"><span class="keyword">this</span>[pos1] = <span class="keyword">this</span>[pos2]</span><br><span class="line"><span class="keyword">this</span>[pos2] = temp</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>与泛型函数结合可以增强它的泛用性</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> Array<span class="type">&lt;T&gt;</span>.<span class="title">swap</span><span class="params">(pos1:<span class="type">Int</span>, pos2:<span class="type">Int</span>)</span></span>&#123;</span><br><span class="line"><span class="keyword">val</span> temp = <span class="keyword">this</span>[pos1]</span><br><span class="line"><span class="keyword">this</span>[pos1] = <span class="keyword">this</span>[pos2]</span><br><span class="line"><span class="keyword">this</span>[pos2] = temp</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实例：消除重复元素</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span>  city :MutableList&lt;String&gt; = mutableListOf( <span class="string">"Shanghai Job Offered"</span>, <span class="string">"Beijing Events"</span>, <span class="string">"Beijing Language"</span>,<span class="string">"Beijing Massage &amp; Escort"</span> ,<span class="string">"Beijing Language"</span>,<span class="string">"Beijing Events"</span>,<span class="string">"Shanghai Job Offered"</span>)</span><br><span class="line"><span class="keyword">var</span>  testNum :MutableList&lt;<span class="built_in">Int</span>&gt; = mutableListOf( <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line">testNum.sort()</span><br><span class="line"><span class="keyword">for</span>(item <span class="keyword">in</span> testNum.deleteDuplication())&#123;</span><br><span class="line">println(<span class="string">"<span class="variable">$item</span>"</span>)</span><br><span class="line">&#125;</span><br><span class="line">city.sort()</span><br><span class="line"><span class="keyword">for</span>(item <span class="keyword">in</span> city.deleteDuplication())&#123;</span><br><span class="line">println(<span class="string">"<span class="variable">$item</span>"</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//新建辅助数组</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> MutableList<span class="type">&lt;T&gt;</span>.<span class="title">deleteDuplication</span><span class="params">()</span></span>:MutableList&lt;T&gt;&#123;</span><br><span class="line"><span class="keyword">var</span> res:MutableList&lt;T&gt; = mutableListOf()</span><br><span class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> <span class="keyword">this</span>.indices)&#123;</span><br><span class="line"><span class="keyword">if</span>(i&gt;<span class="number">0</span> &amp;&amp; <span class="keyword">this</span>[i]==<span class="keyword">this</span>[i-<span class="number">1</span>]) <span class="keyword">continue</span></span><br><span class="line"><span class="keyword">else</span> res.add(<span class="keyword">this</span>[i])</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="尾递归函数"><a href="#尾递归函数" class="headerlink" title="尾递归函数"></a>尾递归函数</h5><p>Kotlin引入了扩展函数，还能反过来精简函数。具体地说，如果一个函数的表达式比较简单，一两行就可以搞定的话，Kotlin允许使用等号代替大括号。<br>例如：5!=5<em>4</em>3<em>2</em>1</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">factorial</span><span class="params">(n:<span class="type">Int</span>)</span></span>:<span class="built_in">Int</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (n &lt;= <span class="number">1</span>) n</span><br><span class="line"><span class="keyword">else</span> n*factorial(n-<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以简化成：</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">factorial</span><span class="params">(n:<span class="type">Int</span>)</span></span>:<span class="built_in">Int</span> = <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) n <span class="keyword">else</span> n*factorial(n-<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>Kotlin体系还存在一种特殊的递归函数，名叫尾递归函数，它指的是函数末尾的返回值重复调用了自身函数。此时要在fun前面加上关键字tailrec，告诉编译器这是个尾递归函数，则编译器会相应进行优化，从而提高程序性能。</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//如果函数尾部递归调用自身，则可加上关键字tailrec表示这是个尾递归函数，</span></span><br><span class="line"><span class="comment">//此时编译器会自动优化递归，即用循环方式代替递归，从而避免栈溢出的情况。</span></span><br><span class="line"><span class="comment">//比如下面这个求余弦不动点的函数就是尾递归函数</span></span><br><span class="line"><span class="comment">//实例:</span></span><br><span class="line"><span class="keyword">tailrec</span> <span class="function"><span class="keyword">fun</span> <span class="title">findFixPoint</span><span class="params">(x: <span class="type">Double</span> = <span class="number">1.0</span>)</span></span>: <span class="built_in">Double</span></span><br><span class="line">= <span class="keyword">if</span> (x == Math.cos(x)) x <span class="keyword">else</span> findFixPoint(Math.cos(x))</span><br></pre></td></tr></table></figure><h5 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h5><p>前面多次提到函数被Kotlin当作特殊变量，包括函数声明采取跟变量声明一样的形式“名称:类型”，以及简化函数允许直接用等号连接函数体等等，那么本节最后讲述的则是把A函数作为B函数的输入参数，就像普通变量一样参与B函数的表达式计算。此时因为B函数的入参内嵌了A函数，故而B函数被称作高阶函数，对应的A函数则为低阶函数。</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实例</span></span><br><span class="line"><span class="comment">//允许将函数表达式作为输入参数传进来，就形成了高阶函数，这里的greater函数就像是个变量</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">maxCustom</span><span class="params">(array: <span class="type">Array</span>&lt;<span class="type">T</span>&gt;, greater: (<span class="type">T</span>, <span class="type">T</span>) -&gt; <span class="type">Boolean</span>)</span></span>: T? &#123;</span><br><span class="line"><span class="keyword">var</span> max: T? = <span class="literal">null</span></span><br><span class="line"><span class="keyword">for</span> (item <span class="keyword">in</span> array)</span><br><span class="line"><span class="keyword">if</span> (max == <span class="literal">null</span> || greater(item, max))</span><br><span class="line">max = item</span><br><span class="line"><span class="keyword">return</span> max</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span>&#123;</span><br><span class="line"><span class="keyword">var</span> string_array:Array&lt;String&gt; = arrayOf(<span class="string">"How"</span>, <span class="string">"do"</span>, <span class="string">"you"</span>, <span class="string">"do"</span>, <span class="string">"I'm   "</span>, <span class="string">"Fine"</span>)</span><br><span class="line">println(<span class="string">"字符串数组的默认最大值为<span class="subst">$&#123;string_array.max()&#125;</span>"</span>)</span><br><span class="line"><span class="comment">//因为高阶函数maxCustom同时也是泛型函数，所以要在函数名称后面加上&lt;String&gt;</span></span><br><span class="line">println(<span class="string">"字符串数组按长度比较的最大值为<span class="subst">$&#123;maxCustom&lt;String&gt;(string_array, &#123; a, b -&gt; a.length &gt; b.length &#125;</span>)&#125;"</span>)</span><br><span class="line"><span class="comment">//string_array.max()对应的高阶函数是maxCustom(string_array, &#123; a, b -&gt; a &gt; b &#125;)</span></span><br><span class="line">println(<span class="string">"字符串数组的默认最大值(使用高阶函数)为<span class="subst">$&#123;maxCustom(string_array, &#123; a, b -&gt; a &gt; b &#125;</span>)&#125;"</span>)</span><br><span class="line"><span class="comment">//因为系统可以根据string_array判断泛型函数采用了String类型，故而函数名称后面的&lt;String&gt;也可以省略掉</span></span><br><span class="line">println(<span class="string">"字符串数组按去掉空格再比较长度的最大值为<span class="subst">$&#123;maxCustom(string_array, &#123; a, b -&gt; a.trim().length &gt; b.trim().length &#125;</span>)&#125;"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>前述的高阶函数maxCustom同时结合了泛型函数的写法，其实还可以给它加上扩展函数的功能。</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> Array<span class="type">&lt;T&gt;</span>.<span class="title">maxCustom</span><span class="params">(array: <span class="type">Array</span>&lt;<span class="type">T</span>&gt;, greater: (<span class="type">T</span>, <span class="type">T</span>) -&gt; <span class="type">Boolean</span>)</span></span>: T? &#123;</span><br><span class="line"><span class="keyword">var</span> max: T? = <span class="literal">null</span></span><br><span class="line"><span class="keyword">for</span> (item <span class="keyword">in</span> array)</span><br><span class="line"><span class="keyword">if</span> (max == <span class="literal">null</span> || greater(item, max))</span><br><span class="line">max = item</span><br><span class="line"><span class="keyword">return</span> max</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后，感谢好朋友的分享:) <span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L29uZXBpZWNlX2xvdmVzL2FydGljbGUvZGV0YWlscy85MzIwNDA2Mg==" title="https://blog.csdn.net/onepiece_loves/article/details/93204062">Kotlin学习笔记 By Soul丶Knight<i class="fa fa-external-link"></i></span></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;2011年7月，JetBrains推出Kotlin项目，这是一个面向JVM的新语言，它已被开发数年之久，它是一种在Java虚拟机上运行的静态类型编程语言，也可以被编译成为JavaScript源代码。它主要是由俄罗斯圣彼得堡的JetBrains开发团队所发展出来的编程语言，其名称来自于圣彼得堡附近的科特林岛。2012年1月，著名期刊《Dr. Dobb’s Journal》中它被认定为该月的最佳语言。虽然与Java语法并不兼容，但Kotlin被设计成可以和Java代码相互运作，并可以重复使用如Java集合框架等的现有Java引用的函数库。&lt;/p&gt;
&lt;p class=&quot;description&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="技术" scheme="https://blog.kixcs.com/categories/technique/"/>
    
    
      <category term="Kotlin" scheme="https://blog.kixcs.com/tags/Kotlin/"/>
    
  </entry>
  
  <entry>
    <title>CentOS 7使用Fail2Ban保护SSH</title>
    <link href="https://blog.kixcs.com/archives/ee68/"/>
    <id>https://blog.kixcs.com/archives/ee68/</id>
    <published>2018-07-15T09:31:06.000Z</published>
    <updated>2020-03-13T09:51:22.856Z</updated>
    
    <content type="html"><![CDATA[<p class="description"></p>Fail2ban是一款入侵防御软件，可以保护服务器免受暴力攻击。Fail2ban 基于 auth 日志文件工作，默认情况下它会扫描所有 auth 日志文件，如/var/log/auth.log等，并禁止带有恶意标志的 IP，如密码尝试次数过多等。Fail2ban 由 Python 编写而成，主要配合 iptables 来进行工作，为各种服务提供了过滤器，如 SSH、Apache、Nginx、Squid、Named、Mysql、Nagios 等。Fail2ban 能够降低风险，但不能消除风险，这只是服务器防止暴力攻击的安全手段之一，本文以CentOS为例。<a id="more"></a><h4 id="安装Fail2ban"><a href="#安装Fail2ban" class="headerlink" title="安装Fail2ban"></a>安装Fail2ban</h4><p>Fail2ban不在官方软件包仓库中，它在EPEL中（Extra Packages for Enterprise Linux）。<br>安装epel-release：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install epel-release</span><br></pre></td></tr></table></figure><p>由于 Fail2ban 依赖于 Python，需要确保 Python 版本 ≥ 2.6：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -V</span><br></pre></td></tr></table></figure><p>安装Fail2ban：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install fail2ban</span><br></pre></td></tr></table></figure><p>安装完成之后，启用Fail2ban：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable fail2ban</span><br></pre></td></tr></table></figure><h4 id="文件目录结构"><a href="#文件目录结构" class="headerlink" title="文件目录结构"></a>文件目录结构</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/etc/fail2ban               ## fail2ban 服务配置目录</span><br><span class="line">/etc/fail2ban/action.d      ## iptables 、mail 等动作文件目录</span><br><span class="line">/etc/fail2ban/filter.d      ## 条件匹配文件目录，过滤日志关键内容</span><br><span class="line">/etc/fail2ban/jail.conf     ## fail2ban 防护配置文件</span><br><span class="line">/etc/fail2ban/fail2ban.conf ## fail2ban 配置文件，定义日志级别、日志、sock 文件位置等</span><br></pre></td></tr></table></figure><h4 id="配置Fail2ban"><a href="#配置Fail2ban" class="headerlink" title="配置Fail2ban"></a>配置Fail2ban</h4><p>Fail2ban服务的配置文件在/etc/fail2ban目录。在其中可以找到jail.conf配置文件，官方的文档写到：在配置时，我们应该避免修改由fail2ban安装创建的文件，我们应该去编写具有.local扩展名的新文件,因为在升级软件包时，会覆盖这个文件，使配置失效。当我们的配置发生改变了我们可以使用 fail2ban-client reload ，来加载新的配置。我们应该创建一个新文件jail.local，在jail.local定义的值会覆盖jail.conf中的值。<br>我们来创建一个jail.local文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/fail2ban/jail.local</span><br></pre></td></tr></table></figure><p>或者:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/fail2ban/jail.d/jail.local</span><br></pre></td></tr></table></figure><p>写入如下代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">defalut这里是设定全局设置，如果下面的监控没有设置就以全局设置的值设置。</span></span><br><span class="line">[DEFAULT]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 用于指定哪些地址ip可以忽略 fail2ban 防御,以空格间隔。</span></span><br><span class="line">ignoreip = 127.0.0.1/8</span><br><span class="line"><span class="meta">#</span><span class="bash"> 客户端主机被禁止的时长（默认单位为秒）</span></span><br><span class="line">bantime  = 3600</span><br><span class="line"><span class="meta">#</span><span class="bash"> 过滤的时长（秒）</span></span><br><span class="line">findtime  = 600</span><br><span class="line"><span class="meta">#</span><span class="bash"> 匹配到的阈值（次数）</span></span><br><span class="line">maxretry = 3</span><br><span class="line"></span><br><span class="line">[ssh-iptables]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 是否开启</span></span><br><span class="line">enabled  = true</span><br><span class="line"><span class="meta">#</span><span class="bash"> 过滤规则</span></span><br><span class="line">filter   = sshd</span><br><span class="line"><span class="meta">#</span><span class="bash"> 动作</span></span><br><span class="line">action   = iptables[name=SSH, port=ssh, protocol=tcp]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 日志文件的路径</span></span><br><span class="line">logpath  = /var/log/secure</span><br><span class="line"><span class="meta">#</span><span class="bash"> 匹配到的阈值（次数）</span></span><br><span class="line">maxretry = 3</span><br></pre></td></tr></table></figure><p>在上面配置好了之后，我们需要让配置生效：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fail2ban-client reload</span><br></pre></td></tr></table></figure><p>配置完成之后，重启fail2ban：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart fail2ban</span><br></pre></td></tr></table></figure><p>或者:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service fail2ban restart</span><br></pre></td></tr></table></figure><p>查看登录失败的记录：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo lastb</span><br></pre></td></tr></table></figure><p>查询fail2ban服务状态：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fail2ban-client status</span><br></pre></td></tr></table></figure><p>查询某个jail的详细信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fail2ban-client status ssh-iptables</span><br></pre></td></tr></table></figure><p>实用命令<br>最近一次启动，fail2ban日志：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">journalctl -b -u fail2ban</span><br></pre></td></tr></table></figure><p>实时跟踪显示fail2ban日志（按Ctrl-C退出）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -F /var/log/fail2ban.log</span><br></pre></td></tr></table></figure><p>显示防火墙规则：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -L</span><br></pre></td></tr></table></figure><p>显示防火墙规则对应的命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -S</span><br></pre></td></tr></table></figure><p>fail2ban从黑名单（ban list）中移除IP的方法：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fail2ban-client set ssh-iptables  unbanip 1.1.1.1</span><br></pre></td></tr></table></figure><p>此时再查看banlist会发现IP已移除。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fail2ban-client status ssh-iptables </span><br></pre></td></tr></table></figure><p>跟踪失败的登录条目:<br>以下命令用于检查是否通过ssh端口尝试登录服务器失败。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /var/log/secure | grep 'Failed password'</span><br></pre></td></tr></table></figure><p>执行上述命令将得到来自不同IP地址的根密码尝试失败的列表。 结果的格式与下面所示的相似：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Fer 8 12:41:12 htf sshd[5487]: Failed password for root from 1.1.1.1 port 23021 ssh2</span><br><span class="line">Fer 8 12:41:15 htf sshd[1254]: Failed password for root from 1.1.1.1 port 15486 ssh2</span><br><span class="line">Fer 8 12:41:16 htf sshd[1254]: Failed password for root from 1.1.1.1 port 24457 ssh2</span><br><span class="line">Fer 8 12:41:18 htf sshd[1254]: Failed password for root from 1.1.1.1 port 24457 ssh2</span><br></pre></td></tr></table></figure><p>通过Fail2Ban检查被禁止的IP:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -L -n</span><br></pre></td></tr></table></figure><p>查看当前被禁止登陆的ip：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[root@121]#</span><span class="bash"> fail2ban-client status ssh-iptables </span></span><br><span class="line">Status for the jail: ssh-iptables</span><br><span class="line">|- filter</span><br><span class="line">|  |- File list:    /var/log/secure     #日志文件路径</span><br><span class="line">|  |- Currently failed:    0        #当前失败次数</span><br><span class="line">|  `- Total failed:    3            #总失败次数</span><br><span class="line">`- action</span><br><span class="line">   |- Currently banned:    1        #当前禁止的ip数量</span><br><span class="line">   |  `- IP list:    192.168.1.112        #当前禁止的ip</span><br><span class="line">   `- Total banned:    1        #禁止的ip总数</span><br></pre></td></tr></table></figure><p>启动暂停查看状态:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start/restart/stop/status fail2ban</span><br></pre></td></tr></table></figure><p>fail2ban-regex测试筛选规则设否匹配当前的日志格式：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fail2ban-regex /var/log/secure  /etc/fail2ban/filter.d/sshd.conf</span><br></pre></td></tr></table></figure><h4 id="fail2ban-conf配置文件"><a href="#fail2ban-conf配置文件" class="headerlink" title="fail2ban.conf配置文件"></a>fail2ban.conf配置文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">shell &gt; grep -v ^# /etc/fail2ban/fail2ban.conf</span><br><span class="line"> </span><br><span class="line">[Definition]</span><br><span class="line">loglevel = 3                              ## 定义日志级别，默认</span><br><span class="line">logtarget = /var/log/fail2ban.log         ## 定义 fail2ban 日志文件</span><br><span class="line">socket = /var/run/fail2ban/fail2ban.sock  ## sock 文件存放位置，默认</span><br><span class="line">pidfile = /var/run/fail2ban/fail2ban.pid  ## pid 文件存放位置，默认</span><br></pre></td></tr></table></figure><h4 id="jail-conf-防护配置"><a href="#jail-conf-防护配置" class="headerlink" title="jail.conf 防护配置"></a>jail.conf 防护配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">shell &gt; grep -v ^# /etc/fail2ban/jail.conf</span><br><span class="line"></span><br><span class="line">[DEFAULT]                         ## 全局设置，优先级最小</span><br><span class="line">ignoreip = 127.0.0.1/8            ## 不受限制的 IP ，多组用空格分割</span><br><span class="line">bantime = 600                     ## 非法 IP 被屏蔽时间（秒），-1 代表永远封锁</span><br><span class="line">findtime = 600                    ## 设置多长时间（秒）内超过 maxretry 限制次数即被封锁</span><br><span class="line">maxretry = 3                      ## 最大尝试次数</span><br><span class="line">backend = auto                    ## 日志修改检测机制（gamin 、polling 、auto 三种）</span><br><span class="line">usedns = warn</span><br><span class="line">[ssh-iptables]                    ## 分类设置（基于 SSHD 服务的防护）</span><br><span class="line">enabled = true                    ## 是否开启防护，false 为关闭</span><br><span class="line">filter = sshd                     ## 过滤规则 filter 名称，对应 filter.d 目录下的 sshd.conf</span><br><span class="line">action = iptables[name=SSH, port=ssh, protocol=tcp] ## 动作参数 </span><br><span class="line">logpath = /var/log/secure         ## 检测系统登陆日志文件</span><br><span class="line">maxretry = 5                      ## 最大尝试次数</span><br></pre></td></tr></table></figure><h4 id="其他配置"><a href="#其他配置" class="headerlink" title="其他配置"></a>其他配置</h4><p>修改端口问题:sshd更改端口号后使用fail2ban需要注意在填写配置的时候也需要更改端口号。否则会出现就算会将ip添加到防火墙，但由于变更了SSH端口号，是起不到禁止作用的。<br>解决方法：配置文件中 action = iptables[name=SSH, port=ssh, protocol=tcp] ,port位置修改为新的端口。</p>]]></content>
    
    <summary type="html">
    
      &lt;p class=&quot;description&quot;&gt;&lt;/p&gt;
Fail2ban是一款入侵防御软件，可以保护服务器免受暴力攻击。Fail2ban 基于 auth 日志文件工作，默认情况下它会扫描所有 auth 日志文件，如/var/log/auth.log等，并禁止带有恶意标志的 IP，如密码尝试次数过多等。
Fail2ban 由 Python 编写而成，主要配合 iptables 来进行工作，为各种服务提供了过滤器，如 SSH、Apache、Nginx、Squid、Named、Mysql、Nagios 等。Fail2ban 能够降低风险，但不能消除风险，这只是服务器防止暴力攻击的安全手段之一，本文以CentOS为例。
    
    </summary>
    
    
      <category term="技术" scheme="https://blog.kixcs.com/categories/technique/"/>
    
    
      <category term="SSH" scheme="https://blog.kixcs.com/tags/SSH/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://blog.kixcs.com/archives/24c0/"/>
    <id>https://blog.kixcs.com/archives/24c0/</id>
    <published>2018-04-11T12:48:37.000Z</published>
    <updated>2020-03-01T11:58:09.081Z</updated>
    
    <content type="html"><![CDATA[<p class="description">Hexo是一个快速、简洁且高效的博客框架，其构建依托于Node.js（Node.js是一个事件驱动I/O服务端JavaScript环境，基于Google的V8引擎）；Hexo同时支持 Markdown，支持GitHub Flavored Markdown的所有功能，甚至可以整合Octopress的大多数插件，只需一条指令即可部署到 GitHub Pages, Heroku 或其他平台，除此之外，它拥有丰富的插件和可扩展性，其强大的 API 带来无限的可能，可与数种模板引擎（EJS，Pug，Nunjucks）和工具（Babel，PostCSS，Less/Sass）轻易集成。</p><a id="more"></a><p>Welcome to <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvLw==" title="https://hexo.io/">Hexo<i class="fa fa-external-link"></i></span>! This is your very first post. Check <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3Mv" title="https://hexo.io/docs/">documentation<i class="fa fa-external-link"></i></span> for more info. If you get any problems when using Hexo, you can find the answer in <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3MvdHJvdWJsZXNob290aW5nLmh0bWw=" title="https://hexo.io/docs/troubleshooting.html">troubleshooting<i class="fa fa-external-link"></i></span> or you can ask me on <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvL2lzc3Vlcw==" title="https://github.com/hexojs/hexo/issues">GitHub<i class="fa fa-external-link"></i></span>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvd3JpdGluZy5odG1s" title="https://hexo.io/docs/writing.html">Writing<i class="fa fa-external-link"></i></span></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvc2VydmVyLmh0bWw=" title="https://hexo.io/docs/server.html">Server<i class="fa fa-external-link"></i></span></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZ2VuZXJhdGluZy5odG1s" title="https://hexo.io/docs/generating.html">Generating<i class="fa fa-external-link"></i></span></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvb25lLWNvbW1hbmQtZGVwbG95bWVudC5odG1s" title="https://hexo.io/docs/one-command-deployment.html">Deployment<i class="fa fa-external-link"></i></span></p>]]></content>
    
    <summary type="html">
    
      &lt;p class=&quot;description&quot;&gt;
Hexo是一个快速、简洁且高效的博客框架，其构建依托于Node.js（Node.js是一个事件驱动I/O服务端JavaScript环境，基于Google的V8引擎）；Hexo同时支持 Markdown，支持GitHub Flavored Markdown的所有功能，甚至可以整合Octopress的大多数插件，只需一条指令即可部署到 GitHub Pages, Heroku 或其他平台，除此之外，它拥有丰富的插件和可扩展性，其强大的 API 带来无限的可能，可与数种模板引擎（EJS，Pug，Nunjucks）和工具（Babel，PostCSS，Less/Sass）轻易集成。
&lt;/p&gt;
    
    </summary>
    
    
      <category term="技术" scheme="https://blog.kixcs.com/categories/technique/"/>
    
    
      <category term="Hexo" scheme="https://blog.kixcs.com/tags/Hexo/"/>
    
  </entry>
  
</feed>
